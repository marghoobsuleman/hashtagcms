!function(n){"use strict";var t=function(){return(t=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n}).apply(this,arguments)};function e(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(n);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(e[r[o]]=n[r[o]])}return e}function r(){}function o(n){return n}var i=function(n,t){return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return n(t.apply(null,e))}},u=function(n){return function(){return n}};function c(n){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var o=t.concat(e);return n.apply(null,o)}}function a(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!n.apply(null,t)}}function f(n){return function(){throw new Error(n)}}function s(n){return n()}function l(){return p}var d,m=u(!1),g=u(!0),p=(d={fold:function(n,t){return n()},is:m,isSome:m,isNone:g,getOr:y,getOrThunk:v,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:u(null),getOrUndefined:u(void 0),or:y,orThunk:v,map:l,each:r,bind:l,exists:m,forall:g,filter:l,equals:h,equals_:h,toArray:function(){return[]},toString:u("none()")},Object.freeze&&Object.freeze(d),d);function h(n){return n.isNone()}function v(n){return n()}function y(n){return n}function b(n,t){return An(n,(function(n,e){return{k:e,v:t(n,e)}}))}function x(n,t){return In.call(n,t)}function w(n,t){return function(){return t===n}}function S(n,t){return function(){return t===n}}function T(n){return function(t){return function(n){if(null===n)return"null";var t=typeof n;return"object"==t&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":t}(t)===n}}function O(n,t){return-1<function(n,t){return at.call(n,t)}(n,t)}function k(n,t){for(var e=0,r=n.length;e<r;e++)if(t(n[e],e))return!0;return!1}function E(n,t){for(var e=0,r=n.length;e<r;e++)t(n[e],e)}function C(n,t){for(var e=[],r=0,o=n.length;r<o;r++){var i=n[r];t(i,r)&&e.push(i)}return e}function D(n,t,e){return function(n,t){for(var e=n.length-1;0<=e;e--)t(n[e])}(n,(function(n){e=t(e,n)})),e}function M(n,t,e){return E(n,(function(n){e=t(e,n)})),e}function I(n,t){for(var e=0,r=n.length;e<r;e++){var o=n[e];if(t(o,e))return Dn.some(o)}return Dn.none()}function F(n,t){for(var e=0,r=n.length;e<r;e++)if(t(n[e],e))return Dn.some(e);return Dn.none()}function A(n){for(var t=[],e=0,r=n.length;e<r;++e){if(!rt(n[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+n);ft.apply(t,n[e])}return t}function R(n,t){return A(st(n,t))}function B(n,t){for(var e=0,r=n.length;e<r;++e)if(!0!==t(n[e],e))return!1;return!0}function V(n){var t=ct.call(n,0);return t.reverse(),t}function N(n,t){return C(n,(function(n){return!O(t,n)}))}function j(n){return[n]}function _(n,t){var e=String(t).toLowerCase();return I(n,(function(n){return n.search(e)}))}function P(n,t){return-1!==n.indexOf(t)}function H(n){return function(t){return P(t,n)}}function z(){return ht.get()}function L(n,t){Wt(n,n.element(),t,{})}function G(n,t,e){Wt(n,n.element(),t,e)}function U(n){L(n,Nt())}function $(n,t,e){Wt(n,t,e,{})}function W(n){var t,e=!1;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return e||(e=!0,t=n.apply(null,r)),t}}function X(n){return n.dom().nodeName.toLowerCase()}function q(n){return function(t){return function(n){return n.dom().nodeType}(t)===n}}function Y(n){var t=Zt(n)?n.dom().parentNode:n.dom();return null!=t&&t.ownerDocument.body.contains(t)}function K(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(n.length!==t.length)throw new Error('Wrong number of arguments to struct. Expected "['+n.length+']", got '+t.length+" arguments");var r={};return E(n,(function(n,e){r[n]=u(t[e])})),r}}function J(n){return n.slice(0).sort()}function Q(n,t){if(!rt(t))throw new Error("The "+n+" fields must be an array. Was: "+t+".");E(t,(function(t){if(!tt(t))throw new Error("The value "+t+" in the "+n+" fields was not a string.")}))}function Z(n,t){var e=n.concat(t);if(0===e.length)throw new Error("You must specify at least one required or optional field.");return Q("required",n),Q("optional",t),function(n){var t=J(n);I(t,(function(n,e){return e<t.length-1&&n===t[e+1]})).each((function(n){throw new Error("The field: "+n+" occurs more than once in the combined fields: ["+t.join(", ")+"].")}))}(e),function(r){var o=Mn(r);B(n,(function(n){return O(o,n)}))||function(n,t){throw new Error("All required keys ("+J(n).join(", ")+") were not specified. Specified keys were: "+J(t).join(", ")+".")}(n,o);var i=C(o,(function(n){return!O(e,n)}));0<i.length&&function(n){throw new Error("Unsupported keys for object: "+J(n).join(", "))}(i);var c={};return E(n,(function(n){c[n]=u(r[n])})),E(t,(function(n){c[n]=u(Object.prototype.hasOwnProperty.call(r,n)?Dn.some(r[n]):Dn.none())})),c}}function nn(n,t){var e=n.dom();if(e.nodeType!==ee)return!1;var r=e;if(void 0!==r.matches)return r.matches(t);if(void 0!==r.msMatchesSelector)return r.msMatchesSelector(t);if(void 0!==r.webkitMatchesSelector)return r.webkitMatchesSelector(t);if(void 0!==r.mozMatchesSelector)return r.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")}function tn(n){return n.nodeType!==ee&&n.nodeType!==re||0===n.childElementCount}function en(t,e){var r=void 0===e?n.document:e.dom();return tn(r)?[]:st(r.querySelectorAll(t),qt.fromDom)}function rn(t,e){var r=void 0===e?n.document:e.dom();return tn(r)?Dn.none():Dn.from(r.querySelector(t)).map(qt.fromDom)}function on(n,t){return n.dom()===t.dom()}function un(n){return qt.fromDom(n.dom().ownerDocument)}function cn(n){return Dn.from(n.dom().parentNode).map(qt.fromDom)}function an(n,t){var e=n.dom().childNodes;return Dn.from(e[t]).map(qt.fromDom)}function fn(n,t){cn(n).each((function(e){e.dom().insertBefore(t.dom(),n.dom())}))}function sn(n,t){(function(n){return Dn.from(n.dom().nextSibling).map(qt.fromDom)})(n).fold((function(){cn(n).each((function(n){ie(n,t)}))}),(function(n){fn(n,t)}))}function ln(n,t){(function(n){return an(n,0)})(n).fold((function(){ie(n,t)}),(function(e){n.dom().insertBefore(t.dom(),e.dom())}))}function dn(n,t){E(t,(function(t){ie(n,t)}))}function mn(n){n.dom().textContent="",E(oe(n),(function(n){ue(n)}))}function gn(n,t){ie(n.element(),t.element())}function pn(n){var t=cn(n.element()).bind((function(t){return n.getSystem().getByDom(t).toOption()}));!function(n){ce(n),ue(n.element()),n.getSystem().removeFromWorld(n)}(n),t.each((function(n){n.syncComponents()}))}function hn(n){return function(){for(var t=new Array(arguments.length),e=0;e<t.length;e++)t[e]=arguments[e];if(0===t.length)throw new Error("Can't merge zero objects");for(var r={},o=0;o<t.length;o++){var i=t[o];for(var u in i)ge.call(i,u)&&(r[u]=n(r[u],i[u]))}return r}}function vn(n){return ve.defaultedThunk(u(n))}function yn(n){return function(t){return x(t,n)?Dn.from(t[n]):Dn.none()}}function bn(n,t){return yn(t)(n)}function xn(n,t){var e={};return e[n]=t,e}function wn(n,t){return function(n,t){return function(e){return x(e,n)?e[n]:t}}(n,t)}function Sn(n,t){return xn(n,t)}function Tn(n){return function(n){var t={};return E(n,(function(n){t[n.key]=n.value})),t}(n)}function On(n,t){return function(n,t){return x(n,t)&&void 0!==n[t]&&null!==n[t]}(n,t)}var kn,En,Cn=function(n){function t(){return o}function e(t){return t(n)}var r=u(n),o={fold:function(t,e){return e(n)},is:function(t){return n===t},isSome:g,isNone:m,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:t,orThunk:t,map:function(t){return Cn(t(n))},each:function(t){t(n)},bind:e,exists:e,forall:e,filter:function(t){return t(n)?o:p},toArray:function(){return[n]},toString:function(){return"some("+n+")"},equals:function(t){return t.is(n)},equals_:function(t,e){return t.fold(m,(function(t){return e(n,t)}))}};return o},Dn={some:Cn,none:l,from:function(n){return null==n?p:Cn(n)}},Mn=Object.keys,In=Object.hasOwnProperty,Fn=function(n,t){for(var e=Mn(n),r=0,o=e.length;r<o;r++){var i=e[r];t(n[i],i)}},An=function(n,t){var e={};return Fn(n,(function(n,r){var o=t(n,r);e[o.k]=o.v})),e},Rn=function(n,t){var e=[];return Fn(n,(function(n,r){e.push(t(n,r))})),e},Bn=function(n){function t(){return e}var e=n;return{get:t,set:function(n){e=n},clone:function(){return Bn(t())}}},Vn=function(){return Nn(0,0)},Nn=function(n,t){return{major:n,minor:t}},jn=function(n,t){var e=String(t).toLowerCase();return 0===n.length?Vn():function(n,t){var e=function(n,t){for(var e=0;e<n.length;e++){var r=n[e];if(r.test(t))return r}}(n,t);if(!e)return{major:0,minor:0};function r(n){return Number(t.replace(e,"$"+n))}return Nn(r(1),r(2))}(n,e)},_n=Vn,Pn="Edge",Hn="Chrome",zn="Opera",Ln="Firefox",Gn="Safari",Un=function(n){var t=n.current;return{current:t,version:n.version,isEdge:w(Pn,t),isChrome:w(Hn,t),isIE:w("IE",t),isOpera:w(zn,t),isFirefox:w(Ln,t),isSafari:w(Gn,t)}},$n=function(){return Un({current:void 0,version:_n()})},Wn=Un,Xn=(u(Pn),u(Hn),u("IE"),u(zn),u(Ln),u(Gn),"Windows"),qn="Android",Yn="Linux",Kn="Solaris",Jn="FreeBSD",Qn=function(n){var t=n.current;return{current:t,version:n.version,isWindows:S(Xn,t),isiOS:S("iOS",t),isAndroid:S(qn,t),isOSX:S("OSX",t),isLinux:S(Yn,t),isSolaris:S(Kn,t),isFreeBSD:S(Jn,t)}},Zn=function(){return Qn({current:void 0,version:_n()})},nt=Qn,tt=(u(Xn),u("iOS"),u(qn),u(Yn),u("OSX"),u(Kn),u(Jn),T("string")),et=T("object"),rt=T("array"),ot=T("boolean"),it=T("function"),ut=T("number"),ct=Array.prototype.slice,at=Array.prototype.indexOf,ft=Array.prototype.push,st=function(n,t){for(var e=n.length,r=new Array(e),o=0;o<e;o++){var i=n[o];r[o]=t(i,o)}return r},lt=(it(Array.from)&&Array.from,function(n,t){return _(n,t).map((function(n){var e=jn(n.versionRegexes,t);return{current:n.name,version:e}}))}),dt=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,mt=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return P(n,"edge/")&&P(n,"chrome")&&P(n,"safari")&&P(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,dt],search:function(n){return P(n,"chrome")&&!P(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return P(n,"msie")||P(n,"trident")}},{name:"Opera",versionRegexes:[dt,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:H("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:H("firefox")},{name:"Safari",versionRegexes:[dt,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(P(n,"safari")||P(n,"mobile/"))&&P(n,"applewebkit")}}],gt=[{name:"Windows",search:H("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return P(n,"iphone")||P(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:H("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:H("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:H("linux"),versionRegexes:[]},{name:"Solaris",search:H("sunos"),versionRegexes:[]},{name:"FreeBSD",search:H("freebsd"),versionRegexes:[]}],pt={browsers:u(mt),oses:u(gt)},ht=Bn(function(t){var e=pt.browsers(),r=pt.oses(),o=lt(e,t).fold($n,Wn),i=function(n,t){return _(n,t).map((function(n){var e=jn(n.versionRegexes,t);return{current:n.name,version:e}}))}(r,t).fold(Zn,nt);return{browser:o,os:i,deviceType:function(n,t,e,r){var o=n.isiOS()&&!0===/ipad/i.test(e),i=n.isiOS()&&!o,c=n.isiOS()||n.isAndroid(),a=c||r("(pointer:coarse)"),f=o||!i&&c&&r("(min-device-width:768px)"),s=i||c&&!f,l=t.isSafari()&&n.isiOS()&&!1===/safari/i.test(e),d=!s&&!f&&!l;return{isiPad:u(o),isiPhone:u(i),isTablet:u(f),isPhone:u(s),isTouch:u(a),isAndroid:n.isAndroid,isiOS:n.isiOS,isWebView:u(l),isDesktop:u(d)}}(i,o,t,(function(t){return n.window.matchMedia(t).matches}))}}(n.navigator.userAgent)),vt=u("touchstart"),yt=u("touchmove"),bt=u("touchend"),xt=u("mousedown"),wt=u("mousemove"),St=u("mouseup"),Tt=u("mouseover"),Ot=u("keydown"),kt=u("keyup"),Et=u("input"),Ct=u("change"),Dt=u("click"),Mt=u("transitionend"),It=u("selectstart"),Ft={tap:u("alloy.tap")},At=u("alloy.focus"),Rt=u("alloy.blur.post"),Bt=u("alloy.paste.post"),Vt=u("alloy.receive"),Nt=u("alloy.execute"),jt=u("alloy.focus.item"),_t=Ft.tap,Pt=u("alloy.longpress"),Ht=u("alloy.system.init"),zt=u("alloy.system.attached"),Lt=u("alloy.system.detached"),Gt=u("alloy.focusmanager.shifted"),Ut=u("alloy.highlight"),$t=u("alloy.dehighlight"),Wt=function(n,e,r,o){var i=t({target:e},o);n.getSystem().triggerEvent(r,e,b(i,u))},Xt=function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:u(n)}},qt={fromHtml:function(t,e){var r=(e||n.document).createElement("div");if(r.innerHTML=t,!r.hasChildNodes()||1<r.childNodes.length)throw n.console.error("HTML does not have a single root node",t),new Error("HTML must have a single root node");return Xt(r.childNodes[0])},fromTag:function(t,e){var r=(e||n.document).createElement(t);return Xt(r)},fromText:function(t,e){var r=(e||n.document).createTextNode(t);return Xt(r)},fromDom:Xt,fromPoint:function(n,t,e){var r=n.dom();return Dn.from(r.elementFromPoint(t,e)).map(Xt)}},Yt=(n.Node.ATTRIBUTE_NODE,n.Node.CDATA_SECTION_NODE,n.Node.COMMENT_NODE,n.Node.DOCUMENT_NODE),Kt=(n.Node.DOCUMENT_TYPE_NODE,n.Node.DOCUMENT_FRAGMENT_NODE,n.Node.ELEMENT_NODE),Jt=n.Node.TEXT_NODE,Qt=(n.Node.PROCESSING_INSTRUCTION_NODE,n.Node.ENTITY_REFERENCE_NODE,n.Node.ENTITY_NODE,n.Node.NOTATION_NODE,void 0!==n.window?n.window:Function("return this;")(),q(Kt)),Zt=q(Jt),ne=W((function(){return te(qt.fromDom(n.document))})),te=function(n){var t=n.dom().body;if(null==t)throw new Error("Body is not available yet");return qt.fromDom(t)},ee=Kt,re=Yt,oe=(z().browser.isIE(),function(n){return st(n.dom().childNodes,qt.fromDom)}),ie=(K("element","offset"),function(n,t){n.dom().appendChild(t.dom())}),ue=function(n){var t=n.dom();null!==t.parentNode&&t.parentNode.removeChild(t)},ce=function(n){L(n,Lt()),E(n.components(),ce)},ae=function(n){E(n.components(),ae),L(n,zt())},fe=function(n,t,e){n.getSystem().addToWorld(t),e(n.element(),t.element()),Y(n.element())&&ae(t),n.syncComponents()},se=function(n){return{is:function(t){return n===t},isValue:g,isError:m,getOr:u(n),getOrThunk:u(n),getOrDie:u(n),or:function(t){return se(n)},orThunk:function(t){return se(n)},fold:function(t,e){return e(n)},map:function(t){return se(t(n))},mapError:function(t){return se(n)},each:function(t){t(n)},bind:function(t){return t(n)},exists:function(t){return t(n)},forall:function(t){return t(n)},toOption:function(){return Dn.some(n)}}},le=function(n){return{is:m,isValue:m,isError:g,getOr:o,getOrThunk:function(n){return n()},getOrDie:function(){return f(String(n))()},or:function(n){return n},orThunk:function(n){return n()},fold:function(t,e){return t(n)},map:function(t){return le(n)},mapError:function(t){return le(t(n))},each:r,bind:function(t){return le(n)},exists:m,forall:g,toOption:Dn.none}},de={value:se,error:le,fromOption:function(n,t){return n.fold((function(){return le(t)}),se)}},me=function(t){if(!rt(t))throw new Error("cases must be an array");if(0===t.length)throw new Error("there must be at least one case");var e=[],r={};return E(t,(function(o,i){var u=Mn(o);if(1!==u.length)throw new Error("one and only one name per case");var c=u[0],a=o[c];if(void 0!==r[c])throw new Error("duplicate key detected:"+c);if("cata"===c)throw new Error("cannot have a case named cata (sorry)");if(!rt(a))throw new Error("case arguments must be an array");e.push(c),r[c]=function(){var r=arguments.length;if(r!==a.length)throw new Error("Wrong number of arguments to case "+c+". Expected "+a.length+" ("+a+"), got "+r);for(var o=new Array(r),u=0;u<o.length;u++)o[u]=arguments[u];return{fold:function(){if(arguments.length!==t.length)throw new Error("Wrong number of arguments to fold. Expected "+t.length+", got "+arguments.length);return arguments[i].apply(null,o)},match:function(n){var t=Mn(n);if(e.length!==t.length)throw new Error("Wrong number of arguments to match. Expected: "+e.join(",")+"\nActual: "+t.join(","));if(!B(e,(function(n){return O(t,n)})))throw new Error("Not all branches were specified when using match. Specified: "+t.join(", ")+"\nRequired: "+e.join(", "));return n[c].apply(null,o)},log:function(t){n.console.log(t,{constructors:e,constructor:c,params:o})}}}})),r},ge=Object.prototype.hasOwnProperty,pe=hn((function(n,t){return et(n)&&et(t)?pe(n,t):t})),he=hn((function(n,t){return t})),ve=me([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),ye=ve.strict,be=ve.asOption,xe=ve.defaultedThunk,we=ve.mergeWithThunk,Se=(me([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(n){return yn(n)}),Te=function(n,t){return bn(n,t)};function Oe(n,t,e){return n.stype===kn.Error?t(n.serror):e(n.svalue)}function ke(n){return{stype:kn.Value,svalue:n}}function Ee(n){return{stype:kn.Error,serror:n}}function Ce(n){return i(er,A)(n)}function De(n){return et(n)&&100<Mn(n).length?" removed due to size":JSON.stringify(n,null,2)}function Me(n,t){return er([{path:n,getErrorInfo:t}])}function Ie(n,t,e){var r=bn(n,t).fold((function(){return e(n)}),o);return nr(r)}function Fe(n){return{extract:function(t,e,r){return or(n(r,e),(function(n){return function(n,t){return Me(n,(function(){return t}))}(t,n)}))},toString:function(){return"val"},toDsl:function(){return ar.itemOf(n)}}}function Ae(n){var t=lr(n),e=D(n,(function(n,t){return t.fold((function(t){return pe(n,Sn(t,!0))}),u(n))}),{});return{extract:function(n,r,o){var i=ot(o)?[]:function(n){return C(Mn(n),(function(t){return On(n,t)}))}(o),u=C(i,(function(n){return!On(e,n)}));return 0===u.length?t.extract(n,r,o):function(n,t){return Me(n,(function(){return"There are unsupported fields: ["+t.join(", ")+"] specified"}))}(n,u)},toString:t.toString,toDsl:t.toDsl}}function Re(n){return Fe((function(t){return n(t).fold(er,nr)}))}function Be(n,t){return function(n,t){function e(t,e){return function(n){return{extract:function(t,e,r){var o=st(r,(function(r,o){return n.extract(t.concat(["["+o+"]"]),e,r)}));return cr(o)},toString:function(){return"array("+n.toString()+")"},toDsl:function(){return ar.arrOf(n)}}}(Fe(n)).extract(t,o,e)}return{extract:function(n,r,o){var i=Mn(o),u=e(n,i);return rr(u,(function(e){var i=st(e,(function(n){return sr.field(n,n,ye(),t)}));return lr(i).extract(n,r,o)}))},toString:function(){return"setOf("+t.toString()+")"},toDsl:function(){return ar.setOf(n,t)}}}((function(t){return Qe(n(t))}),t)}function Ve(n,t,e){return Ze(function(n,t,e,r){var o=t.extract([n],e,r);return ur(o,(function(n){return{input:r,errors:n}}))}(n,t,o,e))}function Ne(n){return n.fold((function(n){throw new Error(hr(n))}),o)}function je(n,t,e){return Ne(Ve(n,t,e))}function _e(n,t){return function(n,t){return{extract:function(e,r,o){return Te(o,n).fold((function(){return function(n,t){return Me(n,(function(){return'Choice schema did not contain choice key: "'+t+'"'}))}(e,n)}),(function(n){return function(n,t,e,r,o){return Te(r,o).fold((function(){return function(n,t,e){return Me(n,(function(){return'The chosen schema: "'+e+'" did not exist in branches: '+De(t)}))}(n,r,o)}),(function(r){return r.extract(n.concat(["branch: "+o]),t,e)}))}(e,r,o,t,n)}))},toString:function(){return"chooseOn("+n+"). Possible values: "+Mn(t)},toDsl:function(){return ar.choiceOf(n,t)}}}(n,b(t,lr))}function Pe(n){return gr(n,n,ye(),dr())}function He(n,t){return gr(n,n,ye(),t)}function ze(n,t){return gr(n,n,ye(),lr(t))}function Le(n){return gr(n,n,be(),dr())}function Ge(n,t){return gr(n,n,be(),t)}function Ue(n,t){return Ge(n,lr(t))}function $e(n,t){return Ge(n,Ae(t))}function We(n,t){return gr(n,n,vn(t),dr())}function Xe(n,t,e){return gr(n,n,vn(t),e)}function qe(n,t){return mr(n,t)}function Ye(n,t){return on(n.element(),t.event().target())}function Ke(n){if(!On(n,"can")&&!On(n,"abort")&&!On(n,"run"))throw new Error("EventHandler defined by: "+JSON.stringify(n,null,2)+" does not have can, abort, or run!");return je("Extracting event.handler",Ae([We("can",u(!0)),We("abort",u(!1)),We("run",r)]),n)}(En=kn=kn||{})[En.Error=0]="Error",En[En.Value=1]="Value";var Je,Qe=function(n){return n.fold(Ee,ke)},Ze=function(n){return Oe(n,de.error,de.value)},nr=ke,tr=function(n){var t=[],e=[];return E(n,(function(n){Oe(n,(function(n){return e.push(n)}),(function(n){return t.push(n)}))})),{values:t,errors:e}},er=Ee,rr=function(n,t){return n.stype===kn.Value?t(n.svalue):n},or=function(n,t){return n.stype===kn.Error?t(n.serror):n},ir=function(n,t){return n.stype===kn.Value?{stype:kn.Value,svalue:t(n.svalue)}:n},ur=function(n,t){return n.stype===kn.Error?{stype:kn.Error,serror:t(n.serror)}:n},cr=function(n){var t=tr(n);return 0<t.errors.length?Ce(t.errors):nr(t.values)},ar=me([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]},{thunk:["description"]},{func:["args","outputSchema"]}]),fr=me([{field:["name","presence","type"]},{state:["name"]}]),sr=me([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),lr=function(n){return{extract:function(t,e,r){return function(n,t,e,r){var o=st(e,(function(e){return function(n,t,e,r){return e.fold((function(e,o,i,c){function a(t){var i=c.extract(n.concat([e]),r,t);return ir(i,(function(n){return xn(o,r(n))}))}function f(t){return t.fold((function(){var n=xn(o,r(Dn.none()));return nr(n)}),(function(t){var i=c.extract(n.concat([e]),r,t);return ir(i,(function(n){return xn(o,r(Dn.some(n)))}))}))}return i.fold((function(){return rr(function(n,t,e){return bn(t,e).fold((function(){return function(n,t,e){return Me(n,(function(){return'Could not find valid *strict* value for "'+t+'" in '+De(e)}))}(n,e,t)}),nr)}(n,t,e),a)}),(function(n){return rr(Ie(t,e,n),a)}),(function(){return rr(function(n,t){return nr(bn(n,t))}(t,e),f)}),(function(n){return rr(function(n,t,e){var r=bn(n,t).map((function(t){return!0===t?e(n):t}));return nr(r)}(t,e,n),f)}),(function(n){var r=n(t),o=ir(Ie(t,e,u({})),(function(n){return pe(r,n)}));return rr(o,a)}))}),(function(n,e){var o=e(t);return nr(xn(n,r(o)))}))}(n,t,e,r)}));return function(n){var t=tr(n);return 0<t.errors.length?Ce(t.errors):function(n,t){return 0<n.length?nr(pe(t,he.apply(void 0,n))):nr(t)}(t.values,{})}(o)}(t,r,n,e)},toString:function(){return"obj{\n"+st(n,(function(n){return n.fold((function(n,t,e,r){return n+" -> "+r.toString()}),(function(n,t){return"state("+n+")"}))})).join("\n")+"}"},toDsl:function(){return ar.objOf(st(n,(function(n){return n.fold((function(n,t,e,r){return fr.field(n,e,r)}),(function(n,t){return fr.state(n)}))})))}}},dr=u(Fe(nr)),mr=sr.state,gr=sr.field,pr=Fe(nr),hr=function(n){return"Errors: \n"+function(n){var t=10<n.length?n.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):n;return st(t,(function(n){return"Failed path: ("+n.path.join(" > ")+")\n"+n.getErrorInfo()}))}(n.errors)+"\n\nInput object: "+De(n.input)},vr=u(pr),yr=(Je=it,Fe((function(n){var t=typeof n;return Je(n)?nr(n):er("Expected type: function but got: "+t)})));function br(n,t,e,r,o){return n(e,r)?Dn.some(e):it(o)&&o(e)?Dn.none():t(e,r,o)}function xr(n,t,e){for(var r=n.dom(),o=it(e)?e:u(!1);r.parentNode;){r=r.parentNode;var i=qt.fromDom(r);if(t(i))return Dn.some(i);if(o(i))break}return Dn.none()}function wr(n,t,e){return br((function(n,t){return t(n)}),xr,n,t,e)}function Sr(n){return Tn(n)}function Tr(n,t){return{key:n,value:Ke({abort:t})}}function Or(n,t){return{key:n,value:Ke({run:t})}}function kr(n,t,e){return{key:n,value:Ke({run:function(n){t.apply(void 0,[n].concat(e))}})}}function Er(n){return function(t){return{key:n,value:Ke({run:function(n,e){Ye(n,e)&&t(n,e)}})}}}function Cr(n,t,e){return function(n,t){return Or(n,(function(e,r){e.getSystem().getByUid(t).each((function(t){!function(n,t,e,r){n.getSystem().triggerEvent(e,t,r.event())}(t,t.element(),n,r)}))}))}(n,t.partUids[e])}function Dr(n){return Or(n,(function(n,t){t.cut()}))}function Mr(n,t){var e=n.toString(),r=e.indexOf(")")+1,o=e.indexOf("("),i=e.substring(o+1,r-1).split(/,\s*/);return n.toFunctionAnnotation=function(){return{name:t,parameters:co(i)}},n}function Ir(n){return{classes:void 0!==n.classes?n.classes:[],attributes:void 0!==n.attributes?n.attributes:{},styles:void 0!==n.styles?n.styles:{}}}function Fr(n,t,e){return io((function(r,o){e(r,n,t)}))}function Ar(n){return{key:n,value:void 0}}function Rr(n){var t=je("Creating behaviour: "+n.name,mo,n);return function(n,t,e,r,o,i){var u=Ae(n),c=Ue(t,[$e("config",n)]);return ao(u,c,t,e,r,o,i)}(t.fields,t.name,t.active,t.apis,t.extra,t.state)}function Br(t,e,r){if(!(tt(r)||ot(r)||ut(r)))throw n.console.error("Invalid call to Attr.set. Key ",e,":: Value ",r,":: Element ",t),new Error("Attribute value was not simple");t.setAttribute(e,r+"")}function Vr(n,t,e){Br(n.dom(),t,e)}function Nr(n,t){var e=n.dom();Fn(t,(function(n,t){Br(e,t,n)}))}function jr(n,t){var e=n.dom().getAttribute(t);return null===e?void 0:e}function _r(n,t){var e=n.dom();return!(!e||!e.hasAttribute)&&e.hasAttribute(t)}function Pr(n,t){n.dom().removeAttribute(t)}function Hr(n,t){var e=jr(n,t);return void 0===e||""===e?[]:e.split(" ")}function zr(n){return void 0!==n.dom().classList}function Lr(n,t){zr(n)?n.dom().classList.add(t):function(n,t){!function(n,t,e){Vr(n,t,Hr(n,t).concat([e]).join(" "))}(n,"class",t)}(n,t)}function Gr(n,t){zr(n)?n.dom().classList.remove(t):function(n,t){!function(n,t,e){var r=C(Hr(n,t),(function(n){return n!==e}));0<r.length?Vr(n,t,r.join(" ")):Pr(n,t)}(n,"class",t)}(n,t),function(n){0===(zr(n)?n.dom().classList:function(n){return Hr(n,"class")}(n)).length&&Pr(n,"class")}(n)}function Ur(n,t){return zr(n)&&n.dom().classList.contains(t)}function $r(n,t,e){Gr(n,e),Lr(n,t)}function Wr(n){n.dom().focus()}function Xr(n){n.dom().blur()}function qr(t){var e=void 0!==t?t.dom():n.document;return Dn.from(e.activeElement).map(qt.fromDom)}function Yr(n){return qr(un(n)).filter((function(t){return n.dom().contains(t.dom())}))}function Kr(n){return n.dom().innerHTML}function Jr(n){return function(n){return function(n){var t=qt.fromTag("div"),e=qt.fromDom(n.dom().cloneNode(!0));return ie(t,e),Kr(t)}(function(n){return function(n){return qt.fromDom(n.dom().cloneNode(!1))}(n)}(n))}(n)}function Qr(n){for(var t=[],e=function(n){t.push(n)},r=0;r<n.length;r++)n[r].each(e);return t}function Zr(n,t){for(var e=0;e<n.length;e++){var r=t(n[e],e);if(r.isSome())return r}return Dn.none()}var no,to,eo,ro=Er(zt()),oo=Er(Lt()),io=Er(Ht()),uo=(no=Nt(),function(n){return Or(no,n)}),co=function(n){return st(n,(function(n){return function(n){return function(n,t,e){return!(n.length<2)&&"/*"===n.substr(e,e+2)}(n,0,n.length-2)}(n)?n.substring(0,n.length-2):n}))},ao=function(n,e,r,o,i,a,f){function s(n){return On(n,r)?n[r]():Dn.none()}var l=b(i,(function(n,t){return function(n,t,e){return function(n,t,e){var r=e.toString(),o=r.indexOf(")")+1,i=r.indexOf("("),u=r.substring(i+1,o-1).split(/,\s*/);return n.toFunctionAnnotation=function(){return{name:t,parameters:co(u.slice(0,1).concat(u.slice(3)))}},n}((function(r){for(var o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];var c=[r].concat(o);return r.config({name:u(n)}).fold((function(){throw new Error("We could not find any behaviour configuration for: "+n+". Using Api: "+e)}),(function(n){var e=Array.prototype.slice.call(c,1);return t.apply(void 0,[r,n.config,n.state].concat(e))}))}),e,t)}(r,n,t)})),d=b(a,(function(n,t){return Mr(n,t)})),m=t(t(t({},d),l),{revoke:c(Ar,r),config:function(t){var e=je(r+"-config",n,t);return{key:r,value:{config:e,me:m,configAsRaw:W((function(){return je(r+"-config",n,t)})),initialConfig:t,state:f}}},schema:function(){return e},exhibit:function(n,t){return s(n).bind((function(n){return Te(o,"exhibit").map((function(e){return e(t,n.config,n.state)}))})).getOr(Ir({}))},name:function(){return r},handlers:function(n){return s(n).map((function(n){return wn("events",(function(n,t){return{}}))(o)(n.config,n.state)})).getOr({})}});return m},fo={init:function(){return so({readState:function(){return"No State required"}})}},so=function(n){return n},lo=function(n){return Tn(n)},mo=Ae([Pe("fields"),Pe("name"),We("active",{}),We("apis",{}),We("state",fo),We("extra",{})]),go=Ae([Pe("branchKey"),Pe("branches"),Pe("name"),We("active",{}),We("apis",{}),We("state",fo),We("extra",{})]),po=u(void 0),ho=Object.freeze({toAlpha:function(n,t,e){$r(n.element(),t.alpha,t.omega)},toOmega:function(n,t,e){$r(n.element(),t.omega,t.alpha)},isAlpha:function(n,t,e){return Ur(n.element(),t.alpha)},isOmega:function(n,t,e){return Ur(n.element(),t.omega)},clear:function(n,t,e){Gr(n.element(),t.alpha),Gr(n.element(),t.omega)}}),vo=Rr({fields:[Pe("alpha"),Pe("omega")],name:"swapping",apis:ho}),yo=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),bo=tinymce.util.Tools.resolve("tinymce.ThemeManager"),xo=function(t){var e=n.document.createElement("a");e.target="_blank",e.href=t.href,e.rel="noreferrer noopener";var r=n.document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,n.window,0,0,0,0,0,!1,!1,!1,!1,0,null),n.document.body.appendChild(e),e.dispatchEvent(r),n.document.body.removeChild(e)},wo={formatChanged:u("formatChanged"),orientationChanged:u("orientationChanged"),dropupDismissed:u("dropupDismissed")},So=Object.freeze({events:function(n){return Sr([Or(Vt(),(function(t,e){var r=n.channels,o=function(n,t){return t.universal()?n:C(n,(function(n){return O(t.channels(),n)}))}(Mn(r),e);E(o,(function(n){var o=r[n],i=o.schema,u=je("channel["+n+"] data\nReceiver: "+Jr(t.element()),i,e.data());o.onReceive(t,u)}))}))])}});function To(t,e,r){return function(t,e,r){switch(Te(Xo.get(),t).orThunk((function(){return Zr(Mn(Xo.get()),(function(n){return-1<t.indexOf(n)?Dn.some(Xo.get()[n]):Dn.none()}))})).getOr(to.NORMAL)){case to.NORMAL:return r(Yo());case to.LOGGING:var o=function(t,e){var r=[],o=(new Date).getTime();return{logEventCut:function(n,t,e){r.push({outcome:"cut",target:t,purpose:e})},logEventStopped:function(n,t,e){r.push({outcome:"stopped",target:t,purpose:e})},logNoParent:function(n,t,e){r.push({outcome:"no-parent",target:t,purpose:e})},logEventNoHandlers:function(n,t){r.push({outcome:"no-handlers-left",target:t})},logEventResponse:function(n,t,e){r.push({outcome:"response",purpose:e,target:t})},write:function(){var i=(new Date).getTime();O(["mousemove","mouseover","mouseout",Ht()],t)||n.console.log(t,{event:t,time:i-o,target:e.dom(),sequence:st(r,(function(n){return O(["cut","stopped","response"],n.outcome)?"{"+n.purpose+"} "+n.outcome+" at ("+Jr(n.target)+")":n.outcome}))})}}}(t,e),i=r(o);return o.write(),i;case to.STOP:return!0}}(t,e,r)}function Oo(n,t,e){return function(){var n=new Error;void 0!==n.stack&&I(n.stack.split("\n"),(function(n){return 0<n.indexOf("alloy")&&!k(qo,(function(t){return-1<n.indexOf(t)}))})).getOr("unknown")}(),gr(t,t,e,Re((function(n){return de.value((function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n.apply(void 0,t)}))})))}function ko(n){return Oo(0,n,vn(r))}function Eo(n){return Oo(0,n,vn(Dn.none))}function Co(n){return Oo(0,n,ye())}function Do(n){return Oo(0,n,ye())}function Mo(n,t){return qe(n,u(t))}function Io(n){return qe(n,o)}function Fo(n,t,e){var r=t.aria;r.update(n,r,e.get())}function Ao(n,t,e){t.toggleClass.each((function(t){e.get()?Lr(n.element(),t):Gr(n.element(),t)}))}function Ro(n,t,e){ei(n,t,e,!e.get())}function Bo(n,t,e){e.set(!0),Ao(n,t,e),Fo(n,t,e)}function Vo(n,t,e){e.set(!1),Ao(n,t,e),Fo(n,t,e)}function No(n,t,e){ei(n,t,e,t.selected)}function jo(){return[Or(z().deviceType.isTouch()?Ft.tap():Dt(),(function(n,t){t.stop(),U(n)})),Dr(z().deviceType.isTouch()?vt():xt())]}function _o(n,t){t.ignore||(Wr(n.element()),t.onFocus(n))}function Po(n){return void 0!==n.style&&it(n.style.getPropertyValue)}function Ho(t,e,r){if(!tt(r))throw n.console.error("Invalid call to CSS.set. Property ",e,":: Value ",r,":: Element ",t),new Error("CSS value must be a string: "+r);Po(t)&&t.style.setProperty(e,r)}function zo(n,t){var e=n.dom();Fn(t,(function(n,t){Ho(e,t,n)}))}function Lo(t,e){var r=t.dom(),o=n.window.getComputedStyle(r).getPropertyValue(e),i=""!==o||Y(t)?o:vi(r,e);return null===i?void 0:i}function Go(n,t){var e=n.dom(),r=vi(e,t);return Dn.from(r).filter((function(n){return 0<n.length}))}function Uo(n,t){!function(n,t){Po(n)&&n.style.removeProperty(t)}(n.dom(),t),_r(n,"style")&&""===function(n){return n.replace(/^\s+|\s+$/g,"")}(jr(n,"style"))&&Pr(n,"style")}function $o(n){return n.dom().offsetWidth}(eo=to=to||{})[eo.STOP=0]="STOP",eo[eo.NORMAL=1]="NORMAL",eo[eo.LOGGING=2]="LOGGING";var Wo,Xo=Bn({}),qo=["alloy/data/Fields","alloy/debugging/Debugging"],Yo=u({logEventCut:r,logEventStopped:r,logNoParent:r,logEventNoHandlers:r,logEventResponse:r,write:r}),Ko=u([Pe("menu"),Pe("selectedMenu")]),Jo=u([Pe("item"),Pe("selectedItem")]),Qo=(u(lr(Jo().concat(Ko()))),u(lr(Jo()))),Zo=ze("initSize",[Pe("numColumns"),Pe("numRows")]),ni=u(Zo),ti=Rr({fields:[He("channels",Be(de.value,Ae([Co("onReceive"),We("schema",vr())])))],name:"receiving",active:So}),ei=function(n,t,e,r){(r?Bo:Vo)(n,t,e)},ri=Object.freeze({onLoad:No,toggle:Ro,isOn:function(n,t,e){return e.get()},on:Bo,off:Vo,set:ei}),oi=Object.freeze({exhibit:function(n,t,e){return Ir({})},events:function(n,t){var e=function(n,t,e){return uo((function(r){e(r,n,t)}))}(n,t,Ro),r=Fr(n,t,No);return Sr(A([n.toggleOnExecute?[e]:[],[r]]))}}),ii=function(n,t,e){Vr(n.element(),"aria-expanded",e)},ui=[We("selected",!1),Le("toggleClass"),We("toggleOnExecute",!0),Xe("aria",{mode:"none"},_e("mode",{pressed:[We("syncWithExpanded",!1),Mo("update",(function(n,t,e){Vr(n.element(),"aria-pressed",e),t.syncWithExpanded&&ii(n,0,e)}))],checked:[Mo("update",(function(n,t,e){Vr(n.element(),"aria-checked",e)}))],expanded:[Mo("update",ii)],selected:[Mo("update",(function(n,t,e){Vr(n.element(),"aria-selected",e)}))],none:[Mo("update",r)]}))],ci=Rr({fields:ui,name:"toggling",active:oi,apis:ri,state:(Wo=!1,{init:function(){var n=Bn(Wo);return{get:function(){return n.get()},set:function(t){return n.set(t)},clear:function(){return n.set(Wo)},readState:function(){return n.get()}}}})}),ai=function(n,t){return ti.config({channels:Sn(wo.formatChanged(),{onReceive:function(e,r){r.command===n&&t(e,r.state)}})})},fi=function(n){return ti.config({channels:Sn(wo.orientationChanged(),{onReceive:n})})},si=function(n,t){return{key:n,value:{onReceive:t}}},li="tinymce-mobile",di={resolve:function(n){return li+"-"+n},prefix:u(li)},mi=Object.freeze({focus:_o,blur:function(n,t){t.ignore||Xr(n.element())},isFocused:function(n){return function(n){var t=un(n).dom();return n.dom()===t.activeElement}(n.element())}}),gi=Object.freeze({exhibit:function(n,t){return Ir(t.ignore?{}:{attributes:{tabindex:"-1"}})},events:function(n){return Sr([Or(At(),(function(t,e){_o(t,n),e.stop()}))].concat(n.stopMousedown?[Or(xt(),(function(n,t){t.event().prevent()}))]:[]))}}),pi=Rr({fields:[ko("onFocus"),We("stopMousedown",!1),We("ignore",!1)],name:"focusing",active:gi,apis:mi}),hi=function(n,t,e){Ho(n.dom(),t,e)},vi=function(n,t){return Po(n)?n.style.getPropertyValue(t):""};function yi(n,t){function e(e){var r=t(e);if(r<=0||null===r){var o=Lo(e,n);return parseFloat(o)||0}return r}function r(n,t){return M(t,(function(t,e){var r=Lo(n,e),o=void 0===r?0:parseInt(r,10);return isNaN(o)?t:t+o}),0)}return{set:function(t,e){if(!ut(e)&&!e.match(/^[0-9]+$/))throw new Error(n+".set accepts only positive integer values. Value was "+e);var r=t.dom();Po(r)&&(r.style[n]=e+"px")},get:e,getOuter:e,aggregate:r,max:function(n,t,e){var o=r(n,e);return o<t?t-o:0}}}function bi(n){return Gi.get(n)}function xi(n,t){return en(t,n)}function wi(n){return rn(n)}function Si(n,t,e){return xr(n,(function(n){return nn(n,t)}),e)}function Ti(n,t){return rn(t,n)}function Oi(n,t,e){return br(nn,Si,n,t,e)}function ki(n,t,e){var r=V(n.slice(0,t)),o=V(n.slice(t+1));return I(r.concat(o),e)}function Ei(n,t,e){return I(V(n.slice(0,t)),e)}function Ci(n,t,e){var r=n.slice(0,t);return I(n.slice(t+1).concat(r),e)}function Di(n,t,e){return I(n.slice(t+1),e)}function Mi(n){return function(t){var e=t.raw();return O(n,e.which)}}function Ii(n){return function(t){return B(n,(function(n){return n(t)}))}}function Fi(n){return!0===n.raw().shiftKey}function Ai(n){return!0===n.raw().ctrlKey}function Ri(n,t){return{matches:n,classification:t}}function Bi(n,t,e,r){var o=n+t;return r<o?e:o<e?r:o}function Vi(n,t,e){return n<=t?t:e<=n?e:n}function Ni(n,t,e,r){E(xi(n.element(),"."+t.highlightClass),(function(e){k(r,(function(n){return n.element()===e}))||(Gr(e,t.highlightClass),n.getSystem().getByDom(e).each((function(e){t.onDehighlight(n,e),L(e,$t())})))}))}function ji(n,t,e,r){Ni(n,t,0,[r]),$i(n,t,e,r)||(Lr(r.element(),t.highlightClass),t.onHighlight(n,r),L(r,Ut()))}function _i(n,t,e,r){var o=xi(n.element(),"."+t.itemClass);return F(o,(function(n){return Ur(n,t.highlightClass)})).bind((function(t){var e=Bi(t,r,0,o.length-1);return n.getSystem().getByDom(o[e]).toOption()}))}function Pi(n,t,e){t.exists((function(n){return e.exists((function(t){return on(t,n)}))}))||G(n,Gt(),{prevFocus:t,newFocus:e})}function Hi(){function n(n){return Yr(n.element())}return{get:n,set:function(t,e){var r=n(t);t.getSystem().triggerFocus(e,t.element()),Pi(t,r,n(t))}}}var zi,Li,Gi=yi("height",(function(n){var t=n.dom();return Y(n)?t.getBoundingClientRect().height:t.offsetHeight})),Ui=a(Fi),$i=function(n,t,e,r){return Ur(r.element(),t.highlightClass)},Wi=function(n,t,e){return Ti(n.element(),"."+t.itemClass).bind((function(t){return n.getSystem().getByDom(t).toOption()}))},Xi=function(n,t,e){var r=xi(n.element(),"."+t.itemClass);return(0<r.length?Dn.some(r[r.length-1]):Dn.none()).bind((function(t){return n.getSystem().getByDom(t).toOption()}))},qi=function(n,t,e){var r=xi(n.element(),"."+t.itemClass);return Qr(st(r,(function(t){return n.getSystem().getByDom(t).toOption()})))},Yi=Object.freeze({dehighlightAll:function(n,t,e){return Ni(n,t,0,[])},dehighlight:function(n,t,e,r){$i(n,t,e,r)&&(Gr(r.element(),t.highlightClass),t.onDehighlight(n,r),L(r,$t()))},highlight:ji,highlightFirst:function(n,t,e){Wi(n,t).each((function(r){ji(n,t,e,r)}))},highlightLast:function(n,t,e){Xi(n,t).each((function(r){ji(n,t,e,r)}))},highlightAt:function(n,t,e,r){(function(n,t,e,r){var o=xi(n.element(),"."+t.itemClass);return Dn.from(o[r]).fold((function(){return de.error("No element found with index "+r)}),n.getSystem().getByDom)})(n,t,0,r).fold((function(n){throw new Error(n)}),(function(r){ji(n,t,e,r)}))},highlightBy:function(n,t,e,r){I(qi(n,t),r).each((function(r){ji(n,t,e,r)}))},isHighlighted:$i,getHighlighted:function(n,t,e){return Ti(n.element(),"."+t.highlightClass).bind((function(t){return n.getSystem().getByDom(t).toOption()}))},getFirst:Wi,getLast:Xi,getPrevious:function(n,t,e){return _i(n,t,0,-1)},getNext:function(n,t,e){return _i(n,t,0,1)},getCandidates:qi}),Ki=Rr({fields:[Pe("highlightClass"),Pe("itemClass"),ko("onHighlight"),ko("onDehighlight")],name:"highlighting",apis:Yi});function Ji(n,t,e,r,o){function i(n,t,e,r,o){return function(n,t){return I(n,(function(n){return n.matches(t)})).map((function(n){return n.classification}))}(e(n,t,r,o),t.event()).bind((function(e){return e(n,t,r,o)}))}var u={schema:function(){return n.concat([We("focusManager",Hi()),Xe("focusInside","onFocus",Re((function(n){return O(["onFocus","onEnterOrSpace","onApi"],n)?de.value(n):de.error("Invalid value for focusInside")}))),Mo("handler",u),Mo("state",t),Mo("sendFocusIn",o)])},processKey:i,toEvents:function(n,t){var u=n.focusInside!==zi.OnFocusMode?Dn.none():o(n).map((function(e){return Or(At(),(function(r,o){e(r,n,t),o.stop()}))}));return Sr(u.toArray().concat([Or(Ot(),(function(r,u){i(r,u,e,n,t).fold((function(){!function(e,r){var i=Mi([32].concat([13]))(r.event());n.focusInside===zi.OnEnterOrSpaceMode&&i&&Ye(e,r)&&o(n).each((function(o){o(e,n,t),r.stop()}))}(r,u)}),(function(n){u.stop()}))})),Or(kt(),(function(e,o){i(e,o,r,n,t).each((function(n){o.stop()}))}))]))}};return u}function Qi(n){function t(n,t){return 0<bi(n.visibilitySelector.bind((function(n){return Oi(t,n)})).getOr(t))}function e(n,e){(function(n,e){var r=C(xi(n.element(),e.selector),(function(n){return t(e,n)}));return Dn.from(r[e.firstTabstop])})(n,e).each((function(t){e.focusManager.set(n,t)}))}function r(n,e,r,o){var i=xi(n.element(),r.selector);return function(n,t){return t.focusManager.get(n).bind((function(n){return Oi(n,t.selector)}))}(n,r).bind((function(e){return F(i,c(on,e)).bind((function(e){return function(n,e,r,o,i){return i(e,r,(function(n){return function(n,e){return t(n,e)&&n.useTabstopAt(e)}(o,n)})).fold((function(){return o.cyclic?Dn.some(!0):Dn.none()}),(function(t){return o.focusManager.set(n,t),Dn.some(!0)}))}(n,i,e,r,o)}))}))}var o=[Le("onEscape"),Le("onEnter"),We("selector",'[data-alloy-tabstop="true"]:not(:disabled)'),We("firstTabstop",0),We("useTabstopAt",u(!0)),Le("visibilitySelector")].concat([n]),i=u([Ri(Ii([Fi,Mi([9])]),(function(n,t,e,o){return r(n,0,e,e.cyclic?ki:Ei)})),Ri(Mi([9]),(function(n,t,e,o){return r(n,0,e,e.cyclic?Ci:Di)})),Ri(Mi([27]),(function(n,t,e,r){return e.onEscape.bind((function(e){return e(n,t)}))})),Ri(Ii([Ui,Mi([13])]),(function(n,t,e,r){return e.onEnter.bind((function(e){return e(n,t)}))}))]),a=u([]);return Ji(o,fo.init,i,a,(function(){return Dn.some(e)}))}function Zi(n){return"input"===X(n)&&"radio"!==jr(n,"type")||"textarea"===X(n)}function nu(n,t,e){return Zi(e)&&Mi([32])(t.event())?Dn.none():function(n,t,e){return $(n,e,Nt()),Dn.some(!0)}(n,0,e)}function tu(n,t){return Dn.some(!0)}function eu(n,t,e){return e.execute(n,t,n.element())}function ru(n){var t=Bn(Dn.none());return so({readState:function(){return t.get().map((function(n){return{numRows:n.numRows(),numColumns:n.numColumns()}})).getOr({numRows:"?",numColumns:"?"})},setGridSize:function(n,e){t.set(Dn.some({numRows:u(n),numColumns:u(e)}))},getNumRows:function(){return t.get().map((function(n){return n.numRows()}))},getNumColumns:function(){return t.get().map((function(n){return n.numColumns()}))}})}function ou(n,t){return function(e){return"rtl"===mc(e)?t:n}}function iu(n){return function(t,e,r,o){var i=n(t.element());return gc(i,t,e,r,o)}}function uu(n,t){return iu(ou(n,t))}function cu(n,t){return iu(ou(t,n))}function au(n){return function(t,e,r,o){return gc(n,t,e,r,o)}}function fu(n){return!function(n){return n.offsetWidth<=0&&n.offsetHeight<=0}(n.dom())}function su(n,t,e){var r=c(on,t);return function(n,t){return F(n,t).map((function(t){return yc({index:t,candidates:n})}))}(C(xi(n,e),fu),r)}function lu(n,t){return F(n,(function(n){return on(t,n)}))}function du(n,t,e,r){return r(Math.floor(t/e),t%e).bind((function(t){var r=t.row()*e+t.column();return 0<=r&&r<n.length?Dn.some(n[r]):Dn.none()}))}function mu(n,t,e,r,o){return du(n,t,r,(function(t,i){var c=t===e-1?n.length-t*r:r,a=Bi(i,o,0,c-1);return Dn.some({row:u(t),column:u(a)})}))}function gu(n,t,e,r,o){return du(n,t,r,(function(t,i){var c=Bi(t,o,0,e-1),a=Vi(i,0,(c===e-1?n.length-c*r:r)-1);return Dn.some({row:u(c),column:u(a)})}))}function pu(n,t,e){Ti(n.element(),t.selector).each((function(e){t.focusManager.set(n,e)}))}function hu(n){return function(t,e,r,o){return su(t,e,r.selector).bind((function(t){return n(t.candidates(),t.index(),o.getNumRows().getOr(r.initSize.numRows),o.getNumColumns().getOr(r.initSize.numColumns))}))}}function vu(n,t,e,r){return e.captureTab?Dn.some(!0):Dn.none()}function yu(n,t,e,r){var o=function(n,t,e){var i=Bi(t,r,0,e.length-1);return i===n?Dn.none():function(n){return"button"===X(n)&&"disabled"===jr(n,"disabled")}(e[i])?o(n,i,e):Dn.from(e[i])};return su(n,e,t).bind((function(n){var t=n.index(),e=n.candidates();return o(t,t,e)}))}function bu(n,t,e){return function(n,t){return t.focusManager.get(n).bind((function(n){return Oi(n,t.selector)}))}(n,e).bind((function(r){return e.execute(n,t,r)}))}function xu(n,t){t.getInitial(n).orThunk((function(){return Ti(n.element(),t.selector)})).each((function(e){t.focusManager.set(n,e)}))}function wu(n,t,e){return yu(n,e.selector,t,-1)}function Su(n,t,e){return yu(n,e.selector,t,1)}function Tu(n){return function(t,e,r){return n(t,e,r).bind((function(){return r.executeOnMove?bu(t,e,r):Dn.some(!0)}))}}function Ou(n,t,e,r){return e.onEscape(n,t)}function ku(n,t,e){return Dn.from(n[t]).bind((function(n){return Dn.from(n[e]).map((function(n){return Mc({rowIndex:t,columnIndex:e,cell:n})}))}))}function Eu(n,t,e,r){return ku(n,t,Bi(e,r,0,n[t].length-1))}function Cu(n,t,e,r){var o=Bi(e,r,0,n.length-1);return ku(n,o,Vi(t,0,n[o].length-1))}function Du(n,t,e,r){return ku(n,t,Vi(e+r,0,n[t].length-1))}function Mu(n,t,e,r){var o=Vi(e+r,0,n.length-1);return ku(n,o,Vi(t,0,n[o].length-1))}function Iu(n,t){t.previousSelector(n).orThunk((function(){var e=t.selectors;return Ti(n.element(),e.cell)})).each((function(e){t.focusManager.set(n,e)}))}function Fu(n,t){return function(e,r,o){var i=o.cycles?n:t;return Oi(r,o.selectors.row).bind((function(n){return lu(xi(n,o.selectors.cell),r).bind((function(t){var r=xi(e,o.selectors.row);return lu(r,n).bind((function(n){var e=function(n,t){return st(n,(function(n){return xi(n,t.selectors.cell)}))}(r,o);return i(e,n,t).map((function(n){return n.cell()}))}))}))}))}}function Au(n,t,e){return e.focusManager.get(n).bind((function(r){return e.execute(n,t,r)}))}function Ru(n,t){Ti(n.element(),t.selector).each((function(e){t.focusManager.set(n,e)}))}function Bu(n,t,e){return yu(n,e.selector,t,-1)}function Vu(n,t,e){return yu(n,e.selector,t,1)}function Nu(n,t){return function(n,t,e){return Xe(n,{},lr(e))}(n,0,st(t,(function(t){return function(n,t){return gr(n,n,be(),Fe((function(e){return er("The field: "+n+" is forbidden. "+t)})))}(t.name(),"Cannot configure "+t.name()+" for "+n)})).concat([qe("dump",o)]))}function ju(n){return n.dump}function _u(n,e){return t(t({},n.dump),lo(e))}function Pu(n){var t=(new Date).getTime();return n+"_"+Math.floor(1e9*Math.random())+ ++ua+String(t)}function Hu(n){function t(n){return n.name}return n.fold(t,t,t,t)}function zu(n,t){return function(e){var r=je("Converting part type",t,e);return n(r)}}function Lu(n,t,e,r){return pe(t.defaults(n,e,r),e,{uid:n.partUids[t.name]},t.overrides(n,e,r))}function Gu(n,t,e){return function(n,t,e){var r={},o={};return E(e,(function(n){n.fold((function(n){r[n.pname]=ra(!0,(function(t,e,r){return n.factory.sketch(Lu(t,n,e,r))}))}),(function(n){var e=t.parts[n.name];o[n.name]=u(n.factory.sketch(Lu(t,n,e[wa()]),e))}),(function(n){r[n.pname]=ra(!1,(function(t,e,r){return n.factory.sketch(Lu(t,n,e,r))}))}),(function(n){r[n.pname]=oa(!0,(function(t,e,r){var o=t[n.name];return st(o,(function(e){return n.factory.sketch(pe(n.defaults(t,e,r),e,n.overrides(t,e)))}))}))}))})),{internals:u(r),externals:u(o)}}(0,t,e)}function Uu(n,t,e){return function(n,t,e,r){var o=b(r,(function(n,t){return function(n,t){var e=!1;return{name:u(n),required:function(){return t.fold((function(n,t){return n}),(function(n,t){return n}))},used:function(){return e},replace:function(){if(!0===e)throw new Error("Trying to use the same placeholder more than once: "+n);return e=!0,t}}}(t,n)})),i=function(n,t,e,r){return R(e,(function(e){return ea(n,t,e,r)}))}(n,t,e,o);return Fn(o,(function(e){if(!1===e.used()&&e.required())throw new Error("Placeholder: "+e.name()+" was not found in components list\nNamespace: "+n.getOr("none")+"\nComponents: "+JSON.stringify(t.components,null,2))})),i}(Dn.some(n),t,t.components,e)}function $u(n,t,e){var r=t.partUids[e];return n.getSystem().getByUid(r).toOption()}function Wu(n,t,e){return $u(n,t,e).getOrDie("Could not find part: "+e)}function Xu(n){return gr("partUids","partUids",we((function(t){return function(n,t){var e=function(n){return st(n,Hu)}(t);return Tn(st(e,(function(t){return{key:t,value:n+"-"+t}})))}(t.uid,n)})),vr())}function qu(n){return Sn(Sa,n)}function Yu(n){return function(n,t){var e=t.toString(),r=e.indexOf(")")+1,o=e.indexOf("("),i=e.substring(o+1,r-1).split(/,\s*/);return n.toFunctionAnnotation=function(){return{name:"OVERRIDE",parameters:co(i.slice(1))}},n}((function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return n.apply(void 0,[t.getApis()].concat([t].concat(e)))}),n)}function Ku(n){return Pu(n)}function Ju(n,t,e,r,o){var i=function(n,t){return(0<n.length?[ze("parts",n)]:[]).concat([Pe("uid"),We("dom",{}),We("components",[]),Io("originalSpec"),We("debug.sketcher",{})]).concat(t)}(r,o);return je(n+" [SpecSchema]",Ae(i.concat(t)),e)}function Qu(n,t,e,r,o){var i=Ma(o),u=function(n){return R(n,(function(n){return n.fold(Dn.none,Dn.some,Dn.none,Dn.none).map((function(n){return ze(n.name,n.schema.concat([Io(wa())]))})).toArray()}))}(e),c=Ju(n,t,i,u,[Xu(e)]),a=Gu(0,c,e);return r(c,Uu(n,c,a.internals()),i,a.externals())}(Li=zi=zi||{}).OnFocusMode="onFocus",Li.OnEnterOrSpaceMode="onEnterOrSpace",Li.OnApiMode="onApi";var Zu,nc,tc,ec,rc,oc,ic,uc,cc,ac,fc=Qi(qe("cyclic",u(!1))),sc=Qi(qe("cyclic",u(!0))),lc=Ji([We("execute",nu),We("useSpace",!1),We("useEnter",!0),We("useControlEnter",!1),We("useDown",!1)],fo.init,(function(n,t,e,r){var o=e.useSpace&&!Zi(n.element())?[32]:[],i=e.useEnter?[13]:[],u=e.useDown?[40]:[];return[Ri(Mi(o.concat(i).concat(u)),eu)].concat(e.useControlEnter?[Ri(Ii([Ai,Mi([13])]),eu)]:[])}),(function(n,t,e,r){return e.useSpace&&!Zi(n.element())?[Ri(Mi([32]),tu)]:[]}),(function(){return Dn.none()})),dc=Object.freeze({flatgrid:ru,init:function(n){return n.state(n)}}),mc=function(n){return"rtl"===Lo(n,"direction")?"rtl":"ltr"},gc=function(n,t,e,r,o){return r.focusManager.get(t).bind((function(e){return n(t.element(),e,r,o)})).map((function(n){return r.focusManager.set(t,n),!0}))},pc=au,hc=au,vc=au,yc=Z(["index","candidates"],[]),bc=[Pe("selector"),We("execute",nu),Eo("onEscape"),We("captureTab",!1),ni()],xc=hu((function(n,t,e,r){return mu(n,t,e,r,-1)})),wc=hu((function(n,t,e,r){return mu(n,t,e,r,1)})),Sc=hu((function(n,t,e,r){return gu(n,t,e,r,-1)})),Tc=hu((function(n,t,e,r){return gu(n,t,e,r,1)})),Oc=u([Ri(Mi([37]),uu(xc,wc)),Ri(Mi([39]),cu(xc,wc)),Ri(Mi([38]),pc(Sc)),Ri(Mi([40]),hc(Tc)),Ri(Ii([Fi,Mi([9])]),vu),Ri(Ii([Ui,Mi([9])]),vu),Ri(Mi([27]),(function(n,t,e,r){return e.onEscape(n,t)})),Ri(Mi([32].concat([13])),(function(n,t,e,r){return function(n,t){return t.focusManager.get(n).bind((function(n){return Oi(n,t.selector)}))}(n,e).bind((function(r){return e.execute(n,t,r)}))}))]),kc=Ji(bc,ru,Oc,u([Ri(Mi([32]),tu)]),(function(){return Dn.some(pu)})),Ec=[Pe("selector"),We("getInitial",Dn.none),We("execute",nu),Eo("onEscape"),We("executeOnMove",!1),We("allowVertical",!0)],Cc=u([Ri(Mi([32]),tu)]),Dc=Ji(Ec,fo.init,(function(n,t,e,r){var o=[37].concat(e.allowVertical?[38]:[]),i=[39].concat(e.allowVertical?[40]:[]);return[Ri(Mi(o),Tu(uu(wu,Su))),Ri(Mi(i),Tu(cu(wu,Su))),Ri(Mi([13]),bu),Ri(Mi([32]),bu),Ri(Mi([27]),Ou)]}),Cc,(function(){return Dn.some(xu)})),Mc=Z(["rowIndex","columnIndex","cell"],[]),Ic=[ze("selectors",[Pe("row"),Pe("cell")]),We("cycles",!0),We("previousSelector",Dn.none),We("execute",nu)],Fc=Fu((function(n,t,e){return Eu(n,t,e,-1)}),(function(n,t,e){return Du(n,t,e,-1)})),Ac=Fu((function(n,t,e){return Eu(n,t,e,1)}),(function(n,t,e){return Du(n,t,e,1)})),Rc=Fu((function(n,t,e){return Cu(n,e,t,-1)}),(function(n,t,e){return Mu(n,e,t,-1)})),Bc=Fu((function(n,t,e){return Cu(n,e,t,1)}),(function(n,t,e){return Mu(n,e,t,1)})),Vc=u([Ri(Mi([37]),uu(Fc,Ac)),Ri(Mi([39]),cu(Fc,Ac)),Ri(Mi([38]),pc(Rc)),Ri(Mi([40]),hc(Bc)),Ri(Mi([32].concat([13])),(function(n,t,e){return Yr(n.element()).bind((function(r){return e.execute(n,t,r)}))}))]),Nc=u([Ri(Mi([32]),tu)]),jc=Ji(Ic,fo.init,Vc,Nc,(function(){return Dn.some(Iu)})),_c=[Pe("selector"),We("execute",nu),We("moveOnTab",!1)],Pc=u([Ri(Mi([38]),vc(Bu)),Ri(Mi([40]),vc(Vu)),Ri(Ii([Fi,Mi([9])]),(function(n,t,e){return e.moveOnTab?vc(Bu)(n,t,e):Dn.none()})),Ri(Ii([Ui,Mi([9])]),(function(n,t,e){return e.moveOnTab?vc(Vu)(n,t,e):Dn.none()})),Ri(Mi([13]),Au),Ri(Mi([32]),Au)]),Hc=u([Ri(Mi([32]),tu)]),zc=Ji(_c,fo.init,Pc,Hc,(function(){return Dn.some(Ru)})),Lc=Ji([Eo("onSpace"),Eo("onEnter"),Eo("onShiftEnter"),Eo("onLeft"),Eo("onRight"),Eo("onTab"),Eo("onShiftTab"),Eo("onUp"),Eo("onDown"),Eo("onEscape"),We("stopSpaceKeyup",!1),Le("focusIn")],fo.init,(function(n,t,e){return[Ri(Mi([32]),e.onSpace),Ri(Ii([Ui,Mi([13])]),e.onEnter),Ri(Ii([Fi,Mi([13])]),e.onShiftEnter),Ri(Ii([Fi,Mi([9])]),e.onShiftTab),Ri(Ii([Ui,Mi([9])]),e.onTab),Ri(Mi([38]),e.onUp),Ri(Mi([40]),e.onDown),Ri(Mi([37]),e.onLeft),Ri(Mi([39]),e.onRight),Ri(Mi([32]),e.onSpace),Ri(Mi([27]),e.onEscape)]}),(function(n,t,e){return e.stopSpaceKeyup?[Ri(Mi([32]),tu)]:[]}),(function(n){return n.focusIn})),Gc=fc.schema(),Uc=sc.schema(),$c=Dc.schema(),Wc=kc.schema(),Xc=jc.schema(),qc=lc.schema(),Yc=zc.schema(),Kc=Lc.schema(),Jc=(ac=je("Creating behaviour: "+(cc={branchKey:"mode",branches:Object.freeze({acyclic:Gc,cyclic:Uc,flow:$c,flatgrid:Wc,matrix:Xc,execution:qc,menu:Yc,special:Kc}),name:"keying",active:{events:function(n,t){return n.handler.toEvents(n,t)}},apis:{focusIn:function(n,t,e){t.sendFocusIn(t).fold((function(){n.getSystem().triggerFocus(n.element(),n.element())}),(function(r){r(n,t,e)}))},setGridSize:function(t,e,r,o,i){On(r,"setGridSize")?r.setGridSize(o,i):n.console.error("Layout does not support setGridSize")}},state:dc}).name,go,cc),Zu=_e(ac.branchKey,ac.branches),nc=ac.name,tc=ac.active,ec=ac.apis,rc=ac.extra,oc=ac.state,uc=Ue(nc,[Ge("config",ic=Zu)]),ao(ic,uc,nc,tc,ec,rc,oc)),Qc=Nu,Zc=_u,na="placeholder",ta=me([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]),ea=function(n,e,r,i){return function(n,t,e,r){return e.uiType===na?function(n,t,e,r){return n.exists((function(n){return n!==e.owner}))?ta.single(!0,u(e)):Te(r,e.name).fold((function(){throw new Error("Unknown placeholder component: "+e.name+"\nKnown: ["+Mn(r)+"]\nNamespace: "+n.getOr("none")+"\nSpec: "+JSON.stringify(e,null,2))}),(function(n){return n.replace()}))}(n,0,e,r):ta.single(!1,u(e))}(n,0,r,i).fold((function(o,u){var c=u(e,r.config,r.validated),a=R(Te(c,"components").getOr([]),(function(t){return ea(n,e,t,i)}));return[t(t({},c),{components:a})]}),(function(n,t){var i=t(e,r.config,r.validated);return r.validated.preprocess.getOr(o)(i)}))},ra=ta.single,oa=ta.multiple,ia=u(na),ua=0,ca=me([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]),aa=We("factory",{sketch:o}),fa=We("schema",[]),sa=Pe("name"),la=gr("pname","pname",xe((function(n){return"<alloy."+Pu(n.name)+">"})),vr()),da=qe("schema",(function(){return[Le("preprocess")]})),ma=We("defaults",u({})),ga=We("overrides",u({})),pa=lr([aa,fa,sa,la,ma,ga]),ha=lr([aa,fa,sa,la,ma,ga]),va=lr([aa,da,sa,Pe("unit"),la,ma,ga]),ya=zu(ca.required,pa),ba=zu(ca.optional,ha),xa=zu(ca.group,va),wa=u("entirety"),Sa=Pu("alloy-premade"),Ta=u("alloy-id-"),Oa=u("data-alloy-id"),ka=Ta(),Ea=Oa(),Ca=function(n,t){Object.defineProperty(n.dom(),Ea,{value:t,writable:!0})},Da=function(n){var t=Qt(n)?n.dom()[Ea]:null;return Dn.from(t)},Ma=function(n){return n.hasOwnProperty("uid")?n:t(t({},n),{uid:Ku("uid")})};function Ia(n){var e=je("Sketcher for "+n.name,Qf,n),r=b(e.apis,Yu),o=b(e.extraApis,(function(n,t){return Mr(n,t)}));return t(t({name:u(e.name),partFields:u([]),configFields:u(e.configFields),sketch:function(n){return function(n,t,e,r){var o=Ma(r);return e(Ju(n,t,o,[],[]),o)}(e.name,e.configFields,e.factory,n)}},r),o)}function Fa(n){var e=je("Sketcher for "+n.name,Zf,n),r=function(n,e){var r={};return E(e,(function(e){(function(n){return n.fold(Dn.some,Dn.none,Dn.some,Dn.some)})(e).each((function(e){var o=function(n,t){return{uiType:ia(),owner:n,name:t}}(n,e.pname);r[e.name]=function(r){var i=je("Part: "+e.name+" in "+n,lr(e.schema),r);return t(t({},o),{config:r,validated:i})}}))})),r}(e.name,e.partFields),o=b(e.apis,Yu),i=b(e.extraApis,(function(n,t){return Mr(n,t)}));return t(t({name:u(e.name),partFields:u(e.partFields),configFields:u(e.configFields),sketch:function(n){return Qu(e.name,e.configFields,e.partFields,e.factory,n)},parts:u(r)},o),i)}function Aa(n){return{dom:es(n)}}function Ra(n){return lo([ci.config({toggleClass:di.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),ai(n,(function(n,t){(t?ci.on:ci.off)(n)}))])}function Ba(n,t){var e=t.ui.registry.getAll().icons;return Dn.from(e[n]).fold((function(){return es('<span class="${prefix}-toolbar-button ${prefix}-toolbar-group-item ${prefix}-icon-'+n+' ${prefix}-icon"></span>')}),(function(n){return es('<span class="${prefix}-toolbar-button ${prefix}-toolbar-group-item">'+n+"</span>")}))}function Va(n){return ba({name:n+"-edge",overrides:function(t){return t.model.manager.edgeActions[n].fold((function(){return{}}),(function(n){var e=Sr([kr(vt(),n,[t])]),r=Sr([kr(xt(),n,[t]),kr(wt(),(function(t,e){e.mouseIsDown.get()&&n(t,e)}),[t])]);return{events:is?e:r}}))}})}function Na(n,t,e){t.store.manager.onLoad(n,t,e)}function ja(n,t,e){t.store.manager.onUnload(n,t,e)}function _a(){var n=Bn(null);return so({set:n.set,get:n.get,isNotSet:function(){return null===n.get()},clear:function(){n.set(null)},readState:function(){return{mode:"memory",value:n.get()}}})}function Pa(){var n=Bn({}),e=Bn({});return so({readState:function(){return{mode:"dataset",dataByValue:n.get(),dataByText:e.get()}},lookup:function(t){return Te(n.get(),t).orThunk((function(){return Te(e.get(),t)}))},update:function(r){var o=n.get(),i=e.get(),u={},c={};E(r,(function(n){u[n.value]=n,Te(n,"meta").each((function(t){Te(t,"text").each((function(t){c[t]=n}))}))})),n.set(t(t({},o),u)),e.set(t(t({},i),c))},clear:function(){n.set({}),e.set({})}})}function Ha(n,t,e,r){var o=t.store;e.update([r]),o.setValue(n,r),t.onSetValue(n,r)}function za(n,t){Ss.set(n,t)}function La(n){return Ss.get(n)}function Ga(n){var t=n.event().raw();if(ks){var e=t;return void 0!==e.touches&&1===e.touches.length?Dn.some(e.touches[0]).map((function(n){return Os(n.clientX,n.clientY)})):Dn.none()}var r=t;return void 0!==r.clientX?Dn.some(r).map((function(n){return Os(n.clientX,n.clientY)})):Dn.none()}function Ua(n){return n.model.minX}function $a(n){return n.model.minY}function Wa(n){return n.model.minX-1}function Xa(n){return n.model.minY-1}function qa(n){return n.model.maxX}function Ya(n){return n.model.maxY}function Ka(n){return n.model.maxX+1}function Ja(n){return n.model.maxY+1}function Qa(n,t,e){return t(n)-e(n)}function Za(n){return Qa(n,qa,Ua)}function nf(n){return Qa(n,Ya,$a)}function tf(n){return Za(n)/2}function ef(n){return nf(n)/2}function rf(n){return n.stepSize}function of(n){return n.snapToGrid}function uf(n){return n.snapStart}function cf(n){return n.rounded}function af(n,t){return void 0!==n[t+"-edge"]}function ff(n){return af(n,"left")}function sf(n){return af(n,"right")}function lf(n){return af(n,"top")}function df(n){return af(n,"bottom")}function mf(n){return n.model.value.get()}function gf(n){return{x:u(n)}}function pf(n){return{y:u(n)}}function hf(n,t){return{x:u(n),y:u(t)}}function vf(n,t){G(n,Es(),{value:t})}function yf(n,t,e,r){return n<t?n:e<n?e:n===t?t-1:Math.max(t,n-r)}function bf(n,t,e,r){return e<n?n:n<t?t:n===e?e+1:Math.min(e,n+r)}function xf(n,t,e){return Math.max(t,Math.min(e,n))}function wf(n){var t=n.min,e=n.max,r=n.range,o=n.value,i=n.step,u=n.snap,c=n.snapStart,a=n.rounded,f=n.hasMinEdge,s=n.hasMaxEdge,l=n.minBound,d=n.maxBound,m=n.screenRange,g=f?t-1:t,p=s?e+1:e;if(o<l)return g;if(d<o)return p;var h=function(n,t,e){return Math.min(e,Math.max(n,t))-t}(o,l,d),v=xf(h/m*r+t,g,p);return u&&t<=v&&v<=e?function(n,t,e,r,o){return o.fold((function(){var o=n-t,i=Math.round(o/r)*r;return xf(t+i,t-1,e+1)}),(function(t){var o=(n-t)%r,i=Math.round(o/r),u=Math.floor((n-t)/r),c=Math.floor((e-t)/r),a=t+Math.min(c,u+i)*r;return Math.max(t,a)}))}(v,t,e,i,c):a?Math.round(v):v}function Sf(n){var t=n.min,e=n.max,r=n.range,o=n.value,i=n.hasMinEdge,u=n.hasMaxEdge,c=n.maxBound,a=n.maxOffset,f=n.centerMinEdge,s=n.centerMaxEdge;return o<t?i?0:f:e<o?u?c:s:(o-t)/r*a}function Tf(n){return n.element().dom().getBoundingClientRect()}function Of(n,t){return n[t]}function kf(n){return Of(Tf(n),Cs)}function Ef(n){return Of(Tf(n),"right")}function Cf(n){return Of(Tf(n),"top")}function Df(n){return Of(Tf(n),"bottom")}function Mf(n){return Of(Tf(n),"width")}function If(n){return Of(Tf(n),"height")}function Ff(n,t,e){return(n+t)/2-e}function Af(n,t){var e=Tf(n),r=Tf(t);return Ff(Of(e,Cs),Of(e,"right"),Of(r,Cs))}function Rf(n,t){var e=Tf(n),r=Tf(t);return Ff(Of(e,"top"),Of(e,"bottom"),Of(r,"top"))}function Bf(n,t){G(n,Es(),{value:t})}function Vf(n){return{x:u(n)}}function Nf(n,t,e){return wf({min:Ua(t),max:qa(t),range:Za(t),value:e,step:rf(t),snap:of(t),snapStart:uf(t),rounded:cf(t),hasMinEdge:ff(t),hasMaxEdge:sf(t),minBound:kf(n),maxBound:Ef(n),screenRange:Mf(n)})}function jf(n){return function(t,e){return function(n,t,e){var r=(0<n?bf:yf)(mf(e).x(),Ua(e),qa(e),rf(e));return Bf(t,Vf(r)),Dn.some(r)}(n,t,e).map((function(){return!0}))}}function _f(n,t,e,r,o,i){var u=function(n,t,e,r,o){var i=Mf(n),u=r.bind((function(t){return Dn.some(Af(t,n))})).getOr(0),c=o.bind((function(t){return Dn.some(Af(t,n))})).getOr(i);return Sf({min:Ua(t),max:qa(t),range:Za(t),value:e,hasMinEdge:ff(t),hasMaxEdge:sf(t),minBound:kf(n),minOffset:0,maxBound:Ef(n),maxOffset:i,centerMinEdge:u,centerMaxEdge:c})}(t,i,e,r,o);return kf(t)-kf(n)+u}function Pf(n,t){G(n,Es(),{value:t})}function Hf(n){return{y:u(n)}}function zf(n,t,e){return wf({min:$a(t),max:Ya(t),range:nf(t),value:e,step:rf(t),snap:of(t),snapStart:uf(t),rounded:cf(t),hasMinEdge:lf(t),hasMaxEdge:df(t),minBound:Cf(n),maxBound:Df(n),screenRange:If(n)})}function Lf(n){return function(t,e){return function(n,t,e){var r=(0<n?bf:yf)(mf(e).y(),$a(e),Ya(e),rf(e));return Pf(t,Hf(r)),Dn.some(r)}(n,t,e).map((function(){return!0}))}}function Gf(n,t,e,r,o,i){var u=function(n,t,e,r,o){var i=If(n),u=r.bind((function(t){return Dn.some(Rf(t,n))})).getOr(0),c=o.bind((function(t){return Dn.some(Rf(t,n))})).getOr(i);return Sf({min:$a(t),max:Ya(t),range:nf(t),value:e,hasMinEdge:lf(t),hasMaxEdge:df(t),minBound:Cf(n),minOffset:0,maxBound:Df(n),maxOffset:i,centerMinEdge:u,centerMaxEdge:c})}(t,i,e,r,o);return Cf(t)-Cf(n)+u}function Uf(n,t){G(n,Es(),{value:t})}function $f(n,t){return{x:u(n),y:u(t)}}function Wf(n,t){return function(e,r){return function(n,t,e,r){var o=0<n?bf:yf,i=t?mf(r).x():o(mf(r).x(),Ua(r),qa(r),rf(r));return Uf(e,$f(i,t?o(mf(r).y(),$a(r),Ya(r),rf(r)):mf(r).y())),Dn.some(i)}(n,t,e,r).map((function(){return!0}))}}function Xf(n,t,e,r){return os.forToolbar(t,(function(){var r=e();n.setContextToolbar([{label:t+" group",items:r}])}),{},r)}function qf(n){var t=n.selection.getStart(),e=qt.fromDom(t),r=qt.fromDom(n.getBody()),o=function(n,t){return(Qt(t)?Dn.some(t):cn(t).filter(Qt)).map((function(t){return wr(t,(function(n){return Go(n,"font-size").isSome()}),n).bind((function(n){return Go(n,"font-size")})).getOrThunk((function(){return Lo(t,"font-size")}))})).getOr("")}((function(n){return on(r,n)}),e);return I(Js,(function(n){return o===n})).getOr("medium")}function Yf(n){var e=function(n){return void 0!==n.uid}(n)&&On(n,"uid")?n.uid:Ku("memento");return{get:function(n){return n.getSystem().getByUid(e).getOrDie()},getOpt:function(n){return n.getSystem().getByUid(e).toOption()},asSpec:function(){return t(t({},n),{uid:e})}}}var Kf,Jf,Qf=Ae([Pe("name"),Pe("factory"),Pe("configFields"),We("apis",{}),We("extraApis",{})]),Zf=Ae([Pe("name"),Pe("factory"),Pe("configFields"),Pe("partFields"),We("apis",{}),We("extraApis",{})]),ns=Ia({name:"Button",factory:function(n){function e(t){return Te(n.dom,"attributes").bind((function(n){return Te(n,t)}))}var r=function(n){return Sr(A([n.map((function(n){return uo((function(t,e){n(t),e.stop()}))})).toArray(),jo()]))}(n.action),o=n.dom.tag;return{uid:n.uid,dom:n.dom,components:n.components,events:r,behaviours:Zc(n.buttonBehaviours,[pi.config({}),Jc.config({mode:"execution",useSpace:!0,useEnter:!0})]),domModification:{attributes:function(){if("button"!==o)return{role:e("role").getOr("button")};var n=e("type").getOr("button"),r=e("role").map((function(n){return{role:n}})).getOr({});return t({type:n},r)}()},eventOrder:n.eventOrder}},configFields:[We("uid",void 0),Pe("dom"),We("components",[]),Qc("buttonBehaviours",[pi,Jc]),Le("action"),Le("role"),We("eventOrder",{})]}),ts=Rr({fields:[],name:"unselecting",active:Object.freeze({events:function(n){return Sr([Tr(It(),u(!0))])},exhibit:function(n,t){return Ir({styles:{"-webkit-user-select":"none","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none"},attributes:{unselectable:"on"}})}})}),es=function(n){var e=function(n,t){return n.replace(/\$\{([^{}]*)\}/g,(function(n,e){var r=t[e];return function(n){var t=typeof n;return"string"==t||"number"==t}(r)?r.toString():n}))}(n,{prefix:di.prefix()});return function(n){var e=qt.fromHtml(n),r=oe(e),o=function(n){return M(void 0!==n.dom().attributes?n.dom().attributes:[],(function(n,e){var r;return"class"===e.name?n:t(t({},n),((r={})[e.name]=e.value,r))}),{})}(e),i=function(n){return Array.prototype.slice.call(n.dom().classList,0)}(e),u=0===r.length?{}:{innerHtml:Kr(e)};return t({tag:X(e),classes:i,attributes:o},u)}(e)},rs=function(n,t,e,r){return ns.sketch({dom:Ba(n,r),action:t,buttonBehaviours:pe(lo([ts.config({})]),e)})},os={forToolbar:rs,forToolbarCommand:function(n,t){return rs(t,(function(){n.execCommand(t)}),{},n)},forToolbarStateAction:function(n,t,e,r){var o=Ra(e);return rs(t,r,o,n)},forToolbarStateCommand:function(n,t){var e=Ra(t);return rs(t,(function(){n.execCommand(t)}),e,n)},getToolbarIconButton:Ba},is=z().deviceType.isTouch(),us=ba({schema:[Pe("dom")],name:"label"}),cs=Va("top-left"),as=Va("top"),fs=Va("top-right"),ss=Va("right"),ls=Va("bottom-right"),ds=Va("bottom"),ms=Va("bottom-left"),gs=[us,Va("left"),ss,as,ds,cs,fs,ms,ls,ya({name:"thumb",defaults:u({dom:{styles:{position:"absolute"}}}),overrides:function(n){return{events:Sr([Cr(vt(),n,"spectrum"),Cr(yt(),n,"spectrum"),Cr(bt(),n,"spectrum"),Cr(xt(),n,"spectrum"),Cr(wt(),n,"spectrum"),Cr(St(),n,"spectrum")])}}}),ya({schema:[qe("mouseIsDown",(function(){return Bn(!1)}))],name:"spectrum",overrides:function(n){function t(t,r){return e.getValueFromEvent(r).map((function(r){return e.setValueFrom(t,n,r)}))}var e=n.model.manager,r=Sr([Or(vt(),t),Or(yt(),t)]),o=Sr([Or(xt(),t),Or(wt(),(function(e,r){n.mouseIsDown.get()&&t(e,r)}))]);return{behaviours:lo(is?[]:[Jc.config({mode:"special",onLeft:function(t){return e.onLeft(t,n)},onRight:function(t){return e.onRight(t,n)},onUp:function(t){return e.onUp(t,n)},onDown:function(t){return e.onDown(t,n)}}),pi.config({})]),events:is?r:o}}})],ps=Object.freeze({onLoad:Na,onUnload:ja,setValue:function(n,t,e,r){t.store.manager.setValue(n,t,e,r)},getValue:function(n,t,e){return t.store.manager.getValue(n,t,e)},getState:function(n,t,e){return e}}),hs=Object.freeze({events:function(n,t){return Sr(n.resetOnDom?[ro((function(e,r){Na(e,n,t)})),oo((function(e,r){ja(e,n,t)}))]:[Fr(n,t,Na)])}}),vs=Object.freeze({memory:_a,dataset:Pa,manual:function(){return so({readState:function(){}})},init:function(n){return n.store.manager.state(n)}}),ys=[Le("initialValue"),Pe("getFallbackEntry"),Pe("getDataKey"),Pe("setValue"),Mo("manager",{setValue:Ha,getValue:function(n,t,e){var r=t.store,o=r.getDataKey(n);return e.lookup(o).fold((function(){return r.getFallbackEntry(o)}),(function(n){return n}))},onLoad:function(n,t,e){t.store.initialValue.each((function(r){Ha(n,t,e,r)}))},onUnload:function(n,t,e){e.clear()},state:Pa})],bs=[Pe("getValue"),We("setValue",r),Le("initialValue"),Mo("manager",{setValue:function(n,t,e,r){t.store.setValue(n,r),t.onSetValue(n,r)},getValue:function(n,t,e){return t.store.getValue(n)},onLoad:function(n,t,e){t.store.initialValue.each((function(e){t.store.setValue(n,e)}))},onUnload:r,state:fo.init})],xs=[Le("initialValue"),Mo("manager",{setValue:function(n,t,e,r){e.set(r),t.onSetValue(n,r)},getValue:function(n,t,e){return e.get()},onLoad:function(n,t,e){t.store.initialValue.each((function(n){e.isNotSet()&&e.set(n)}))},onUnload:function(n,t,e){e.clear()},state:_a})],ws=Rr({fields:[Xe("store",{mode:"memory"},_e("mode",{memory:xs,manual:bs,dataset:ys})),ko("onSetValue"),We("resetOnDom",!1)],name:"representing",active:hs,apis:ps,extra:{setValueFrom:function(n,t){var e=ws.getValue(t);ws.setValue(n,e)}},state:vs}),Ss=yi("width",(function(n){return n.dom().offsetWidth})),Ts=function(n,t){return{left:u(n),top:u(t),translate:function(e,r){return Ts(n+e,t+r)}}},Os=Ts,ks=z().deviceType.isTouch(),Es=u("slider.change.value"),Cs="left",Ds=jf(-1),Ms=jf(1),Is=Dn.none,Fs=Dn.none,As={"top-left":Dn.none(),top:Dn.none(),"top-right":Dn.none(),right:Dn.some((function(n,t){vf(n,gf(Ka(t)))})),"bottom-right":Dn.none(),bottom:Dn.none(),"bottom-left":Dn.none(),left:Dn.some((function(n,t){vf(n,gf(Wa(t)))}))},Rs=Object.freeze({setValueFrom:function(n,t,e){var r=Nf(n,t,e);return Bf(n,Vf(r)),r},setToMin:function(n,t){Bf(n,Vf(Ua(t)))},setToMax:function(n,t){Bf(n,Vf(qa(t)))},findValueOfOffset:Nf,getValueFromEvent:function(n){return Ga(n).map((function(n){return n.left()}))},findPositionOfValue:_f,setPositionFromValue:function(n,t,e,r){var o=mf(e),i=_f(n,r.getSpectrum(n),o.x(),r.getLeftEdge(n),r.getRightEdge(n),e),u=La(t.element())/2;hi(t.element(),"left",i-u+"px")},onLeft:Ds,onRight:Ms,onUp:Is,onDown:Fs,edgeActions:As}),Bs=Dn.none,Vs=Dn.none,Ns=Lf(-1),js=Lf(1),_s={"top-left":Dn.none(),top:Dn.some((function(n,t){vf(n,pf(Xa(t)))})),"top-right":Dn.none(),right:Dn.none(),"bottom-right":Dn.none(),bottom:Dn.some((function(n,t){vf(n,pf(Ja(t)))})),"bottom-left":Dn.none(),left:Dn.none()},Ps=Object.freeze({setValueFrom:function(n,t,e){var r=zf(n,t,e);return Pf(n,Hf(r)),r},setToMin:function(n,t){Pf(n,Hf($a(t)))},setToMax:function(n,t){Pf(n,Hf(Ya(t)))},findValueOfOffset:zf,getValueFromEvent:function(n){return Ga(n).map((function(n){return n.top()}))},findPositionOfValue:Gf,setPositionFromValue:function(n,t,e,r){var o=mf(e),i=Gf(n,r.getSpectrum(n),o.y(),r.getTopEdge(n),r.getBottomEdge(n),e),u=bi(t.element())/2;hi(t.element(),"top",i-u+"px")},onLeft:Bs,onRight:Vs,onUp:Ns,onDown:js,edgeActions:_s}),Hs=Wf(-1,!1),zs=Wf(1,!1),Ls=Wf(-1,!0),Gs=Wf(1,!0),Us={"top-left":Dn.some((function(n,t){vf(n,hf(Wa(t),Xa(t)))})),top:Dn.some((function(n,t){vf(n,hf(tf(t),Xa(t)))})),"top-right":Dn.some((function(n,t){vf(n,hf(Ka(t),Xa(t)))})),right:Dn.some((function(n,t){vf(n,hf(Ka(t),ef(t)))})),"bottom-right":Dn.some((function(n,t){vf(n,hf(Ka(t),Ja(t)))})),bottom:Dn.some((function(n,t){vf(n,hf(tf(t),Ja(t)))})),"bottom-left":Dn.some((function(n,t){vf(n,hf(Wa(t),Ja(t)))})),left:Dn.some((function(n,t){vf(n,hf(Wa(t),ef(t)))}))},$s=Object.freeze({setValueFrom:function(n,t,e){var r=$f(Nf(n,t,e.left()),zf(n,t,e.top()));return Uf(n,r),r},setToMin:function(n,t){Uf(n,$f(Ua(t),$a(t)))},setToMax:function(n,t){Uf(n,$f(qa(t),Ya(t)))},getValueFromEvent:function(n){return Ga(n)},setPositionFromValue:function(n,t,e,r){var o=mf(e),i=_f(n,r.getSpectrum(n),o.x(),r.getLeftEdge(n),r.getRightEdge(n),e),u=Gf(n,r.getSpectrum(n),o.y(),r.getTopEdge(n),r.getBottomEdge(n),e),c=La(t.element())/2,a=bi(t.element())/2;hi(t.element(),"left",i-c+"px"),hi(t.element(),"top",u-a+"px")},onLeft:Hs,onRight:zs,onUp:Ls,onDown:Gs,edgeActions:Us}),Ws=z().deviceType.isTouch(),Xs=[We("stepSize",1),We("onChange",r),We("onChoose",r),We("onInit",r),We("onDragStart",r),We("onDragEnd",r),We("snapToGrid",!1),We("rounded",!0),Le("snapStart"),He("model",_e("mode",{x:[We("minX",0),We("maxX",100),qe("value",(function(n){return Bn(n.mode.minX)})),Pe("getInitialValue"),Mo("manager",Rs)],y:[We("minY",0),We("maxY",100),qe("value",(function(n){return Bn(n.mode.minY)})),Pe("getInitialValue"),Mo("manager",Ps)],xy:[We("minX",0),We("maxX",100),We("minY",0),We("maxY",100),qe("value",(function(n){return Bn({x:u(n.mode.minX),y:u(n.mode.minY)})})),Pe("getInitialValue"),Mo("manager",$s)]})),Nu("sliderBehaviours",[Jc,ws])].concat(Ws?[]:[qe("mouseIsDown",(function(){return Bn(!1)}))]),qs=z().deviceType.isTouch(),Ys=Fa({name:"Slider",configFields:Xs,partFields:gs,factory:function(n,t,e,r){function o(t){return Wu(t,n,"thumb")}function i(t){return Wu(t,n,"spectrum")}function c(t){return $u(t,n,"left-edge")}function a(t){return $u(t,n,"right-edge")}function f(t){return $u(t,n,"top-edge")}function s(t){return $u(t,n,"bottom-edge")}function l(t,e){g.setPositionFromValue(t,e,n,{getLeftEdge:c,getRightEdge:a,getTopEdge:f,getBottomEdge:s,getSpectrum:i})}function d(t,e){m.value.set(e);var r=o(t);return l(t,r),n.onChange(t,r,e),Dn.some(!0)}var m=n.model,g=m.manager,p=[Or(vt(),(function(t,e){n.onDragStart(t,o(t))})),Or(bt(),(function(t,e){n.onDragEnd(t,o(t))}))],h=[Or(xt(),(function(t,e){e.stop(),n.onDragStart(t,o(t)),n.mouseIsDown.set(!0)})),Or(St(),(function(t,e){n.onDragEnd(t,o(t))}))],v=qs?p:h;return{uid:n.uid,dom:n.dom,components:t,behaviours:_u(n.sliderBehaviours,A([qs?[]:[Jc.config({mode:"special",focusIn:function(t){return $u(t,n,"spectrum").map(Jc.focusIn).map(u(!0))}})],[ws.config({store:{mode:"manual",getValue:function(n){return m.value.get()}}}),ti.config({channels:{"mouse.released":{onReceive:function(t,e){function r(){$u(t,n,"thumb").each((function(e){var r=m.value.get();n.onChoose(t,e,r)}))}if(qs)r();else{var o=n.mouseIsDown.get();n.mouseIsDown.set(!1),o&&r()}}}}})]])),events:Sr([Or(Es(),(function(n,t){d(n,t.event().value())})),ro((function(t,e){var r=m.getInitialValue();m.value.set(r);var u=o(t);l(t,u);var c=i(t);n.onInit(t,u,c,m.value.get())}))].concat(v)),apis:{resetToMin:function(t){g.setToMin(t,n)},resetToMax:function(t){g.setToMax(t,n)},changeValue:d,refresh:l},domModification:{styles:{position:"relative"}}}},apis:{resetToMin:function(n,t){n.resetToMin(t)},resetToMax:function(n,t){n.resetToMax(t)},refresh:function(n,t){n.refresh(t)}}}),Ks=Ae([Pe("getInitialValue"),Pe("onChange"),Pe("category"),Pe("sizes")]),Js=["9px","10px","11px","12px","14px","16px","18px","20px","24px","32px","36px"],Qs={candidates:u(Js),get:function(n){return function(n){return F(Js,(function(t){return t===n}))}(qf(n)).getOr(2)},apply:function(n,t){(function(n){return Dn.from(Js[n])})(t).each((function(t){!function(n,t){qf(n)!==t&&n.execCommand("fontSize",!1,t)}(n,t)}))}},Zs=Qs.candidates(),nl=window.Promise?window.Promise:(Kf=tl.immediateFn||"function"==typeof window.setImmediate&&window.setImmediate||function(t){n.setTimeout(t,1)},Jf=Array.isArray||function(n){return"[object Array]"===Object.prototype.toString.call(n)},tl.prototype.catch=function(n){return this.then(null,n)},tl.prototype.then=function(n,t){var e=this;return new tl((function(r,o){rl.call(e,new cl(n,t,r,o))}))},tl.all=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var e=Array.prototype.slice.call(1===n.length&&Jf(n[0])?n[0]:n);return new tl((function(n,t){if(0===e.length)return n([]);var r=e.length;function o(i,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var c=u.then;if("function"==typeof c)return void c.call(u,(function(n){o(i,n)}),t)}e[i]=u,0==--r&&n(e)}catch(n){t(n)}}for(var i=0;i<e.length;i++)o(i,e[i])}))},tl.resolve=function(n){return n&&"object"==typeof n&&n.constructor===tl?n:new tl((function(t){t(n)}))},tl.reject=function(n){return new tl((function(t,e){e(n)}))},tl.race=function(n){return new tl((function(t,e){for(var r=0,o=n;r<o.length;r++)o[r].then(t,e)}))},tl);function tl(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],al(n,el(ol,this),el(il,this))}function el(n,t){return function(){return n.apply(t,arguments)}}function rl(n){var t=this;null!==this._state?Kf((function(){var e=t._state?n.onFulfilled:n.onRejected;if(null!==e){var r;try{r=e(t._value)}catch(t){return void n.reject(t)}n.resolve(r)}else(t._state?n.resolve:n.reject)(t._value)})):this._deferreds.push(n)}function ol(n){try{if(n===this)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if("function"==typeof t)return void al(el(t,n),el(ol,this),el(il,this))}this._state=!0,this._value=n,ul.call(this)}catch(n){il.call(this,n)}}function il(n){this._state=!1,this._value=n,ul.call(this)}function ul(){for(var n=0,t=this._deferreds;n<t.length;n++){var e=t[n];rl.call(this,e)}this._deferreds=[]}function cl(n,t,e,r){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof t?t:null,this.resolve=e,this.reject=r}function al(n,t,e){var r=!1;try{n((function(n){r||(r=!0,t(n))}),(function(n){r||(r=!0,e(n))}))}catch(n){if(r)return;r=!0,e(n)}}function fl(t,e){(function(t){return function(t){return function(t){return new nl((function(e){var r=new n.FileReader;r.onloadend=function(){e(r.result)},r.readAsDataURL(t)}))}(t).then((function(n){return n.split(",")[1]}))}(t)})(e).then((function(n){t.undoManager.transact((function(){var r=t.editorUpload.blobCache,o=r.create(Pu("mceu"),e,n);r.add(o);var i=t.dom.createHTML("img",{src:o.blobUri()});t.insertContent(i)}))}))}function sl(n){return n.dom().textContent}function ll(n){return 0<n.length}function dl(n){return null==n?"":n}function ml(n,t){var e=t.selection.getRng();n(),t.selection.setRng(e)}function gl(n){return n.dom().value}function pl(n,t){if(void 0===t)throw new Error("Value.set was undefined");n.dom().value=t}function hl(n){return t(t({},function(n){return lo([pi.config({onFocus:!1===n.selectOnFocus?r:function(n){var t=n.element(),e=gl(t);t.dom().setSelectionRange(0,e.length)}})])}(n)),_u(n.inputBehaviours,[ws.config({store:{mode:"manual",initialValue:n.data.getOr(void 0),getValue:function(n){return gl(n.element())},setValue:function(n,t){gl(n.element())!==t&&pl(n.element(),t)}},onSetValue:n.onSetValue})]))}function vl(n,t){var e=Yf(sd.sketch({inputAttributes:{placeholder:md.translate(t)},onSetValue:function(n,t){L(n,Et())},inputBehaviours:lo([cd.config({find:Dn.some}),dd.config({}),Jc.config({mode:"execution"})]),selectOnFocus:!1})),r=Yf(ns.sketch({dom:es('<button class="${prefix}-input-container-x ${prefix}-icon-cancel-circle ${prefix}-icon"></button>'),action:function(n){var t=e.get(n);ws.setValue(t,"")}}));return{name:n,spec:ad.sketch({dom:es('<div class="${prefix}-input-container"></div>'),components:[e.asSpec(),r.asSpec()],containerBehaviours:lo([ci.config({toggleClass:di.resolve("input-container-empty")}),cd.config({find:function(n){return Dn.some(e.get(n))}}),id("input-clearing",[Or(Et(),(function(n){var t=e.get(n);(0<ws.getValue(t).length?ci.off:ci.on)(n)}))])])})}}function yl(n,t,e){t.disabled&&pd(n,t)}function bl(n,t){return!0===t.useNative&&O(gd,X(n.element()))}function xl(n){Vr(n.element(),"disabled","disabled")}function wl(n){Pr(n.element(),"disabled")}function Sl(n){Vr(n.element(),"aria-disabled","true")}function Tl(n){Vr(n.element(),"aria-disabled","false")}function Ol(n,t,e){t.disableClass.each((function(t){Gr(n.element(),t)})),(bl(n,t)?wl:Tl)(n),t.onEnabled(n)}function kl(n,t){return bl(n,t)?function(n){return _r(n.element(),"disabled")}(n):function(n){return"true"===jr(n.element(),"aria-disabled")}(n)}function El(n){return"<alloy.field."+n+">"}function Cl(){function n(){t.get().each((function(n){n.destroy()}))}var t=Bn(Dn.none());return{clear:function(){n(),t.set(Dn.none())},isSet:function(){return t.get().isSome()},set:function(e){n(),t.set(Dn.some(e))},run:function(n){t.get().each(n)}}}function Dl(){var n=Bn(Dn.none());return{clear:function(){n.set(Dn.none())},set:function(t){n.set(Dn.some(t))},isSet:function(){return n.get().isSome()},on:function(t){n.get().each(t)}}}function Ml(n){function t(n,t,e){return ns.sketch({dom:es('<span class="${prefix}-icon-'+t+' ${prefix}-icon"></span>'),action:function(t){G(t,o,{direction:n})},buttonBehaviours:lo([yd.config({disableClass:di.resolve("toolbar-navigation-disabled"),disabled:!e})])})}function e(n,t){var e=xi(n.element(),"."+di.resolve("serialised-dialog-screen"));Ti(n.element(),"."+di.resolve("serialised-dialog-chain")).each((function(n){0<=i.state.currentScreen.get()+t&&i.state.currentScreen.get()+t<e.length&&(Go(n,"left").each((function(r){var o=parseInt(r,10),i=La(e[0]);hi(n,"left",o-t*i+"px")})),i.state.currentScreen.set(i.state.currentScreen.get()+t))}))}function r(n){var t=xi(n.element(),"input");Dn.from(t[i.state.currentScreen.get()]).each((function(t){n.getSystem().getByDom(t).each((function(t){!function(n,t){n.getSystem().triggerFocus(t,n.element())}(n,t.element())}))}));var e=c.get(n);Ki.highlightAt(e,i.state.currentScreen.get())}var o="navigateEvent",i=je("SerialisedDialog",lr([Pe("fields"),We("maxFieldIndex",n.fields.length-1),Pe("onExecute"),Pe("getInitialValue"),qe("state",(function(){return{dialogSwipeState:Dl(),currentScreen:Bn(0)}}))]),n),u=Yf(wd((function(n){return{dom:es('<div class="${prefix}-serialised-dialog"></div>'),components:[ad.sketch({dom:es('<div class="${prefix}-serialised-dialog-chain" style="left: 0px; position: absolute;"></div>'),components:st(i.fields,(function(e,r){return r<=i.maxFieldIndex?ad.sketch({dom:es('<div class="${prefix}-serialised-dialog-screen"></div>'),components:[t(-1,"previous",0<r),n.field(e.name,e.spec),t(1,"next",r<i.maxFieldIndex)]}):n.field(e.name,e.spec)}))})],formBehaviours:lo([fi((function(n,t){!function(n,t){Ti(n.element(),"."+di.resolve("serialised-dialog-chain")).each((function(n){hi(n,"left",-i.state.currentScreen.get()*t.width+"px")}))}(n,t)})),Jc.config({mode:"special",focusIn:function(n){r(n)},onTab:function(n){return e(n,1),Dn.some(!0)},onShiftTab:function(n){return e(n,-1),Dn.some(!0)}}),id("form-events",[ro((function(n,t){i.state.currentScreen.set(0),i.state.dialogSwipeState.clear();var e=c.get(n);Ki.highlightFirst(e),i.getInitialValue(n).each((function(t){ws.setValue(n,t)}))})),uo(i.onExecute),Or(Mt(),(function(n,t){"left"===t.event().raw().propertyName&&r(n)})),Or(o,(function(n,t){e(n,t.event().direction())}))])])}}))),c=Yf({dom:es('<div class="${prefix}-dot-container"></div>'),behaviours:lo([Ki.config({highlightClass:di.resolve("dot-active"),itemClass:di.resolve("dot-item")})]),components:R(i.fields,(function(n,t){return t<=i.maxFieldIndex?[Aa('<div class="${prefix}-dot-item ${prefix}-icon-full-dot ${prefix}-icon"></div>')]:[]}))});return{dom:es('<div class="${prefix}-serializer-wrapper"></div>'),components:[u.asSpec(),c.asSpec()],behaviours:lo([Jc.config({mode:"special",focusIn:function(n){var t=u.get(n);Jc.focusIn(t)}}),id("serializer-wrapper-events",[Or(vt(),(function(n,t){var e=t.event();i.state.dialogSwipeState.set(Sd(e.raw().touches[0].clientX))})),Or(yt(),(function(n,t){var e=t.event();i.state.dialogSwipeState.on((function(n){t.event().prevent(),i.state.dialogSwipeState.set(Td(n,e.raw().touches[0].clientX))}))})),Or(bt(),(function(n){i.state.dialogSwipeState.on((function(t){e(u.get(n),-1*Od(t))}))}))])])}}function Il(n){function t(t){return function(){throw new Error("The component must be in a context to send: "+t+"\n"+Jr(n().element())+" is not in context.")}}return{debugInfo:u("fake"),triggerEvent:t("triggerEvent"),triggerFocus:t("triggerFocus"),triggerEscape:t("triggerEscape"),build:t("build"),addToWorld:t("addToWorld"),removeFromWorld:t("removeFromWorld"),addToGui:t("addToGui"),removeFromGui:t("removeFromGui"),getByUid:t("getByUid"),getByDom:t("getByDom"),broadcast:t("broadcast"),broadcastOn:t("broadcastOn"),broadcastEvent:t("broadcastEvent"),isConnected:u(!1)}}function Fl(n,t){var e={};return Fn(n,(function(n,r){Fn(n,(function(n,o){var i=wn(o,[])(e);e[o]=i.concat([t(r,n)])}))})),e}function Al(n){return n.cHandler}function Rl(n,t){return{name:u(n),handler:u(t)}}function Bl(n,t){E(t,(function(t){Lr(n,t)}))}function Vl(n,t){E(t,(function(t){Gr(n,t)}))}function Nl(e){function r(){return m}var o=Bn(Id),i=Ne(function(n){return Ve("custom.definition",lr([gr("dom","dom",ye(),lr([Pe("tag"),We("styles",{}),We("classes",[]),We("attributes",{}),Le("value"),Le("innerHtml")])),Pe("components"),Pe("uid"),We("events",{}),We("apis",{}),gr("eventOrder","eventOrder",ve.mergeWithThunk(u({"alloy.execute":["disabling","alloy.base.behaviour","toggling","typeaheadevents"],"alloy.focus":["alloy.base.behaviour","focusing","keying"],"alloy.system.init":["alloy.base.behaviour","disabling","toggling","representing"],input:["alloy.base.behaviour","representing","streaming","invalidating"],"alloy.system.detached":["alloy.base.behaviour","representing","item-events","tooltipping"],mousedown:["focusing","alloy.base.behaviour","item-type-events"],touchstart:["focusing","alloy.base.behaviour","item-type-events"],mouseover:["item-type-events","tooltipping"]})),vr()),Le("domModification")]),n)}(e)),c=function(n){var t=function(n){var t=wn("behaviours",{})(n),e=C(Mn(t),(function(n){return void 0!==t[n]}));return st(e,(function(n){return t[n].me}))}(n);return function(n,t){return function(n,t){var e=st(t,(function(n){return Ue(n.name(),[Pe("config"),We("state",fo)])})),r=Ve("component.behaviours",lr(e),n.behaviours).fold((function(t){throw new Error(hr(t)+"\nComplete spec:\n"+JSON.stringify(n,null,2))}),(function(n){return n}));return{list:t,data:b(r,(function(n){var t=n.map((function(n){return{config:n.config,state:n.state.init(n.config)}}));return function(){return t}}))}}(n,t)}(n,t)}(e),a=function(n){return n.list}(c),f=function(n){return n.data}(c),s=function(t){var e=qt.fromTag(t.tag);Nr(e,t.attributes),Bl(e,t.classes),zo(e,t.styles),t.innerHtml.each((function(t){return function(t,e){var r=un(t).dom(),o=qt.fromDom(r.createDocumentFragment()),i=function(t,e){var r=(e||n.document).createElement("div");return r.innerHTML=t,oe(qt.fromDom(r))}(e,r);dn(o,i),mn(t),ie(t,o)}(e,t)}));var r=t.domChildren;return dn(e,r),t.value.each((function(n){pl(e,n)})),t.uid,Ca(e,t.uid),e}(function(n,e,r){var o=function(n){return t(t({},n.dom),{uid:n.uid,domChildren:st(n.components,(function(n){return n.element()}))})}(n),i=function(n){return n.domModification.fold((function(){return Ir({})}),Ir)}(n),u={"alloy.base.modification":i};return function(n,e){return t(t({},n),{attributes:t(t({},n.attributes),e.attributes),styles:t(t({},n.styles),e.styles),classes:n.classes.concat(e.classes)})}(o,0<e.length?function(n,e,r,o){var i=t({},e);function u(n){return D(n,(function(n,e){return t(t({},e.modification),n)}),{})}E(r,(function(t){i[t.name()]=t.exhibit(n,o)}));var c=Fl(i,(function(n,t){return{name:n,modification:t}})),a=D(c.classes,(function(n,t){return t.modification.concat(n)}),[]);return Ir({classes:a,attributes:u(c.attributes),styles:u(c.styles)})}(r,u,e,o):i)}(i,a,f)),l=function(n,e,r){var o={"alloy.base.behaviour":function(n){return n.events}(n)};return function(n,e,r,o){var i=function(n,e,r){var o=t(t({},r),function(n,t){var e={};return E(n,(function(n){e[n.name()]=n.handlers(t)})),e}(e,n));return Fl(o,Rl)}(n,r,o);return Fd(i,e)}(r,n.eventOrder,e,o).getOrDie()}(i,a,f),d=Bn(i.components),m={getSystem:o.get,config:function(n){var t=f;return(it(t[n.name()])?t[n.name()]:function(){throw new Error("Could not find "+n.name()+" in "+JSON.stringify(e,null,2))})()},hasConfigured:function(n){return it(f[n.name()])},spec:u(e),readState:function(n){return f[n]().map((function(n){return n.state.readState()})).getOr("not enabled")},getApis:function(){return i.apis},connect:function(n){o.set(n)},disconnect:function(){o.set(Il(r))},element:u(s),syncComponents:function(){var n=R(oe(s),(function(n){return o.get().getByDom(n).fold((function(){return[]}),(function(n){return[n]}))}));d.set(n)},components:d.get,events:u(l)};return m}function jl(n){var t=qt.fromText(n);return Ad({element:t})}function _l(n){(Yr(n.element()).isNone()||pi.isFocused(n))&&(pi.isFocused(n)||pi.focus(n),G(n,Nd,{item:n}))}function Pl(n){G(n,jd,{item:n})}function Hl(n,t,e,r){var o=n.getSystem().build(r);fe(n,o,e)}function zl(n,t,e,r){I(Yd(n),(function(n){return on(r.element(),n.element())})).each(pn)}function Ll(n,t,e,r,o){var i=Yd(n);return Dn.from(i[r]).map((function(t){return zl(n,0,0,t),o.each((function(t){Hl(n,0,(function(n,t){!function(n,t,e){an(n,e).fold((function(){ie(n,t)}),(function(n){fn(n,t)}))}(n,t,r)}),t)})),t}))}function Gl(n,t,e,r){return Te(t.routes,r.start).bind((function(n){return Te(n,r.destination)}))}function Ul(n,t,e){(function(n,t,e){return rm(n,t).bind((function(r){return em(n,t,e,r)}))})(n,t,e).each((function(e){var r=e.transition;Gr(n.element(),r.transitionClass),Pr(n.element(),t.destinationAttr)}))}function $l(n,t,e,r){Ul(n,t,e),_r(n.element(),t.stateAttr)&&jr(n.element(),t.stateAttr)!==r&&t.onFinish(n,r),Vr(n.element(),t.stateAttr,r)}function Wl(n){return Te(n,"format").getOr(n.title)}function Xl(n){var t=n.replace(/\|/g," ").trim();return 0<t.length?t.split(/\s+/):[]}function ql(n){function t(){n.stopPropagation()}function e(){n.preventDefault()}var r=qt.fromDom(n.target),o=i(e,t);return function(n,t,e,r,o,i,c){return{target:u(n),x:u(t),y:u(e),stop:r,prevent:o,kill:i,raw:u(c)}}(r,n.clientX,n.clientY,t,e,o,n)}function Yl(n,t,e,r,o){var i=function(n,t){return function(e){n(e)&&t(ql(e))}}(e,r);return n.dom().addEventListener(t,i,o),{unbind:c(hm,n,t,i,o)}}function Kl(n,t,e){return function(n,t,e,r){return Yl(n,t,e,r,!1)}(n,t,vm,e)}function Jl(n,t,e){return function(n,t,e,r){return Yl(n,t,e,r,!0)}(n,t,vm,e)}function Ql(n){var t=n.matchMedia("(orientation: portrait)").matches;return{isPortrait:u(t)}}var Zl,nd,td=function(n){return Oi(qt.fromDom(n.selection.getStart()),"a")},ed=td,rd=z(),od=function(n,t){(rd.os.isAndroid()?ml:s)(t,n)},id=function(n,t){return{key:n,value:{config:{},me:function(n,t){var e=Sr(t);return Rr({fields:[Pe("enabled")],name:n,active:{events:u(e)}})}(n,t),configAsRaw:u({}),initialConfig:{},state:fo}}},ud=Object.freeze({getCurrent:function(n,t,e){return t.find(n)}}),cd=Rr({fields:[Pe("find")],name:"composing",apis:ud}),ad=Ia({name:"Container",factory:function(n){var r=n.dom,o=r.attributes,i=e(r,["attributes"]);return{uid:n.uid,dom:t({tag:"div",attributes:t({role:"presentation"},o)},i),components:n.components,behaviours:ju(n.containerBehaviours),events:n.events,domModification:n.domModification,eventOrder:n.eventOrder}},configFields:[We("components",[]),Nu("containerBehaviours",[]),We("events",{}),We("domModification",{}),We("eventOrder",{})]}),fd=Ia({name:"DataField",factory:function(n){return{uid:n.uid,dom:n.dom,behaviours:Zc(n.dataBehaviours,[ws.config({store:{mode:"memory",initialValue:n.getInitialValue()}}),cd.config({find:Dn.some})]),events:Sr([ro((function(t,e){ws.setValue(t,n.getInitialValue())}))])}},configFields:[Pe("uid"),Pe("dom"),Pe("getInitialValue"),Qc("dataBehaviours",[ws,cd])]}),sd=Ia({name:"Input",configFields:u([Le("data"),We("inputAttributes",{}),We("inputStyles",{}),We("tag","input"),We("inputClasses",[]),ko("onSetValue"),We("styles",{}),We("eventOrder",{}),Nu("inputBehaviours",[ws,pi]),We("selectOnFocus",!0)])(),factory:function(n,e){return{uid:n.uid,dom:function(n){return{tag:n.tag,attributes:t({type:"text"},n.inputAttributes),styles:n.inputStyles,classes:n.inputClasses}}(n),components:[],behaviours:hl(n),eventOrder:n.eventOrder}}}),ld=Object.freeze({exhibit:function(n,t){return Ir({attributes:Tn([{key:t.tabAttr,value:"true"}])})}}),dd=Rr({fields:[We("tabAttr","data-alloy-tabstop")],name:"tabstopping",active:ld}),md=tinymce.util.Tools.resolve("tinymce.util.I18n"),gd=["input","button","textarea","select"],pd=function(n,t,e){t.disableClass.each((function(t){Lr(n.element(),t)})),(bl(n,t)?xl:Sl)(n),t.onDisabled(n)},hd=Object.freeze({enable:Ol,disable:pd,isDisabled:kl,onLoad:yl,set:function(n,t,e,r){(r?pd:Ol)(n,t,e)}}),vd=Object.freeze({exhibit:function(n,t,e){return Ir({classes:t.disabled?t.disableClass.map(j).getOr([]):[]})},events:function(n,t){return Sr([Tr(Nt(),(function(t,e){return kl(t,n)})),Fr(n,t,yl)])}}),yd=Rr({fields:[We("disabled",!1),We("useNative",!0),Le("disableClass"),ko("onDisabled"),ko("onEnabled")],name:"disabling",active:vd,apis:hd}),bd=[Nu("formBehaviours",[ws])],xd=function(n,t,e){return{uid:n.uid,dom:n.dom,components:t,behaviours:_u(n.formBehaviours,[ws.config({store:{mode:"manual",getValue:function(t){var e=function(n,t){var e=n.getSystem();return b(t.partUids,(function(n,t){return u(e.getByUid(n))}))}(t,n);return b(e,(function(n,t){return n().bind((function(n){return function(n){return n.fold((function(){return de.error("missing current")}),de.value)}(cd.getCurrent(n))})).map(ws.getValue)}))},setValue:function(t,e){Fn(e,(function(e,r){$u(t,n,r).each((function(n){cd.getCurrent(n).each((function(n){ws.setValue(n,e)}))}))}))}}})]),apis:{getField:function(t,e){return $u(t,n,e).bind(cd.getCurrent)}}}},wd=(Yu((function(n,t,e){return n.getField(t,e)})),function(n){var t,e=(t=[],{field:function(n,e){return t.push(n),function(n,t,e){return{uiType:ia(),owner:"form",name:t,config:e,validated:{}}}(0,El(n),e)},record:function(){return t}}),r=n(e),o=e.record(),i=st(o,(function(n){return ya({name:n,pname:El(n)})}));return Qu("form",bd,i,xd,r)}),Sd=function(n){return{xValue:n,points:[]}},Td=function(n,t){if(t===n.xValue)return n;var e=0<t-n.xValue?1:-1,r={direction:e,xValue:t};return{xValue:t,points:(0===n.points.length?[]:n.points[n.points.length-1].direction===e?n.points.slice(0,n.points.length-1):n.points).concat([r])}},Od=function(n){if(0===n.points.length)return 0;var t=n.points[0].direction,e=n.points[n.points.length-1].direction;return-1===t&&-1===e?-1:1===t&&1===e?1:0},kd=W((function(n,t){return[{label:"the link group",items:[Ml({fields:[vl("url","Type or paste URL"),vl("text","Link text"),vl("title","Link title"),vl("target","Link target"),{name:"link",spec:fd.sketch({dom:{tag:"span",styles:{display:"none"}},getInitialValue:function(){return Dn.none()}})}],maxFieldIndex:3,getInitialValue:function(){return Dn.some(function(n){return td(n).fold((function(){return function(n){return{url:"",text:n.selection.getContent({format:"text"}),title:"",target:"",link:Dn.none()}}(n)}),(function(n){return function(n){var t=sl(n),e=jr(n,"href"),r=jr(n,"title"),o=jr(n,"target");return{url:dl(e),text:t!==e?dl(t):"",title:dl(r),target:dl(o),link:Dn.some(n)}}(n)}))}(t))},onExecute:function(e){var r=ws.getValue(e);(function(n,t){t.url.toOption().filter(ll).fold((function(){!function(n,t){t.link.bind(o).each((function(t){n.execCommand("unlink")}))}(n,t)}),(function(e){var r=function(n,t){var e={};return e.href=n,t.title.toOption().filter(ll).each((function(n){e.title=n})),t.target.toOption().filter(ll).each((function(n){e.target=n})),e}(e,t);t.link.bind(o).fold((function(){var o=t.text.toOption().filter(ll).getOr(e);n.insertContent(n.dom.createHTML("a",r,n.dom.encode(o)))}),(function(n){var o=function(n,t,e){return e.text.toOption().filter(ll).fold((function(){return function(n){return jr(n,"href")===sl(n)}(n)?Dn.some(t):Dn.none()}),Dn.some)}(n,e,t);Nr(n,r),o.each((function(t){!function(n,t){n.dom().textContent=t}(n,t)}))}))}))})(t,r),n.restoreToolbar(),t.focus()}})]}]})),Ed=[{title:"Headings",items:[{title:"Heading 1",format:"h1"},{title:"Heading 2",format:"h2"},{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]}],Cd=Sr([(Zl=At(),nd=function(t,e){var r=e.event().originator(),o=e.event().target();return!function(n,t,e){return on(t,n.element())&&!on(t,e)}(t,r,o)||(n.console.warn(At()+" did not get interpreted by the desired target. \nOriginator: "+Jr(r)+"\nTarget: "+Jr(o)+"\nCheck the "+At()+" event handlers"),!1)},{key:Zl,value:Ke({can:nd})})]),Dd=Object.freeze({events:Cd}),Md=o,Id=Il(),Fd=function(n,t){var e=Rn(n,(function(n,e){return(1===n.length?de.value(n[0].handler()):function(n,t,e){var r=t[e];return r?function(n,t,e,r){var o=e.slice(0);try{var i=o.sort((function(e,o){var i=e[t](),u=o[t](),c=r.indexOf(i),a=r.indexOf(u);if(-1===c)throw new Error("The ordering for "+n+" does not have an entry for "+i+".\nOrder specified: "+JSON.stringify(r,null,2));if(-1===a)throw new Error("The ordering for "+n+" does not have an entry for "+u+".\nOrder specified: "+JSON.stringify(r,null,2));return c<a?-1:a<c?1:0}));return de.value(i)}catch(n){return de.error([n])}}("Event: "+e,"name",n,r).map((function(n){var t=st(n,(function(n){return n.handler()}));return function(n){var t=function(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return M(n,(function(n,e){return n&&function(n){return n.can}(e).apply(void 0,t)}),!0)}}(n),e=function(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return M(n,(function(n,e){return n||function(n){return n.abort}(e).apply(void 0,t)}),!1)}}(n);return Ke({can:t,abort:e,run:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];E(n,(function(n){n.run.apply(void 0,t)}))}})}(t)})):function(n,t){return de.error(["The event ("+n+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+JSON.stringify(st(t,(function(n){return n.name()})),null,2)])}(e,n)}(n,t,e)).map((function(r){var o=function(n){var t=function(n){return it(n)?{can:u(!0),abort:u(!1),run:n}:n}(n);return function(n,e){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];var i=[n,e].concat(r);t.abort.apply(void 0,i)?e.stop():t.can.apply(void 0,i)&&t.run.apply(void 0,i)}}(r),i=1<n.length?C(t[e],(function(t){return k(n,(function(n){return n.name()===t}))})).join(" > "):n[0].name();return Sn(e,function(n,t){return{handler:n,purpose:u(t)}}(o,i))}))}));return function(n){var t=function(n){var t=[],e=[];return E(n,(function(n){n.fold((function(n){t.push(n)}),(function(n){e.push(n)}))})),{errors:t,values:e}}(n);return 0<t.errors.length?function(n){return de.error(A(n))}(t.errors):function(n,t){return 0===n.length?de.value(t):de.value(pe(t,he.apply(void 0,n)))}(t.values,{})}(e)},Ad=function(n){var t=je("external.component",Ae([Pe("element"),Le("uid")]),n),e=Bn(Il());t.uid.each((function(n){Ca(t.element,n)}));var o={getSystem:e.get,config:Dn.none,hasConfigured:u(!1),connect:function(n){e.set(n)},disconnect:function(){e.set(Il((function(){return o})))},getApis:function(){return{}},element:u(t.element),spec:u(n),readState:u("No state"),syncComponents:r,components:u([]),events:u({})};return qu(o)},Rd=Ku,Bd=function(n){return function(n){return Te(n,Sa)}(n).fold((function(){return function(n){var r=Md(n),o=r.events,i=e(r,["events"]),u=function(n){var t=wn("components",[])(n);return st(t,Bd)}(i),c=t(t({},i),{events:t(t({},Dd),o),components:u});return de.value(Nl(c))}(n.hasOwnProperty("uid")?n:t({uid:Rd("")},n)).getOrDie()}),(function(n){return n}))},Vd=qu,Nd="alloy.item-hover",jd="alloy.item-focus",_d=u(Nd),Pd=u(jd),Hd=[Pe("data"),Pe("components"),Pe("dom"),We("hasSubmenu",!1),Le("toggling"),Qc("itemBehaviours",[ci,pi,Jc,ws]),We("ignoreFocus",!1),We("domModification",{}),Mo("builder",(function(n){return{dom:n.dom,domModification:t(t({},n.domModification),{attributes:t(t(t({role:n.toggling.isSome()?"menuitemcheckbox":"menuitem"},n.domModification.attributes),{"aria-haspopup":n.hasSubmenu}),n.hasSubmenu?{"aria-expanded":!1}:{})}),behaviours:Zc(n.itemBehaviours,[n.toggling.fold(ci.revoke,(function(n){return ci.config(t({aria:{mode:"checked"}},n))})),pi.config({ignore:n.ignoreFocus,stopMousedown:n.ignoreFocus,onFocus:function(n){Pl(n)}}),Jc.config({mode:"execution"}),ws.config({store:{mode:"memory",initialValue:n.data}}),id("item-type-events",function(){for(var n=0,t=0,e=arguments.length;t<e;t++)n+=arguments[t].length;var r=Array(n),o=0;for(t=0;t<e;t++)for(var i=arguments[t],u=0,c=i.length;u<c;u++,o++)r[o]=i[u];return r}(jo(),[Or(Tt(),_l),Or(jt(),pi.focus)]))]),components:n.components,eventOrder:n.eventOrder}})),We("eventOrder",{})],zd=[Pe("dom"),Pe("components"),Mo("builder",(function(n){return{dom:n.dom,components:n.components,events:Sr([function(n){return Or(n,(function(n,t){t.stop()}))}(jt())])}}))],Ld=u([ya({name:"widget",overrides:function(n){return{behaviours:lo([ws.config({store:{mode:"manual",getValue:function(t){return n.data},setValue:function(){}}})])}}})]),Gd=[Pe("uid"),Pe("data"),Pe("components"),Pe("dom"),We("autofocus",!1),We("ignoreFocus",!1),Qc("widgetBehaviours",[ws,pi,Jc]),We("domModification",{}),Xu(Ld()),Mo("builder",(function(n){function t(t){return $u(t,n,"widget").map((function(n){return Jc.focusIn(n),n}))}function e(t,e){return Zi(e.event().target())||n.autofocus&&e.setSource(t.element()),Dn.none()}var r=Gu(0,n,Ld()),o=Uu("item-widget",n,r.internals());return{dom:n.dom,components:o,domModification:n.domModification,events:Sr([uo((function(n,e){t(n).each((function(n){e.stop()}))})),Or(Tt(),_l),Or(jt(),(function(e,r){n.autofocus?t(e):pi.focus(e)}))]),behaviours:Zc(n.widgetBehaviours,[ws.config({store:{mode:"memory",initialValue:n.data}}),pi.config({ignore:n.ignoreFocus,onFocus:function(n){Pl(n)}}),Jc.config({mode:"special",focusIn:n.autofocus?function(n){t(n)}:po(),onLeft:e,onRight:e,onEscape:function(t,e){return pi.isFocused(t)||n.autofocus?(n.autofocus&&e.setSource(t.element()),Dn.none()):(pi.focus(t),Dn.some(!0))}})])}}))],Ud=_e("type",{widget:Gd,item:Hd,separator:zd}),$d=u([xa({factory:{sketch:function(n){var t=je("menu.spec item",Ud,n);return t.builder(t)}},name:"items",unit:"item",defaults:function(n,e){return e.hasOwnProperty("uid")?e:t(t({},e),{uid:Ku("item")})},overrides:function(n,t){return{type:t.type,ignoreFocus:n.fakeFocus,domModification:{classes:[n.markers.item]}}}})]),Wd=u([Pe("value"),Pe("items"),Pe("dom"),Pe("components"),We("eventOrder",{}),Nu("menuBehaviours",[Ki,ws,cd,Jc]),Xe("movement",{mode:"menu",moveOnTab:!0},_e("mode",{grid:[ni(),Mo("config",(function(n,t){return{mode:"flatgrid",selector:"."+n.markers.item,initSize:{numColumns:t.initSize.numColumns,numRows:t.initSize.numRows},focusManager:n.focusManager}}))],matrix:[Mo("config",(function(n,t){return{mode:"matrix",selectors:{row:t.rowSelector,cell:"."+n.markers.item},focusManager:n.focusManager}})),Pe("rowSelector")],menu:[We("moveOnTab",!0),Mo("config",(function(n,t){return{mode:"menu",selector:"."+n.markers.item,moveOnTab:t.moveOnTab,focusManager:n.focusManager}}))]})),He("markers",Qo()),We("fakeFocus",!1),We("focusManager",Hi()),ko("onHighlight")]),Xd=u("alloy.menu-focus"),qd=Fa({name:"Menu",configFields:Wd(),partFields:$d(),factory:function(n,t,e,r){return{uid:n.uid,dom:n.dom,markers:n.markers,behaviours:_u(n.menuBehaviours,[Ki.config({highlightClass:n.markers.selectedItem,itemClass:n.markers.item,onHighlight:n.onHighlight}),ws.config({store:{mode:"memory",initialValue:n.value}}),cd.config({find:Dn.some}),Jc.config(n.movement.config(n,n.movement))]),events:Sr([Or(Pd(),(function(n,t){var e=t.event();n.getSystem().getByDom(e.target()).each((function(e){Ki.highlight(n,e),t.stop(),G(n,Xd(),{menu:n,item:e})}))})),Or(_d(),(function(n,t){var e=t.event().item();Ki.highlight(n,e)}))]),components:t,eventOrder:n.eventOrder,domModification:{attributes:{role:"menu"}}}}}),Yd=function(n,t){return n.components()},Kd=Rr({fields:[],name:"replacing",apis:Object.freeze({append:function(n,t,e,r){Hl(n,0,ie,r)},prepend:function(n,t,e,r){Hl(n,0,ln,r)},remove:zl,replaceAt:Ll,replaceBy:function(n,t,e,r,o){return F(Yd(n),r).bind((function(t){return Ll(n,0,0,t,o)}))},set:function(n,t,e,o){!function(n,t){var e=un(t),o=qr(e).bind((function(n){function e(t){return on(n,t)}return e(t)?Dn.some(t):function(n,t){var e=function(n){for(var r=0;r<n.childNodes.length;r++){var o=qt.fromDom(n.childNodes[r]);if(t(o))return Dn.some(o);var i=e(n.childNodes[r]);if(i.isSome())return i}return Dn.none()};return e(n.dom())}(t,e)}));n(),o.each((function(n){qr(e).filter((function(t){return on(t,n)})).fold((function(){Wr(n)}),r)}))}((function(){var t=st(o,n.getSystem().build);!function(n,t){var e=n.components();!function(n){E(n.components(),(function(n){return ue(n.element())})),mn(n.element()),n.syncComponents()}(n),E(N(e,t),(function(t){ce(t),n.getSystem().removeFromWorld(t)})),E(t,(function(t){t.getSystem().isConnected()?gn(n,t):(n.getSystem().addToWorld(t),gn(n,t),Y(n.element())&&ae(t)),n.syncComponents()}))}(n,t)}),n.element())},contents:Yd})}),Jd=function(n,t,e,r){return Te(e,r).bind((function(r){return Te(n,r).bind((function(r){var o=Jd(n,t,e,r);return Dn.some([r].concat(o))}))})).getOr([])},Qd=function(n){return"prepared"===n.type?Dn.some(n.menu):Dn.none()},Zd=Qd,nm=u("collapse-item"),tm=Ia({name:"TieredMenu",configFields:[Do("onExecute"),Do("onEscape"),Co("onOpenMenu"),Co("onOpenSubmenu"),Co("onRepositionMenu"),ko("onCollapseMenu"),We("highlightImmediately",!0),ze("data",[Pe("primary"),Pe("menus"),Pe("expansions")]),We("fakeFocus",!1),ko("onHighlight"),ko("onHover"),ze("markers",[Pe("backgroundMenu")].concat(Ko()).concat(Jo())),Pe("dom"),We("navigateOnHover",!0),We("stayInDom",!1),Nu("tmenuBehaviours",[Jc,Ki,cd,Kd]),We("eventOrder",{})],apis:{collapseMenu:function(n,t){n.collapseMenu(t)},highlightPrimary:function(n,t){n.highlightPrimary(t)},repositionMenus:function(n,t){n.repositionMenus(t)}},factory:function(n,e){function o(n){return ws.getValue(n).value}function i(n,t){Ki.highlight(n,t),Ki.getHighlighted(t).orThunk((function(){return Ki.getFirst(t)})).each((function(t){$(n,t.element(),jt())}))}function u(n,t){return Qr(st(t,(function(t){return n.lookupMenu(t).bind((function(n){return"prepared"===n.type?Dn.some(n.menu):Dn.none()}))})))}function c(t,e,r){E(u(e,e.otherMenus(r)),(function(e){Vl(e.element(),[n.markers.backgroundMenu]),n.stayInDom||Kd.remove(t,e)}))}function a(t,e){var r=function(t){return d.get().getOrThunk((function(){var e={},r=C(xi(t.element(),"."+n.markers.item),(function(n){return"true"===jr(n,"aria-haspopup")}));return E(r,(function(n){t.getSystem().getByDom(n).each((function(n){var t=o(n);e[t]=n}))})),d.set(Dn.some(e)),e}))}(t);Fn(r,(function(n,t){var r=O(e,t);Vr(n.element(),"aria-expanded",r)}))}function f(t,e,r){return Dn.from(r[0]).bind((function(o){return e.lookupMenu(o).bind((function(o){if("notbuilt"===o.type)return Dn.none();var a=o.menu;return E(u(e,r.slice(1)),(function(t){Lr(t.element(),n.markers.backgroundMenu)})),Y(a.element())||Kd.append(t,Vd(a)),Vl(a.element(),[n.markers.backgroundMenu]),i(t,a),c(t,e,r),Dn.some(a)}))}))}var s,l,d=Bn(Dn.none()),m=function(){var n=Bn({}),e=Bn({}),r=Bn({}),o=Bn(Dn.none()),i=Bn({}),u=function(n){return c(n).bind(Qd)},c=function(n){return Te(e.get(),n)},a=function(t){return Te(n.get(),t)};return{setMenuBuilt:function(n,r){var o;e.set(t(t({},e.get()),((o={})[n]={type:"prepared",menu:r},o)))},setContents:function(t,u,c,a){o.set(Dn.some(t)),n.set(c),e.set(u),i.set(a);var f=function(n,t){var e={};Fn(n,(function(n,t){E(n,(function(n){e[n]=t}))}));var r=t,o=function(n){return An(n,(function(n,t){return{k:n,v:t}}))}(t),i=b(o,(function(n,t){return[t].concat(Jd(e,r,o,t))}));return b(e,(function(n){return Te(i,n).getOr([n])}))}(a,c);r.set(f)},expand:function(t){return Te(n.get(),t).map((function(n){var e=Te(r.get(),t).getOr([]);return[n].concat(e)}))},refresh:function(n){return Te(r.get(),n)},collapse:function(n){return Te(r.get(),n).bind((function(n){return 1<n.length?Dn.some(n.slice(1)):Dn.none()}))},lookupMenu:c,lookupItem:a,otherMenus:function(n){var t=i.get();return N(Mn(t),n)},getPrimary:function(){return o.get().bind(u)},getMenus:function(){return e.get()},clear:function(){n.set({}),e.set({}),r.set({}),o.set(Dn.none())},isClear:function(){return o.get().isNone()},getTriggeringPath:function(t,e){var i=C(a(t).toArray(),(function(n){return u(n).isSome()}));return Te(r.get(),t).bind((function(t){var r=V(i.concat(t));return function(n){for(var t=[],e=0;e<n.length;e++){var r=n[e];if(!r.isSome())return Dn.none();t.push(r.getOrDie())}return Dn.some(t)}(R(r,(function(t,i){return function(t,e,r){return u(t).bind((function(o){return function(t){return function(n,t){for(var e=Mn(n),r=0,o=e.length;r<o;r++){var i=n[e[r]];if(t(i))return Dn.some(i)}return Dn.none()}(n.get(),(function(n,e){return n===t}))}(t).bind((function(n){return e(n).map((function(n){return{triggeredMenu:o,triggeringItem:n,triggeringPath:r}}))}))}))}(t,e,r.slice(0,i+1)).fold((function(){return o.get().is(t)?[]:[Dn.none()]}),(function(n){return[Dn.some(n)]}))})))}))}}}();function g(t,e,r){void 0===r&&(r=s.HighlightSubmenu);var i=o(e);return m.expand(i).bind((function(o){return a(t,o),Dn.from(o[0]).bind((function(i){return m.lookupMenu(i).bind((function(u){var c=function(n,t,e){if("notbuilt"!==e.type)return e.menu;var r=n.getSystem().build(e.nbMenu());return m.setMenuBuilt(t,r),r}(t,i,u);return Y(c.element())||Kd.append(t,Vd(c)),n.onOpenSubmenu(t,e,c,V(o)),r===s.HighlightSubmenu?(Ki.highlightFirst(c),f(t,m,o)):(Ki.dehighlightAll(c),Dn.some(e))}))}))}))}function p(t,e){var r=o(e);return m.collapse(r).bind((function(r){return a(t,r),f(t,m,r).map((function(r){return n.onCollapseMenu(t,e,r),r}))}))}function h(t){return function(e,r){return Oi(r.getSource(),"."+n.markers.item).bind((function(n){return e.getSystem().getByDom(n).toOption().bind((function(n){return t(e,n).map((function(){return!0}))}))}))}}function v(n){return Ki.getHighlighted(n).bind(Ki.getHighlighted)}(l=s=s||{})[l.HighlightSubmenu=0]="HighlightSubmenu",l[l.HighlightParent=1]="HighlightParent";var y=Sr([Or(Xd(),(function(n,t){var e=t.event().item();m.lookupItem(o(e)).each((function(){var e=t.event().menu();Ki.highlight(n,e);var r=o(t.event().item());m.refresh(r).each((function(t){return c(n,m,t)}))}))})),uo((function(t,e){var r=e.event().target();t.getSystem().getByDom(r).each((function(e){0===o(e).indexOf("collapse-item")&&p(t,e),g(t,e,s.HighlightSubmenu).fold((function(){n.onExecute(t,e)}),(function(){}))}))})),ro((function(e,o){(function(e){var o=function(e,o,i){return b(i,(function(i,u){function c(){return qd.sketch(t(t({dom:i.dom},i),{value:u,items:i.items,markers:n.markers,fakeFocus:n.fakeFocus,onHighlight:n.onHighlight,focusManager:n.fakeFocus?function(){function n(n){return Ki.getHighlighted(n).map((function(n){return n.element()}))}return{get:n,set:function(t,e){var o=n(t);t.getSystem().getByDom(e).fold(r,(function(n){Ki.highlight(t,n)}));var i=n(t);Pi(t,o,i)}}}():Hi()}))}return u===o?{type:"prepared",menu:e.getSystem().build(c())}:{type:"notbuilt",nbMenu:c}}))}(e,n.data.primary,n.data.menus),i=b(n.data.menus,(function(n,t){return R(n.items,(function(n){return"separator"===n.type?[]:[n.data.value]}))}));return m.setContents(n.data.primary,o,n.data.expansions,i),m.getPrimary()})(e).each((function(t){Kd.append(e,Vd(t)),n.onOpenMenu(e,t),n.highlightImmediately&&i(e,t)}))}))].concat(n.navigateOnHover?[Or(_d(),(function(t,e){var r=e.event().item();!function(n,t){var e=o(t);m.refresh(e).bind((function(t){return a(n,t),f(n,m,t)}))}(t,r),g(t,r,s.HighlightParent),n.onHover(t,r)}))]:[])),x={collapseMenu:function(n){v(n).each((function(t){p(n,t)}))},highlightPrimary:function(n){m.getPrimary().each((function(t){i(n,t)}))},repositionMenus:function(t){m.getPrimary().bind((function(n){return v(t).bind((function(n){var t=o(n),e=function(n){return Rn(n,(function(n){return n}))}(m.getMenus()),r=Qr(st(e,Zd));return m.getTriggeringPath(t,(function(n){return function(n,t,e){return Zr(t,(function(n){return n.getSystem().isConnected()?I(Ki.getCandidates(n),(function(n){return o(n)===e})):Dn.none()}))}(0,r,n)}))})).map((function(t){return{primary:n,triggeringPath:t}}))})).fold((function(){(function(n){return Dn.from(n.components()[0]).filter((function(n){return"menu"===jr(n.element(),"role")}))})(t).each((function(e){n.onRepositionMenu(t,e,[])}))}),(function(e){var r=e.primary,o=e.triggeringPath;n.onRepositionMenu(t,r,o)}))}};return{uid:n.uid,dom:n.dom,markers:n.markers,behaviours:_u(n.tmenuBehaviours,[Jc.config({mode:"special",onRight:h((function(n,t){return Zi(t.element())?Dn.none():g(n,t,s.HighlightSubmenu)})),onLeft:h((function(n,t){return Zi(t.element())?Dn.none():p(n,t)})),onEscape:h((function(t,e){return p(t,e).orThunk((function(){return n.onEscape(t,e).map((function(){return t}))}))})),focusIn:function(n,t){m.getPrimary().each((function(t){$(n,t.element(),jt())}))}}),Ki.config({highlightClass:n.markers.selectedMenu,itemClass:n.markers.menu}),cd.config({find:function(n){return Ki.getHighlighted(n)}}),Kd.config({})]),eventOrder:n.eventOrder,apis:x,events:y}},extraApis:{tieredData:function(n,t,e){return{primary:n,menus:t,expansions:e}},singleData:function(n,t){return{primary:n,menus:Sn(n,t),expansions:{}}},collapseItem:function(n){return{value:Pu(nm()),meta:{text:n}}}}}),em=function(n,t,e,r){return Gl(0,t,0,r).bind((function(n){return n.transition.map((function(t){return{transition:t,route:n}}))}))},rm=function(n,t,e){return _r(n.element(),t.destinationAttr)?Dn.some({start:jr(n.element(),t.stateAttr),destination:jr(n.element(),t.destinationAttr)}):Dn.none()},om=Object.freeze({findRoute:Gl,disableTransition:Ul,getCurrentRoute:rm,jumpTo:$l,progressTo:function(n,t,e,r){!function(n,t){_r(n.element(),t.destinationAttr)&&(Vr(n.element(),t.stateAttr,jr(n.element(),t.destinationAttr)),Pr(n.element(),t.destinationAttr))}(n,t);var o=function(n,t,e,r){return{start:jr(n.element(),t.stateAttr),destination:r}}(n,t,0,r);em(n,t,e,o).fold((function(){$l(n,t,e,r)}),(function(o){Ul(n,t,e);var i=o.transition;Lr(n.element(),i.transitionClass),Vr(n.element(),t.destinationAttr,r)}))},getState:function(n,t,e){var r=n.element();return _r(r,t.stateAttr)?Dn.some(jr(r,t.stateAttr)):Dn.none()}}),im=Object.freeze({events:function(n,t){return Sr([Or(Mt(),(function(e,r){var o=r.event().raw();rm(e,n).each((function(r){Gl(0,n,0,r).each((function(i){i.transition.each((function(i){o.propertyName===i.property&&($l(e,n,t,r.destination),n.onTransition(e,r))}))}))}))})),ro((function(e,r){$l(e,n,t,n.initialState)}))])}}),um=Rr({fields:[We("destinationAttr","data-transitioning-destination"),We("stateAttr","data-transitioning-state"),Pe("initialState"),ko("onTransition"),ko("onFinish"),He("routes",Be(de.value,Be(de.value,Ae([$e("transition",[Pe("property"),Pe("transitionClass")])]))))],name:"transitioning",active:im,apis:om,extra:{createRoutes:function(n){var t={};return Fn(n,(function(n,e){var r=e.split("<->");t[r[0]]=Sn(r[1],n),t[r[1]]=Sn(r[0],n)})),t},createBistate:function(n,t,e){return Tn([{key:n,value:Sn(t,e)},{key:t,value:Sn(n,e)}])},createTristate:function(n,t,e,r){return Tn([{key:n,value:Tn([{key:t,value:r},{key:e,value:r}])},{key:t,value:Tn([{key:n,value:r},{key:e,value:r}])},{key:e,value:Tn([{key:n,value:r},{key:t,value:r}])}])}}}),cm=di.resolve("scrollable"),am={register:function(n){Lr(n,cm)},deregister:function(n){Gr(n,cm)},scrollable:u(cm)},fm=function(n,t,e,r,o){return{data:{value:n,text:t},type:"item",dom:{tag:"div",classes:o?[di.resolve("styles-item-is-menu")]:[]},toggling:{toggleOnExecute:!1,toggleClass:di.resolve("format-matches"),selected:e},itemBehaviours:lo(o?[]:[ai(n,(function(n,t){(t?ci.on:ci.off)(n)}))]),components:[{dom:{tag:"div",attributes:{style:r},innerHtml:t}}]}},sm=function(n,t,e,r){return{value:n,dom:{tag:"div"},components:[ns.sketch({dom:{tag:"div",classes:[di.resolve("styles-collapser")]},components:r?[{dom:{tag:"span",classes:[di.resolve("styles-collapse-icon")]}},jl(n)]:[jl(n)],action:function(n){if(r){var t=e().get(n);tm.collapseMenu(t)}}}),{dom:{tag:"div",classes:[di.resolve("styles-menu-items-container")]},components:[qd.parts().items({})],behaviours:lo([id("adhoc-scrollable-menu",[ro((function(n,t){hi(n.element(),"overflow-y","auto"),hi(n.element(),"-webkit-overflow-scrolling","touch"),am.register(n.element())})),oo((function(n){Uo(n.element(),"overflow-y"),Uo(n.element(),"-webkit-overflow-scrolling"),am.deregister(n.element())}))])])}],items:t,menuBehaviours:lo([um.config({initialState:"after",routes:um.createTristate("before","current","after",{transition:{property:"transform",transitionClass:"transitioning"}})})])}},lm=function(n){return D(n,(function(n,t){var e=function(n){return On(n,"items")?function(n){var t=pe(function(n){return function(n,t){var e={};return Fn(n,(function(n,r){O(t,r)||(e[r]=n)})),e}(n,["items"])}(n),{menu:!0}),e=lm(n.items);return{item:t,menus:pe(e.menus,Sn(n.title,e.items)),expansions:pe(e.expansions,Sn(n.title,n.title))}}(n):{item:n,menus:{},expansions:{}}}(t);return{menus:pe(n.menus,e.menus),items:[e.item].concat(n.items),expansions:pe(n.expansions,e.expansions)}}),{menus:{},expansions:{},items:[]})},dm={expand:lm},mm=["undo","bold","italic","link","image","bullist","styleselect"],gm=function(n){return R(n,(function(n){return rt(n)?gm(n):Xl(n)}))},pm=function(n,t){function e(n){return function(){return os.forToolbarCommand(t,n)}}function r(n){return function(){return os.forToolbarStateCommand(t,n)}}function o(n,e,r){return function(){return os.forToolbarStateAction(t,n,e,r)}}function i(){return function(n,t,e){var r=function(n,t){var e=function(t){return R(t,(function(t){return void 0===t.items?!On(t,"format")||n.formatter.canApply(t.format)?[t]:[]:0<e(t.items).length?[t]:[]}))},r=e(t);return dm.expand(r)}(n,t);return function(n){var t=function(n,t){var e=sm("Styles",[].concat(st(n.items,(function(t){return fm(Wl(t),t.title,t.isSelected(),t.getPreview(),On(n.expansions,Wl(t)))}))),t,!1),r=b(n.menus,(function(e,r){var o=st(e,(function(t){return fm(Wl(t),t.title,void 0!==t.isSelected&&t.isSelected(),void 0!==t.getPreview?t.getPreview():"",On(n.expansions,Wl(t)))}));return sm(r,o,t,!0)})),o=pe(r,Sn("styles",e));return{tmenu:tm.tieredData("styles",o,n.expansions)}}(n.formats,(function(){return e})),e=Yf(tm.sketch({dom:{tag:"div",classes:[di.resolve("styles-menu")]},components:[],fakeFocus:!0,stayInDom:!0,onExecute:function(t,e){var r=ws.getValue(e);return n.handle(e,r.value),Dn.none()},onEscape:function(){return Dn.none()},onOpenMenu:function(n,t){var e=La(n.element());za(t.element(),e),um.jumpTo(t,"current")},onOpenSubmenu:function(n,t,e){var r=La(n.element()),o=Si(t.element(),'[role="menu"]').getOrDie("hacky"),i=n.getSystem().getByDom(o).getOrDie();za(e.element(),r),um.progressTo(i,"before"),um.jumpTo(e,"after"),um.progressTo(e,"current")},onCollapseMenu:function(n,t,e){var r=Si(t.element(),'[role="menu"]').getOrDie("hacky"),o=n.getSystem().getByDom(r).getOrDie();um.progressTo(o,"after"),um.progressTo(e,"current")},navigateOnHover:!1,highlightImmediately:!0,data:t.tmenu,markers:{backgroundMenu:di.resolve("styles-background-menu"),menu:di.resolve("styles-menu"),selectedMenu:di.resolve("styles-selected-menu"),item:di.resolve("styles-item"),selectedItem:di.resolve("styles-selected-item")}}));return e.asSpec()}({formats:r,handle:function(t,r){n.undoManager.transact((function(){ci.isOn(t)?n.formatter.remove(r):n.formatter.apply(r)})),e()}})}(t,v,(function(){t.fire("scrollIntoView")}))}function c(n,e){return{isSupported:function(){var e=t.ui.registry.getAll().buttons;return n.forall((function(n){return On(e,n)}))},sketch:e}}var a=e("undo"),f=e("redo"),s=r("bold"),l=r("italic"),d=r("underline"),m=e("removeformat"),g=o("unlink","link",(function(){t.execCommand("unlink",null,!1)})),p=o("unordered-list","ul",(function(){t.execCommand("InsertUnorderedList",null,!1)})),h=o("ordered-list","ol",(function(){t.execCommand("InsertOrderedList",null,!1)})),v=function(n,t){function e(t){return function(){return n.formatter.match(t)}}function r(t){return function(){return n.formatter.getCssText(t)}}var o=Te(t,"style_formats").getOr(Ed),i=function(t){return st(t,(function(t){if(On(t,"items")){var o=i(t.items);return pe(function(n){return pe(n,{isSelected:u(!1),getPreview:u("")})}(t),{items:o})}return On(t,"format")?function(n){return pe(n,{isSelected:e(n.format),getPreview:r(n.format)})}(t):function(t){var o=Pu(t.title),i=pe(t,{format:o,isSelected:e(o),getPreview:r(o)});return n.formatter.register(o,i),i}(t)}))};return i(o)}(t,t.settings);return{undo:c(Dn.none(),a),redo:c(Dn.none(),f),bold:c(Dn.none(),s),italic:c(Dn.none(),l),underline:c(Dn.none(),d),removeformat:c(Dn.none(),m),link:c(Dn.none(),(function(){return function(n,t){return os.forToolbarStateAction(t,"link","link",(function(){var e=kd(n,t);n.setContextToolbar(e),od(t,(function(){n.focusToolbar()})),ed(t).each((function(n){t.selection.select(n.dom())}))}))}(n,t)})),unlink:c(Dn.none(),g),image:c(Dn.none(),(function(){return function(n){var t=Yf({dom:{tag:"input",attributes:{accept:"image/*",type:"file",title:""},styles:{visibility:"hidden",position:"absolute"}},events:Sr([Dr(Dt()),Or(Ct(),(function(t,e){(function(n){var t=n.event(),e=t.raw().target.files||t.raw().dataTransfer.files;return Dn.from(e[0])})(e).each((function(t){fl(n,t)}))}))])});return ns.sketch({dom:os.getToolbarIconButton("image",n),components:[t.asSpec()],action:function(n){t.get(n).element().dom().click()}})}(t)})),bullist:c(Dn.some("bullist"),p),numlist:c(Dn.some("numlist"),h),fontsizeselect:c(Dn.none(),(function(){return function(n,t){var e={onChange:function(n){Qs.apply(t,n)},getInitialValue:function(){return Qs.get(t)}};return Xf(n,"font-size",(function(){return function(n){return[Aa('<span class="${prefix}-toolbar-button ${prefix}-icon-small-font ${prefix}-icon"></span>'),function(n){return function(n){var t=je("SizeSlider",Ks,n);return Ys.sketch({dom:{tag:"div",classes:[di.resolve("slider-"+t.category+"-size-container"),di.resolve("slider"),di.resolve("slider-size-container")]},onChange:function(n,e,r){var o=r.x();!function(n){return 0<=n&&n<t.sizes.length}(o)||t.onChange(o)},onDragStart:function(n,t){ci.on(t)},onDragEnd:function(n,t){ci.off(t)},model:{mode:"x",minX:0,maxX:t.sizes.length-1,getInitialValue:function(){return{x:function(){return t.getInitialValue()}}}},stepSize:1,snapToGrid:!0,sliderBehaviours:lo([fi(Ys.refresh)]),components:[Ys.parts().spectrum({dom:es('<div class="${prefix}-slider-size-container"></div>'),components:[Aa('<div class="${prefix}-slider-size-line"></div>')]}),Ys.parts().thumb({dom:es('<div class="${prefix}-slider-thumb"></div>'),behaviours:lo([ci.config({toggleClass:di.resolve("thumb-active")})])})]})}({onChange:n.onChange,sizes:Zs,category:"font",getInitialValue:n.getInitialValue})}(n),Aa('<span class="${prefix}-toolbar-button ${prefix}-icon-large-font ${prefix}-icon"></span>')]}(e)}),t)}(n,t)})),forecolor:c(Dn.none(),(function(){return function(n,t){var e={onChange:function(n,e,r){t.undoManager.transact((function(){t.formatter.apply("forecolor",{value:r}),t.nodeChanged()}))},getInitialValue:function(){return-1}};return Xf(n,"color-levels",(function(){return function(n){return[function(n){function t(n){return n<0?"black":360<n?"white":"hsl("+n+", 100%, 50%)"}return Ys.sketch({dom:es('<div class="${prefix}-slider ${prefix}-hue-slider-container"></div>'),components:[Ys.parts()["left-edge"](Aa('<div class="${prefix}-hue-slider-black"></div>')),Ys.parts().spectrum({dom:es('<div class="${prefix}-slider-gradient-container"></div>'),components:[Aa('<div class="${prefix}-slider-gradient"></div>')],behaviours:lo([ci.config({toggleClass:di.resolve("thumb-active")})])}),Ys.parts()["right-edge"](Aa('<div class="${prefix}-hue-slider-white"></div>')),Ys.parts().thumb({dom:es('<div class="${prefix}-slider-thumb"></div>'),behaviours:lo([ci.config({toggleClass:di.resolve("thumb-active")})])})],onChange:function(e,r,o){var i=t(o.x());hi(r.element(),"background-color",i),n.onChange(e,r,i)},onDragStart:function(n,t){ci.on(t)},onDragEnd:function(n,t){ci.off(t)},onInit:function(n,e,r,o){var i=t(o.x());hi(e.element(),"background-color",i)},stepSize:10,model:{mode:"x",minX:0,maxX:360,getInitialValue:function(){return{x:function(){return n.getInitialValue()}}}},sliderBehaviours:lo([fi(Ys.refresh)])})}(n)]}(e)}),t)}(n,t)})),styleselect:c(Dn.none(),(function(){return os.forToolbar("style-formats",(function(e){t.fire("toReading"),n.dropup().appear(i,ci.on,e)}),lo([ci.config({toggleClass:di.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),ti.config({channels:Tn([si(wo.orientationChanged(),ci.off),si(wo.dropupDismissed(),ci.off)])})]),t)}))}},hm=function(n,t,e,r){n.dom().removeEventListener(t,e,r)},vm=u(!0),ym=tinymce.util.Tools.resolve("tinymce.util.Delay"),bm=Ql,xm=function(n,t){var e=qt.fromDom(n),r=null,o=Kl(e,"orientationchange",(function(){ym.clearInterval(r);var e=Ql(n);t.onChange(e),i((function(){t.onReady(e)}))})),i=function(t){ym.clearInterval(r);var e=n.innerHeight,o=0;r=ym.setInterval((function(){e!==n.innerHeight?(ym.clearInterval(r),t(Dn.some(n.innerHeight))):20<o&&(ym.clearInterval(r),t(Dn.none())),o++}),50)};return{onAdjustment:i,destroy:function(){o.unbind()}}},wm=function(n){var t=z().os.isiOS(),e=Ql(n).isPortrait();return t&&!e?n.screen.height:n.screen.width};function Sm(n){var t=n.raw();return void 0===t.touches||1!==t.touches.length?Dn.none():Dn.some(t.touches[0])}function Tm(t){var e=Bn(Dn.none()),r=Bn(!1),o=function(t){var e=null;return{cancel:function(){null!==e&&(n.clearTimeout(e),e=null)},schedule:function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];e=n.setTimeout((function(){t.apply(null,r),e=null}),400)}}}((function(n){t.triggerEvent(Pt(),n),r.set(!0)})),i=Tn([{key:vt(),value:function(n){return Sm(n).each((function(t){o.cancel();var i={x:u(t.clientX),y:u(t.clientY),target:n.target};o.schedule(n),r.set(!1),e.set(Dn.some(i))})),Dn.none()}},{key:yt(),value:function(n){return o.cancel(),Sm(n).each((function(n){e.get().each((function(t){!function(n,t){var e=Math.abs(n.clientX-t.x()),r=Math.abs(n.clientY-t.y());return 5<e||5<r}(n,t)||e.set(Dn.none())}))})),Dn.none()}},{key:bt(),value:function(n){return o.cancel(),e.get().filter((function(t){return on(t.target(),n.target())})).map((function(e){return r.get()?(n.prevent(),!1):t.triggerEvent(_t(),n)}))}}]);return{fireIfReady:function(n,t){return Te(i,t).bind((function(t){return t(n)}))}}}var Om=function(n){var t=Tm({triggerEvent:function(t,e){n.onTapContent(e)}});return{fireTouchstart:function(n){t.fireIfReady(n,"touchstart")},onTouchend:function(){return Kl(n.body(),"touchend",(function(n){t.fireIfReady(n,"touchend")}))},onTouchmove:function(){return Kl(n.body(),"touchmove",(function(n){t.fireIfReady(n,"touchmove")}))}}},km=6<=z().os.version.major,Em=function(n,t){var e=parseInt(jr(n,t),10);return isNaN(e)?0:e};function Cm(n,t,e){var r=n.document.createRange();return function(n,t){t.fold((function(t){n.setStartBefore(t.dom())}),(function(t,e){n.setStart(t.dom(),e)}),(function(t){n.setStartAfter(t.dom())}))}(r,t),function(n,t){t.fold((function(t){n.setEndBefore(t.dom())}),(function(t,e){n.setEnd(t.dom(),e)}),(function(t){n.setEndAfter(t.dom())}))}(r,e),r}function Dm(n,t,e,r,o){var i=n.document.createRange();return i.setStart(t.dom(),e),i.setEnd(r.dom(),o),i}function Mm(n){return{left:u(n.left),top:u(n.top),right:u(n.right),bottom:u(n.bottom),width:u(n.width),height:u(n.height)}}function Im(n,t,e){return t(qt.fromDom(e.startContainer),e.startOffset,qt.fromDom(e.endContainer),e.endOffset)}function Fm(n,t){return function(n,t){var e=t.ltr();return e.collapsed?t.rtl().filter((function(n){return!1===n.collapsed})).map((function(n){return og.rtl(qt.fromDom(n.endContainer),n.endOffset,qt.fromDom(n.startContainer),n.startOffset)})).getOrThunk((function(){return Im(0,og.ltr,e)})):Im(0,og.ltr,e)}(0,function(n,t){return t.match({domRange:function(n){return{ltr:u(n),rtl:Dn.none}},relative:function(t,e){return{ltr:W((function(){return Cm(n,t,e)})),rtl:W((function(){return Dn.some(Cm(n,e,t))}))}},exact:function(t,e,r,o){return{ltr:W((function(){return Dm(n,t,e,r,o)})),rtl:W((function(){return Dn.some(Dm(n,r,o,t,e))}))}}})}(n,t))}function Am(n,t){var e=X(n);return"input"===e?tg.after(n):O(["br","img"],e)?0===t?tg.before(n):tg.after(n):tg.on(n,t)}function Rm(n,t,e,r,o){!function(n,t){Dn.from(n.getSelection()).each((function(n){n.removeAllRanges(),n.addRange(t)}))}(n,Dm(n,t,e,r,o))}function Bm(n){var t=qt.fromDom(n.anchorNode),e=qt.fromDom(n.focusNode);return function(n,t,e,r){var o=function(n,t,e,r){var o=un(n).dom().createRange();return o.setStart(n.dom(),t),o.setEnd(e.dom(),r),o}(n,t,e,r),i=on(n,e)&&t===r;return o.collapsed&&!i}(t,n.anchorOffset,e,n.focusOffset)?Dn.some(Zm.create(t,n.anchorOffset,e,n.focusOffset)):function(n){if(0<n.rangeCount){var t=n.getRangeAt(0),e=n.getRangeAt(n.rangeCount-1);return Dn.some(Zm.create(qt.fromDom(t.startContainer),t.startOffset,qt.fromDom(e.endContainer),e.endOffset))}return Dn.none()}(n)}function Vm(n){return Dn.from(n.getSelection()).filter((function(n){return 0<n.rangeCount})).bind(Bm)}function Nm(n,t){return function(n){var t=n.getClientRects(),e=0<t.length?t[0]:n.getBoundingClientRect();return 0<e.width||0<e.height?Dn.some(e).map(Mm):Dn.none()}(function(n,t){return Fm(n,t).match({ltr:function(t,e,r,o){var i=n.document.createRange();return i.setStart(t.dom(),e),i.setEnd(r.dom(),o),i},rtl:function(t,e,r,o){var i=n.document.createRange();return i.setStart(r.dom(),o),i.setEnd(t.dom(),e),i}})}(n,t))}function jm(n){return{left:n.left,top:n.top,right:n.right,bottom:n.bottom,width:u(2),height:n.height}}function _m(n){return{left:u(n.left),top:u(n.top),right:u(n.right),bottom:u(n.bottom),width:u(n.width),height:u(n.height)}}function Pm(n,t){Vr(n,cg,t)}function Hm(n){return{top:u(n.top()),bottom:u(n.top()+n.height())}}function zm(n){return Dn.some(qt.fromDom(n.dom().contentWindow.document.body))}function Lm(n){return Dn.some(qt.fromDom(n.dom().contentWindow.document))}function Gm(n){return Dn.from(n.dom().contentWindow)}function Um(n){return Gm(n).bind(Vm)}function $m(n){return n.getFrame()}function Wm(n,t){return function(e){return e[n].getOrThunk((function(){var n=$m(e);return function(){return t(n)}}))()}}function Xm(n,t,e,r){return n[e].getOrThunk((function(){return function(n){return Kl(t,r,n)}}))}function qm(n){return{left:u(n.left),top:u(n.top),right:u(n.right),bottom:u(n.bottom),width:u(n.width),height:u(n.height)}}function Ym(t,e){var r=null;return{cancel:function(){null!==r&&(n.clearTimeout(r),r=null)},throttle:function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];null!==r&&n.clearTimeout(r),r=n.setTimeout((function(){t.apply(null,o),r=null}),e)}}}function Km(n){return"true"===jr(n,kg)?function(n){return 0<n.dom().scrollLeft||function(n){n.dom().scrollLeft=1;var t=0!==n.dom().scrollLeft;return n.dom().scrollLeft=0,t}(n)}(n):function(n){return 0<n.dom().scrollTop||function(n){n.dom().scrollTop=1;var t=0!==n.dom().scrollTop;return n.dom().scrollTop=0,t}(n)}(n)}var Jm,Qm=function(n){var t=function(t){return n(t)?Dn.from(t.dom().nodeValue):Dn.none()};return{get:function(e){if(!n(e))throw new Error("Can only get text value of a text node");return t(e).getOr("")},getOption:t,set:function(t,e){if(!n(t))throw new Error("Can only set raw text value of a text node");t.dom().nodeValue=e}}}(Zt),Zm={create:K("start","soffset","finish","foffset")},ng=me([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),tg={before:ng.before,on:ng.on,after:ng.after,cata:function(n,t,e,r){return n.fold(t,e,r)},getStart:function(n){return n.fold(o,o,o)}},eg=me([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),rg={domRange:eg.domRange,relative:eg.relative,exact:eg.exact,exactFromRange:function(n){return eg.exact(n.start(),n.soffset(),n.finish(),n.foffset())},getWin:function(n){return function(n){return qt.fromDom(n.dom().ownerDocument.defaultView)}(function(n){return n.match({domRange:function(n){return qt.fromDom(n.startContainer)},relative:function(n,t){return tg.getStart(n)},exact:function(n,t,e,r){return n}})}(n))},range:Zm.create},og=me([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),ig=(document.caretPositionFromPoint||document.caretRangeFromPoint,function(n){var t=n.getSelection();return void 0!==t&&0<t.rangeCount?function(n){if(n.collapsed){var t=qt.fromDom(n.startContainer);return cn(t).bind((function(e){var r=rg.exact(t,n.startOffset,e,function(n){return"img"===X(n)?1:function(n){return Qm.getOption(n)}(n).fold((function(){return oe(n).length}),(function(n){return n.length}))}(e));return Nm(n.startContainer.ownerDocument.defaultView,r).map(jm).map(j)})).getOr([])}return st(n.getClientRects(),_m)}(t.getRangeAt(0)):[]}),ug=function(n){n.focus();var t=qt.fromDom(n.document.body);(qr().exists((function(n){return O(["input","textarea"],X(n))}))?function(n){ym.setTimeout((function(){n()}),0)}:s)((function(){qr().each(Xr),Wr(t)}))},cg="data-"+di.resolve("last-outer-height"),ag={getBody:Wm("getBody",zm),getDoc:Wm("getDoc",Lm),getWin:Wm("getWin",Gm),getSelection:Wm("getSelection",Um),getFrame:$m,getActiveApi:function(n){var t=$m(n);return zm(t).bind((function(e){return Lm(t).bind((function(r){return Gm(t).map((function(o){var i=qt.fromDom(r.dom().documentElement),a=n.getCursorBox.getOrThunk((function(){return function(){return function(n){return Vm(n).map((function(n){return rg.exact(n.start(),n.soffset(),n.finish(),n.foffset())}))}(o).bind((function(n){return Nm(o,n).orThunk((function(){return function(n){return Vm(n).filter((function(n){return on(n.start(),n.finish())&&n.soffset()===n.foffset()})).bind((function(n){var t=n.start().dom().getBoundingClientRect();return 0<t.width||0<t.height?Dn.some(t).map(qm):Dn.none()}))}(o)}))}))}})),f=n.setSelection.getOrThunk((function(){return function(n,t,e,r){!function(n,t,e,r,o){!function(n,t){Fm(n,t).match({ltr:function(t,e,r,o){Rm(n,t,e,r,o)},rtl:function(t,e,r,o){var i=n.getSelection();if(i.setBaseAndExtent)i.setBaseAndExtent(t.dom(),e,r.dom(),o);else if(i.extend)try{!function(n,t,e,r,o,i){t.collapse(e.dom(),r),t.extend(o.dom(),i)}(0,i,t,e,r,o)}catch(i){Rm(n,r,o,t,e)}else Rm(n,r,o,t,e)}})}(n,function(n,t,e,r){var o=Am(n,t),i=Am(e,r);return rg.relative(o,i)}(t,e,r,o))}(o,n,t,e,r)}})),s=n.clearSelection.getOrThunk((function(){return function(){!function(n){n.getSelection().removeAllRanges()}(o)}}));return{body:u(e),doc:u(r),win:u(o),html:u(i),getSelection:c(Um,t),setSelection:f,clearSelection:s,frame:u(t),onKeyup:Xm(n,r,"onKeyup","keyup"),onNodeChanged:Xm(n,r,"onNodeChanged","SelectionChange"),onDomChanged:n.onDomChanged,onScrollToCursor:n.onScrollToCursor,onScrollToElement:n.onScrollToElement,onToReading:n.onToReading,onToEditing:n.onToEditing,onToolbarScrollStart:n.onToolbarScrollStart,onTouchContent:n.onTouchContent,onTapContent:n.onTapContent,onTouchToolstrip:n.onTouchToolstrip,getCursorBox:a}}))}))}))}},fg="data-ephox-mobile-fullscreen-style",sg="position:absolute!important;",lg="top:0!important;left:0!important;margin:0!important;padding:0!important;width:100%!important;height:100%!important;overflow:visible!important;",dg=z().os.isAndroid(),mg=function(n,t){function e(n){return function(t){var e=jr(t,"style"),r=void 0===e?"no-styles":e.trim();r!==n&&(Vr(t,fg,r),Vr(t,"style",n))}}var r=function(n){return function(n){return C(function(n,t){for(var e=it(t)?t:m,r=n.dom(),o=[];null!==r.parentNode&&void 0!==r.parentNode;){var i=r.parentNode,u=qt.fromDom(i);if(o.push(u),!0===e(u))break;r=i}return o}(n,void 0),(function(n){return nn(n,"*")}))}(n)}(n),o=R(r,(function(n){return function(n){return function(n){return C(function(n){return cn(n).map(oe).map((function(t){return C(t,(function(t){return!on(n,t)}))})).getOr([])}(n),(function(n){return nn(n,"*")}))}(n)}(n)})),i=function(n){var t=Lo(n,"background-color");return void 0!==t&&""!==t?"background-color:"+t+"!important":"background-color:rgb(255,255,255)!important;"}(t);E(o,e("display:none!important;")),E(r,e(sg+lg+i)),e((!0===dg?"":sg)+lg+i)(n)},gg=function(){E(function(n){return en(n)}("["+fg+"]"),(function(n){var t=jr(n,fg);"no-styles"!==t?Vr(n,"style",t):Pr(n,"style"),Pr(n,fg)}))},pg=function(){var n=wi("head").getOrDie(),t=wi('meta[name="viewport"]').getOrThunk((function(){var t=qt.fromTag("meta");return Vr(t,"name","viewport"),ie(n,t),t})),e=jr(t,"content");return{maximize:function(){Vr(t,"content","width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0")},restore:function(){null!=e&&0<e.length?Vr(t,"content",e):Vr(t,"content","user-scalable=yes")}}},hg=function(n,t){var e=pg(),o=Cl(),i=Cl();return{enter:function(){t.hide(),Lr(n.container,di.resolve("fullscreen-maximized")),Lr(n.container,di.resolve("android-maximized")),e.maximize(),Lr(n.body,di.resolve("android-scroll-reload")),o.set(function(n,t){var e=qt.fromDom(t.document.body),r=Kl(qt.fromDom(n),"resize",(function(){(function(n,t){var e=function(n){return Em(n,cg)}(t),r=n.innerHeight;return r<e?Dn.some(e-r):Dn.none()})(n,e).each((function(n){(function(n){var t=ig(n);return 0<t.length?Dn.some(t[0]).map(Hm):Dn.none()})(t).each((function(e){var r=function(n,t,e){return t.top()>n.innerHeight||t.bottom()>n.innerHeight?Math.min(e,t.bottom()-n.innerHeight+50):0}(t,e,n);0!==r&&t.scrollTo(t.pageXOffset,t.pageYOffset+r)}))})),Pm(e,n.innerHeight)}));return Pm(e,n.innerHeight),{toEditing:function(){ug(t)},destroy:function(){r.unbind()}}}(n.win,ag.getWin(n.editor).getOrDie("no"))),ag.getActiveApi(n.editor).each((function(t){mg(n.container,t.body()),i.set(function(n,t,e){function o(n){return!on(n.start(),n.finish())||n.soffset()!==n.foffset()}function i(){var r=n.doc().dom().hasFocus()&&n.getSelection().exists(o);e.getByDom(t).each(!0===(r||qr(c).filter((function(n){return"input"===X(n)})).exists((function(n){return n.dom().selectionStart!==n.dom().selectionEnd})))?ci.on:ci.off)}var u=Om(n),c=un(t),a=[Kl(n.body(),"touchstart",(function(t){n.onTouchContent(),u.fireTouchstart(t)})),u.onTouchmove(),u.onTouchend(),Kl(t,"touchstart",(function(t){n.onTouchToolstrip()})),n.onToReading((function(){Xr(n.body())})),n.onToEditing(r),n.onScrollToCursor((function(t){t.preventDefault(),n.getCursorBox().each((function(t){var e=n.win(),r=t.top()>e.innerHeight||t.bottom()>e.innerHeight?t.bottom()-e.innerHeight+50:0;0!=r&&e.scrollTo(e.pageXOffset,e.pageYOffset+r)}))}))].concat(1==km?[]:[Kl(qt.fromDom(n.win()),"blur",(function(){e.getByDom(t).each(ci.off)})),Kl(c,"select",i),Kl(n.doc(),"selectionchange",i)]);return{destroy:function(){E(a,(function(n){n.unbind()}))}}}(t,n.toolstrip,n.alloy))}))},exit:function(){e.restore(),t.show(),Gr(n.container,di.resolve("fullscreen-maximized")),Gr(n.container,di.resolve("android-maximized")),gg(),Gr(n.body,di.resolve("android-scroll-reload")),i.clear(),o.clear()}}},vg=function(t,e){var r=Yf(ad.sketch({dom:es('<div aria-hidden="true" class="${prefix}-mask-tap-icon"></div>'),containerBehaviours:lo([ci.config({toggleClass:di.resolve("mask-tap-icon-selected"),toggleOnExecute:!1})])})),o=function(t){var e=null;return{cancel:function(){null!==e&&(n.clearTimeout(e),e=null)},throttle:function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];null===e&&(e=n.setTimeout((function(){t.apply(null,r),e=null}),200))}}}(t);return ad.sketch({dom:es('<div class="${prefix}-disabled-mask"></div>'),components:[ad.sketch({dom:es('<div class="${prefix}-content-container"></div>'),components:[ns.sketch({dom:es('<div class="${prefix}-content-tap-section"></div>'),components:[r.asSpec()],action:function(n){o.throttle()},buttonBehaviours:lo([ci.config({toggleClass:di.resolve("mask-tap-icon-selected")})])})]})]})},yg=lr([ze("editor",[Pe("getFrame"),Le("getBody"),Le("getDoc"),Le("getWin"),Le("getSelection"),Le("setSelection"),Le("clearSelection"),Le("cursorSaver"),Le("onKeyup"),Le("onNodeChanged"),Le("getCursorBox"),Pe("onDomChanged"),We("onTouchContent",r),We("onTapContent",r),We("onTouchToolstrip",r),We("onScrollToCursor",u({unbind:r})),We("onScrollToElement",u({unbind:r})),We("onToEditing",u({unbind:r})),We("onToReading",u({unbind:r})),We("onToolbarScrollStart",o)]),Pe("socket"),Pe("toolstrip"),Pe("dropup"),Pe("toolbar"),Pe("container"),Pe("alloy"),qe("win",(function(n){return un(n.socket).dom().defaultView})),qe("body",(function(n){return qt.fromDom(n.socket.dom().ownerDocument.body)})),We("translate",o),We("setReadOnly",r),We("readOnlyOnInit",u(!0))]),bg=u([Pe("dom"),We("shell",!0),Nu("toolbarBehaviours",[Kd])]),xg=u([ba({name:"groups",overrides:function(n){return{behaviours:lo([Kd.config({})])}}})]),wg=Fa({name:"Toolbar",configFields:bg(),partFields:xg(),factory:function(t,e,r,o){var i=function(n){return t.shell?Dn.some(n):$u(n,t,"groups")},u=t.shell?{behaviours:[Kd.config({})],components:[]}:{behaviours:[],components:e};return{uid:t.uid,dom:t.dom,components:u.components,behaviours:_u(t.toolbarBehaviours,u.behaviours),apis:{setGroups:function(t,e){i(t).fold((function(){throw n.console.error("Toolbar was defined to not be a shell, but no groups container was specified in components"),new Error("Toolbar was defined to not be a shell, but no groups container was specified in components")}),(function(n){Kd.set(n,e)}))}},domModification:{attributes:{role:"group"}}}},apis:{setGroups:function(n,t,e){n.setGroups(t,e)}}}),Sg=u([Pe("items"),(Jm=["itemSelector"],ze("markers",st(Jm,Pe))),Nu("tgroupBehaviours",[Jc])]),Tg=u([xa({name:"items",unit:"item"})]),Og=Fa({name:"ToolbarGroup",configFields:Sg(),partFields:Tg(),factory:function(n,t,e,r){return{uid:n.uid,dom:n.dom,components:t,behaviours:_u(n.tgroupBehaviours,[Jc.config({mode:"flow",selector:n.markers.itemSelector})]),domModification:{attributes:{role:"toolbar"}}}}}),kg="data-"+di.resolve("horizontal-scroll"),Eg=function(n,t){return Kl(n,"touchmove",(function(n){Oi(n.target(),t).filter(Km).fold((function(){n.raw().preventDefault()}),r)}))};function Cg(){function n(n){var t=!0===n.scrollable?"${prefix}-toolbar-scrollable-group":"";return{dom:es('<div aria-label="'+n.label+'" class="${prefix}-toolbar-group '+t+'"></div>'),tgroupBehaviours:lo([id("adhoc-scrollable-toolbar",!0===n.scrollable?[io((function(n,t){hi(n.element(),"overflow-x","auto"),function(n){Vr(n,kg,"true")}(n.element()),am.register(n.element())}))]:[])]),components:[ad.sketch({components:[Og.parts().items({})]})],markers:{itemSelector:"."+di.resolve("toolbar-group-item")},items:n.items}}function t(){wg.setGroups(e,o.get()),ci.off(e)}var e=Bd(wg.sketch({dom:es('<div class="${prefix}-toolbar"></div>'),components:[wg.parts().groups({})],toolbarBehaviours:lo([ci.config({toggleClass:di.resolve("context-toolbar"),toggleOnExecute:!1,aria:{mode:"none"}}),Jc.config({mode:"cyclic"})]),shell:!0})),r=Bd(ad.sketch({dom:{classes:[di.resolve("toolstrip")]},components:[Vd(e)],containerBehaviours:lo([ci.config({toggleClass:di.resolve("android-selection-context-toolbar"),toggleOnExecute:!1})])})),o=Bn([]);return{wrapper:u(r),toolbar:u(e),createGroups:function(t){return st(t,i(Og.sketch,n))},setGroups:function(n){o.set(n),t()},setContextToolbar:function(n){ci.on(e),wg.setGroups(e,n)},restoreToolbar:function(){ci.isOn(e)&&t()},refresh:function(){},focus:function(){Jc.focusIn(e)}}}function Dg(n,t){Kd.append(n,Vd(t))}function Mg(n,t){Kd.remove(n,t)}function Ig(n,t){return t.getAnimationRoot.fold((function(){return n.element()}),(function(t){return t(n)}))}function Fg(n){return n.dimension.property}function Ag(n,t){return n.dimension.getDimension(t)}function Rg(n,t){Vl(Ig(n,t),[t.shrinkingClass,t.growingClass])}function Bg(n,t){Gr(n.element(),t.openClass),Lr(n.element(),t.closedClass),hi(n.element(),Fg(t),"0px"),$o(n.element())}function Vg(n,t){Gr(n.element(),t.closedClass),Lr(n.element(),t.openClass),Uo(n.element(),Fg(t))}function Ng(n,t,e,r){e.setCollapsed(),hi(n.element(),Fg(t),Ag(t,n.element())),$o(n.element()),Rg(n,t),Bg(n,t),t.onStartShrink(n),t.onShrunk(n)}function jg(n,t,e,r){var o=r.getOrThunk((function(){return Ag(t,n.element())}));e.setCollapsed(),hi(n.element(),Fg(t),o),$o(n.element());var i=Ig(n,t);Gr(i,t.growingClass),Lr(i,t.shrinkingClass),Bg(n,t),t.onStartShrink(n)}function _g(n,t,e){var r=Ag(t,n.element());("0px"===r?Ng:jg)(n,t,e,Dn.some(r))}function Pg(n,t,e){var r=Ig(n,t),o=Ur(r,t.shrinkingClass),i=Ag(t,n.element());Vg(n,t);var u=Ag(t,n.element());(o?function(){hi(n.element(),Fg(t),i),$o(n.element())}:function(){Bg(n,t)})(),Gr(r,t.shrinkingClass),Lr(r,t.growingClass),Vg(n,t),hi(n.element(),Fg(t),u),e.setExpanded(),t.onStartGrow(n)}function Hg(n,t,e){return!0===Ur(Ig(n,t),t.growingClass)}function zg(n,t,e){return!0===Ur(Ig(n,t),t.shrinkingClass)}function Lg(t,e){var o=Bd(ad.sketch({dom:{tag:"div",classes:[di.resolve("dropup")]},components:[],containerBehaviours:lo([Kd.config({}),Zg.config({closedClass:di.resolve("dropup-closed"),openClass:di.resolve("dropup-open"),shrinkingClass:di.resolve("dropup-shrinking"),growingClass:di.resolve("dropup-growing"),dimension:{property:"height"},onShrunk:function(n){t(),e(),Kd.set(n,[])},onGrown:function(n){t(),e()}}),fi((function(n,t){i(r)}))])})),i=function(t){n.window.requestAnimationFrame((function(){t(),Zg.shrink(o)}))};return{appear:function(t,e,r){!0===Zg.hasShrunk(o)&&!1===Zg.isTransitioning(o)&&n.window.requestAnimationFrame((function(){e(r),Kd.set(o,[t()]),Zg.grow(o)}))},disappear:i,component:u(o),element:o.element}}function Gg(t,e){var r=je("Getting GUI events settings",tp,e),o=z().deviceType.isTouch()?["touchstart","touchmove","touchend","touchcancel","gesturestart"]:["mousedown","mouseup","mouseover","mousemove","mouseout","click"],i=Tm(r),u=st(o.concat(["selectstart","input","contextmenu","change","transitionend","drag","dragstart","dragend","dragenter","dragleave","dragover","drop","keyup"]),(function(n){return Kl(t,n,(function(t){i.fireIfReady(t,n).each((function(n){n&&t.kill()})),r.triggerEvent(n,t)&&t.kill()}))})),c=Bn(Dn.none()),a=Kl(t,"paste",(function(t){i.fireIfReady(t,"paste").each((function(n){n&&t.kill()})),r.triggerEvent("paste",t)&&t.kill(),c.set(Dn.some(n.setTimeout((function(){r.triggerEvent(Bt(),t)}),0)))})),f=Kl(t,"keydown",(function(n){r.triggerEvent("keydown",n)?n.kill():!0===r.stopBackspace&&function(n){return 8===n.raw().which&&!O(["input","textarea"],X(n.target()))&&!function(n){return Oi(n,'[contenteditable="true"]',void 0).isSome()}(n.target())}(n)&&n.prevent()})),s=function(n,t){return np?Jl(n,"focus",t):Kl(n,"focusin",t)}(t,(function(n){r.triggerEvent("focusin",n)&&n.kill()})),l=Bn(Dn.none()),d=function(n,t){return np?Jl(n,"blur",t):Kl(n,"focusout",t)}(t,(function(t){r.triggerEvent("focusout",t)&&t.kill(),l.set(Dn.some(n.setTimeout((function(){r.triggerEvent(Rt(),t)}),0)))}));return{unbind:function(){E(u,(function(n){n.unbind()})),f.unbind(),s.unbind(),d.unbind(),a.unbind(),c.get().each(n.clearTimeout),l.get().each(n.clearTimeout)}}}function Ug(n,t){var e=Te(n,"target").map((function(n){return n()})).getOr(t);return Bn(e)}function $g(n,t,e,r,o,i){var c=n(t,r),a=function(n,t){var e=Bn(!1),r=Bn(!1);return{stop:function(){e.set(!0)},cut:function(){r.set(!0)},isStopped:e.get,isCut:r.get,event:u(n),setSource:t.set,getSource:t.get}}(e,o);return c.fold((function(){return i.logEventNoHandlers(t,r),ep.complete()}),(function(n){var e=n.descHandler();return Al(e)(a),a.isStopped()?(i.logEventStopped(t,n.element(),e.purpose()),ep.stopped()):a.isCut()?(i.logEventCut(t,n.element(),e.purpose()),ep.complete()):cn(n.element()).fold((function(){return i.logNoParent(t,n.element(),e.purpose()),ep.complete()}),(function(r){return i.logEventResponse(t,n.element(),e.purpose()),ep.resume(r)}))}))}function Wg(n,t,e){var o=function(n){var t=Bn(!1);return{stop:function(){t.set(!0)},cut:r,isStopped:t.get,isCut:u(!1),event:u(n),setSource:f("Cannot set source of a broadcasted event"),getSource:f("Cannot get source of a broadcasted event")}}(t);return E(n,(function(n){Al(n.descHandler())(o)})),o.isStopped()}var Xg=function(n){return Bd(ns.sketch({dom:es('<div class="${prefix}-mask-edit-icon ${prefix}-icon"></div>'),action:function(){n.run((function(n){n.setReadOnly(!1)}))}}))},qg=function(){return Bd(ad.sketch({dom:es('<div class="${prefix}-editor-socket"></div>'),components:[],containerBehaviours:lo([Kd.config({})])}))},Yg=function(n,t,e,r){(!0===e?vo.toAlpha:vo.toOmega)(r),(e?Dg:Mg)(n,t)},Kg=Object.freeze({refresh:function(n,t,e){if(e.isExpanded()){Uo(n.element(),Fg(t));var r=Ag(t,n.element());hi(n.element(),Fg(t),r)}},grow:function(n,t,e){e.isExpanded()||Pg(n,t,e)},shrink:function(n,t,e){e.isExpanded()&&_g(n,t,e)},immediateShrink:function(n,t,e){e.isExpanded()&&Ng(n,t,e)},hasGrown:function(n,t,e){return e.isExpanded()},hasShrunk:function(n,t,e){return e.isCollapsed()},isGrowing:Hg,isShrinking:zg,isTransitioning:function(n,t,e){return!0===Hg(n,t)||!0===zg(n,t)},toggleGrow:function(n,t,e){(e.isExpanded()?_g:Pg)(n,t,e)},disableTransitions:Rg}),Jg=Object.freeze({exhibit:function(n,t){return Ir(t.expanded?{classes:[t.openClass],styles:{}}:{classes:[t.closedClass],styles:Sn(t.dimension.property,"0px")})},events:function(n,t){return Sr([function(e){return Er(e)((function(e,r){r.event().raw().propertyName===n.dimension.property&&(Rg(e,n),t.isExpanded()&&Uo(e.element(),n.dimension.property),(t.isExpanded()?n.onGrown:n.onShrunk)(e))}))}(Mt())])}}),Qg=[Pe("closedClass"),Pe("openClass"),Pe("shrinkingClass"),Pe("growingClass"),Le("getAnimationRoot"),ko("onShrunk"),ko("onStartShrink"),ko("onGrown"),ko("onStartGrow"),We("expanded",!1),He("dimension",_e("property",{width:[Mo("property","width"),Mo("getDimension",(function(n){return La(n)+"px"}))],height:[Mo("property","height"),Mo("getDimension",(function(n){return bi(n)+"px"}))]}))],Zg=Rr({fields:Qg,name:"sliding",active:Jg,apis:Kg,state:Object.freeze({init:function(n){var t=Bn(n.expanded);return so({isExpanded:function(){return!0===t.get()},isCollapsed:function(){return!1===t.get()},setCollapsed:c(t.set,!1),setExpanded:c(t.set,!0),readState:function(){return"expanded: "+t.get()}})}})}),np=z().browser.isFirefox(),tp=Ae([He("triggerEvent",yr),We("stopBackspace",!0)]),ep=me([{stopped:[]},{resume:["element"]},{complete:[]}]),rp=function(n,t,e,r,o,i){return $g(n,t,e,r,o,i).fold((function(){return!0}),(function(r){return rp(n,t,e,r,o,i)}),(function(){return!1}))},op=function(n,t,e,r,o){var i=Ug(e,r);return rp(n,t,e,r,i,o)},ip=K("element","descHandler");function up(){var n=function(){var n={};return{registerId:function(t,e,r){Fn(r,(function(r,o){var i=void 0!==n[o]?n[o]:{};i[e]=function(n,t){return function(n,t){return{cHandler:n,purpose:u(t)}}(c.apply(void 0,[n.handler].concat(t)),n.purpose())}(r,t),n[o]=i}))},unregisterId:function(t){Fn(n,(function(n,e){n.hasOwnProperty(t)&&delete n[t]}))},filterByType:function(t){return Te(n,t).map((function(n){return Rn(n,(function(n,t){return function(n,t){return{id:u(n),descHandler:u(t)}}(t,n)}))})).getOr([])},find:function(t,e,r){var o=Se(e)(n);return function(n,t,e){return wr(n,(function(n){return t(n).isSome()}),e).bind(t)}(r,(function(n){return function(n,t){return Da(t).fold((function(){return Dn.none()}),(function(e){var r=Se(e);return n.bind(r).map((function(n){return ip(t,n)}))}))}(o,n)}),t)}}}(),t={},e=function(e){Da(e.element()).each((function(e){delete t[e],n.unregisterId(e)}))};return{find:function(t,e,r){return n.find(t,e,r)},filter:function(t){return n.filterByType(t)},register:function(r){var o=function(n){var t=n.element();return Da(t).fold((function(){return function(n,t){var e=Pu(ka+"uid-");return Ca(t,e),e}(0,n.element())}),(function(n){return n}))}(r);On(t,o)&&function(n,r){var o=t[r];if(o!==n)throw new Error('The tagId "'+r+'" is already used by: '+Jr(o.element())+"\nCannot use it for: "+Jr(n.element())+"\nThe conflicting element is"+(Y(o.element())?" ":" not ")+"already in the DOM");e(n)}(r,o);var i=[r];n.registerId(i,o,r.events()),t[o]=r},unregister:e,getById:function(n){return Se(n)(t)}}}var cp=u(di.resolve("readonly-mode")),ap=u(di.resolve("edit-mode"));function fp(n){return function(n){function t(t){return cn(n.element()).fold((function(){return!0}),(function(n){return on(t,n)}))}function e(n,e){return i.find(t,n,e)}function o(n){E(i.filter(Vt()),(function(t){Al(t.descHandler())(n)}))}var i=up(),c=Gg(n.element(),{triggerEvent:function(n,t){return To(n,t.target(),(function(r){return function(n,t,e,r){var o=e.target();return op(n,t,e,o,r)}(e,n,t,r)}))}}),a={debugInfo:u("real"),triggerEvent:function(n,t,r){To(n,t,(function(o){op(e,n,r,t,o)}))},triggerFocus:function(n,t){Da(n).fold((function(){Wr(n)}),(function(o){To(At(),n,(function(o){!function(n,t,e,r,o){$g(n,t,e,r,Ug(e,r),o)}(e,At(),{originator:u(t),kill:r,prevent:r,target:u(n)},n,o)}))}))},triggerEscape:function(n,t){a.triggerEvent("keydown",n.element(),t.event())},getByUid:function(n){return h(n)},getByDom:function(n){return v(n)},build:Bd,addToGui:function(n){l(n)},removeFromGui:function(n){d(n)},addToWorld:function(n){f(n)},removeFromWorld:function(n){s(n)},broadcast:function(n){m(n)},broadcastOn:function(n,t){g(n,t)},broadcastEvent:function(n,t){p(n,t)},isConnected:u(!0)},f=function(n){n.connect(a),Zt(n.element())||(i.register(n),E(n.components(),f),a.triggerEvent(Ht(),n.element(),{target:u(n.element())}))},s=function(n){Zt(n.element())||(E(n.components(),s),i.unregister(n)),n.disconnect()},l=function(t){!function(n,t){fe(n,t,ie)}(n,t)},d=function(n){pn(n)},m=function(n){o({universal:u(!0),data:u(n)})},g=function(n,t){o({universal:u(!1),channels:u(n),data:u(t)})},p=function(n,t){return Wg(i.filter(n),t)},h=function(n){return i.getById(n).fold((function(){return de.error(new Error('Could not find component with uid: "'+n+'" in system.'))}),de.value)},v=function(n){var t=Da(n).getOr("not found");return h(t)};return f(n),{root:u(n),element:n.element,destroy:function(){c.unbind(),ue(n.element())},add:l,remove:d,getByUid:h,getByDom:v,addToWorld:f,removeFromWorld:s,broadcast:m,broadcastOn:g,broadcastEvent:p}}(Bd(ad.sketch({dom:{classes:[di.resolve("outer-container")].concat(n.classes)},containerBehaviours:lo([vo.config({alpha:cp(),omega:ap()})])})))}var sp,lp,dp=function(n,t){var e=qt.fromTag("input");zo(e,{opacity:"0",position:"absolute",top:"-1000px",left:"-1000px"}),ie(n,e),Wr(e),t(e),ue(e)},mp=function(n){var t=n.getSelection();if(0<t.rangeCount){var e=t.getRangeAt(0),r=n.document.createRange();r.setStart(e.startContainer,e.startOffset),r.setEnd(e.endContainer,e.endOffset),t.removeAllRanges(),t.addRange(r)}},gp=function(n,t){qr().each((function(n){on(n,t)||Xr(n)})),n.focus(),Wr(qt.fromDom(n.document.body)),mp(n)},pp={stubborn:function(n,t,e,r){function o(){gp(t,r)}var i=Kl(e,"keydown",(function(n){O(["input","textarea"],X(n.target()))||o()}));return{toReading:function(){dp(n,Xr)},toEditing:o,onToolbarTouch:function(){},destroy:function(){i.unbind()}}},timid:function(n,t,e,o){function i(){Xr(o)}return{toReading:function(){i()},toEditing:function(){gp(t,o)},onToolbarTouch:function(){i()},destroy:r}}},hp={},vp={exports:hp};function yp(t){n.setTimeout((function(){throw t}),0)}function bp(n,t){var e=un(n).dom().defaultView;return bi(n)+bi(t)-function(n){var t=bm(n).isPortrait(),e=function(n){return function(n,t){return Zr([{width:320,height:480,keyboard:{portrait:300,landscape:240}},{width:320,height:568,keyboard:{portrait:300,landscape:240}},{width:375,height:667,keyboard:{portrait:305,landscape:240}},{width:414,height:736,keyboard:{portrait:320,landscape:240}},{width:768,height:1024,keyboard:{portrait:320,landscape:400}},{width:1024,height:1366,keyboard:{portrait:380,landscape:460}}],(function(e){return function(n,t){return n?Dn.some(t):Dn.none()}(n<=e.width&&t<=e.height,e.keyboard)})).getOr({portrait:t/5,landscape:n/4})}(n.screen.width,n.screen.height)}(n),r=t?e.portrait:e.landscape;return(t?n.screen.height:n.screen.width)-n.innerHeight>r?0:r}(e)}function xp(n){return Em(n,Np)}function wp(n,t){var e=function(n){return jr(n,jp)}(n);return Vp.fixed(n,e,t)}function Sp(n,t){return Vp.scroller(n,t)}function Tp(n){var t=xp(n);return("true"===jr(n,_p)?Sp:wp)(n,t)}function Op(n,t,e){var r=un(n).dom().defaultView.innerHeight;return Vr(n,Pp,r+"px"),r-t-e}function kp(n){var t=Go(n,"top").getOr("0");return parseInt(t,10)}function Ep(n){return parseInt(n.dom().scrollTop,10)}function Cp(n,t){var e=t+zp(n)+"px";hi(n,"top",e)}sp=hp,lp=vp,function(n){"object"==typeof sp&&void 0!==lp?lp.exports=n():("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EphoxContactWrapper=n()}((function(){return function n(t,e,r){function o(u,c){if(!e[u]){if(!t[u]){if(i)return i(u,!0);var a=new Error("Cannot find module '"+u+"'");throw a.code="MODULE_NOT_FOUND",a}var f=e[u]={exports:{}};t[u][0].call(f.exports,(function(n){return o(t[u][1][n]||n)}),f,f.exports,n,t,e,r)}return e[u].exports}for(var i=!1,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(n,t,e){var r,o,i=t.exports={};function u(){throw new Error("setTimeout has not been defined")}function c(){throw new Error("clearTimeout has not been defined")}function a(n){if(r===setTimeout)return setTimeout(n,0);if((r===u||!r)&&setTimeout)return r=setTimeout,setTimeout(n,0);try{return r(n,0)}catch(t){try{return r.call(null,n,0)}catch(t){return r.call(this,n,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:u}catch(n){r=u}try{o="function"==typeof clearTimeout?clearTimeout:c}catch(n){o=c}}();var f,s=[],l=!1,d=-1;function m(){l&&f&&(l=!1,f.length?s=f.concat(s):d=-1,s.length&&g())}function g(){if(!l){var n=a(m);l=!0;for(var t=s.length;t;){for(f=s,s=[];++d<t;)f&&f[d].run();d=-1,t=s.length}f=null,l=!1,function(n){if(o===clearTimeout)return clearTimeout(n);if((o===c||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(n);try{return o(n)}catch(t){try{return o.call(null,n)}catch(t){return o.call(this,n)}}}(n)}}function p(n,t){this.fun=n,this.array=t}function h(){}i.nextTick=function(n){var t=new Array(arguments.length-1);if(1<arguments.length)for(var e=1;e<arguments.length;e++)t[e-1]=arguments[e];s.push(new p(n,t)),1!==s.length||l||a(g)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=h,i.addListener=h,i.once=h,i.off=h,i.removeListener=h,i.removeAllListeners=h,i.emit=h,i.prependListener=h,i.prependOnceListener=h,i.listeners=function(n){return[]},i.binding=function(n){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(n){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],2:[function(n,t,e){(function(n){function e(){}function r(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(n,this)}function o(n,t){for(;3===n._state;)n=n._value;0!==n._state?(n._handled=!0,r._immediateFn((function(){var e=1===n._state?t.onFulfilled:t.onRejected;if(null!==e){var r;try{r=e(n._value)}catch(n){return void u(t.promise,n)}i(t.promise,r)}else(1===n._state?i:u)(t.promise,n._value)}))):n._deferreds.push(t)}function i(n,t){try{if(t===n)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var e=t.then;if(t instanceof r)return n._state=3,n._value=t,void c(n);if("function"==typeof e)return void f(function(n,t){return function(){n.apply(t,arguments)}}(e,t),n)}n._state=1,n._value=t,c(n)}catch(t){u(n,t)}}function u(n,t){n._state=2,n._value=t,c(n)}function c(n){2===n._state&&0===n._deferreds.length&&r._immediateFn((function(){n._handled||r._unhandledRejectionFn(n._value)}));for(var t=0,e=n._deferreds.length;t<e;t++)o(n,n._deferreds[t]);n._deferreds=null}function a(n,t,e){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof t?t:null,this.promise=e}function f(n,t){var e=!1;try{n((function(n){e||(e=!0,i(t,n))}),(function(n){e||(e=!0,u(t,n))}))}catch(n){if(e)return;e=!0,u(t,n)}}var s;s=setTimeout,r.prototype.catch=function(n){return this.then(null,n)},r.prototype.then=function(n,t){var r=new this.constructor(e);return o(this,new a(n,t,r)),r},r.all=function(n){var t=Array.prototype.slice.call(n);return new r((function(n,e){if(0===t.length)return n([]);var r=t.length;function o(i,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var c=u.then;if("function"==typeof c)return void c.call(u,(function(n){o(i,n)}),e)}t[i]=u,0==--r&&n(t)}catch(n){e(n)}}for(var i=0;i<t.length;i++)o(i,t[i])}))},r.resolve=function(n){return n&&"object"==typeof n&&n.constructor===r?n:new r((function(t){t(n)}))},r.reject=function(n){return new r((function(t,e){e(n)}))},r.race=function(n){return new r((function(t,e){for(var r=0,o=n.length;r<o;r++)n[r].then(t,e)}))},r._immediateFn="function"==typeof n?function(t){n(t)}:function(n){s(n,0)},r._unhandledRejectionFn=function(n){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",n)},r._setImmediateFn=function(n){r._immediateFn=n},r._setUnhandledRejectionFn=function(n){r._unhandledRejectionFn=n},void 0!==t&&t.exports?t.exports=r:this.Promise||(this.Promise=r)}).call(this,n("timers").setImmediate)},{timers:3}],3:[function(n,t,e){(function(t,r){var o=n("process/browser.js").nextTick,i=Function.prototype.apply,u=Array.prototype.slice,c={},a=0;function f(n,t){this._id=n,this._clearFn=t}e.setTimeout=function(){return new f(i.call(setTimeout,window,arguments),clearTimeout)},e.setInterval=function(){return new f(i.call(setInterval,window,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(n){n.close()},f.prototype.unref=f.prototype.ref=function(){},f.prototype.close=function(){this._clearFn.call(window,this._id)},e.enroll=function(n,t){clearTimeout(n._idleTimeoutId),n._idleTimeout=t},e.unenroll=function(n){clearTimeout(n._idleTimeoutId),n._idleTimeout=-1},e._unrefActive=e.active=function(n){clearTimeout(n._idleTimeoutId);var t=n._idleTimeout;0<=t&&(n._idleTimeoutId=setTimeout((function(){n._onTimeout&&n._onTimeout()}),t))},e.setImmediate="function"==typeof t?t:function(n){var t=a++,r=!(arguments.length<2)&&u.call(arguments,1);return c[t]=!0,o((function(){c[t]&&(r?n.apply(null,r):n.call(null),e.clearImmediate(t))})),t},e.clearImmediate="function"==typeof r?r:function(n){delete c[n]}}).call(this,n("timers").setImmediate,n("timers").clearImmediate)},{"process/browser.js":1,timers:3}],4:[function(n,t,e){var r=n("promise-polyfill"),o="undefined"!=typeof window?window:Function("return this;")();t.exports={boltExport:o.Promise||r}},{"promise-polyfill":2}]},{},[4])(4)}));var Dp=vp.exports.boltExport,Mp=function(t){var e=Dn.none(),r=[],o=function(n){i()?u(n):r.push(n)},i=function(){return e.isSome()},u=function(t){e.each((function(e){n.setTimeout((function(){t(e)}),0)}))};return t((function(n){e=Dn.some(n),function(n){E(n,u)}(r),r=[]})),{get:o,map:function(n){return Mp((function(t){o((function(e){t(n(e))}))}))},isReady:i}},Ip={nu:Mp,pure:function(n){return Mp((function(t){t(n)}))}},Fp=function(n){function t(t){n().then(t,yp)}return{map:function(t){return Fp((function(){return n().then(t)}))},bind:function(t){return Fp((function(){return n().then((function(n){return t(n).toPromise()}))}))},anonBind:function(t){return Fp((function(){return n().then((function(){return t.toPromise()}))}))},toLazy:function(){return Ip.nu(t)},toCached:function(){var t=null;return Fp((function(){return null===t&&(t=n()),t}))},toPromise:n,get:t}},Ap=function(n){return Fp((function(){return new Dp(n)}))},Rp=bp,Bp=function(n,t,e){var r=bp(t,e),o=bi(t)+bi(e)-r;hi(n,"padding-bottom",o+"px")},Vp=me([{fixed:["element","property","offsetY"]},{scroller:["element","offsetY"]}]),Np="data-"+di.resolve("position-y-fixed"),jp="data-"+di.resolve("y-property"),_p="data-"+di.resolve("scrolling"),Pp="data-"+di.resolve("last-window-height"),Hp=function(n,t,e,r){function o(){var t=u.innerHeight;return function(n){return Em(n,Pp)}(n)<t}function i(){if(m){var o=bi(e),i=bi(r),u=Op(n,o,i);Vr(n,Np,o+"px"),hi(n,"height",u+"px"),Bp(t,n,r)}}var u=un(n).dom().defaultView,c=function(n){var t=jr(n,"style");return zo(n,{position:"absolute",top:"0px"}),Vr(n,Np,"0px"),Vr(n,jp,"top"),{restore:function(){Vr(n,"style",t||""),Pr(n,Np),Pr(n,jp)}}}(e),f=bi(e),s=bi(r),l=function(n,t,e){var r=jr(e,"style");return am.register(e),zo(e,{position:"absolute",height:t+"px",width:"100%",top:n+"px"}),Vr(e,Np,n+"px"),Vr(e,_p,"true"),Vr(e,jp,"top"),{restore:function(){am.deregister(e),Vr(e,"style",r||""),Pr(e,Np),Pr(e,_p),Pr(e,jp)}}}(f,Op(n,f,s),n),d=function(n){var t=jr(n,"style");return zo(n,{position:"absolute",bottom:"0px"}),Vr(n,Np,"0px"),Vr(n,jp,"bottom"),{restore:function(){Vr(n,"style",t||""),Pr(n,Np),Pr(n,jp)}}}(r),m=!0;return Bp(t,n,r),{setViewportOffset:function(t){Vr(n,Np,t+"px"),i()},isExpanding:o,isShrinking:a(o),refresh:i,restore:function(){m=!1,c.restore(),l.restore(),d.restore()}}},zp=xp,Lp=function(){var n=null;return{animate:function(t,e,r,o,i,u){function c(n){a=!0,i(n)}var a=!1;function f(t){ym.clearInterval(n),c(t)}ym.clearInterval(n),n=ym.setInterval((function(){var i=t();(function(n,t,e){return Math.abs(n-t)<=e?Dn.none():n<t?Dn.some(n+e):Dn.some(n-e)})(i,e,r).fold((function(){ym.clearInterval(n),c(e)}),(function(r){if(o(r,f),!a){var u=t();(u!==r||Math.abs(u-e)>Math.abs(i-e))&&(ym.clearInterval(n),c(e))}}))}),u)}}}(),Gp="data-"+di.resolve("last-scroll-top"),Up=function(n,t){return Ap((function(e){var r=c(Ep,n);Vr(n,Gp,r());var o=Math.abs(t-r()),i=Math.ceil(o/10);Lp.animate(r,t,i,(function(t,e){Em(n,Gp)!==n.dom().scrollTop?e(n.dom().scrollTop):(n.dom().scrollTop=t,Vr(n,Gp,t))}),(function(){n.dom().scrollTop=t,Vr(n,Gp,t),e(t)}),10)}))},$p=function(n,t){return Ap((function(e){function r(t){hi(n,"top",t+"px")}var o=c(kp,n),i=Math.abs(t-o()),u=Math.ceil(i/10);Lp.animate(o,t,u,r,(function(){r(t),e(t)}),10)}))};var Wp=function(n,t,e,r,o){var i=Rp(t,e),u=c(mp,n);i<r||i<o?Up(t,t.dom().scrollTop-i+o).get(u):r<0&&Up(t,t.dom().scrollTop+r).get(u)},Xp=function(n,t){var e=function(n){var t=xi(n,"["+Np+"]");return st(t,Tp)}(n);return function(n){return function(n,t){return t((function(t){var e=[],r=0;0===n.length?t([]):E(n,(function(o,i){o.get(function(o){return function(i){e[o]=i,++r>=n.length&&t(e)}}(i))}))}))}(n,Ap)}(st(e,(function(n){return function(n,t){return n.fold((function(n,e,r){return function(n,t,e,r){return hi(n,t,e+r+"px"),function(n){return Fp((function(){return Dp.resolve(n)}))}(r)}(n,e,t,r)}),(function(n,e){return function(n,t,e){var r=t+e,o=Go(n,"top").getOr(e),i=r-parseInt(o,10),u=n.dom().scrollTop+i;return function(n,t,e){return Ap((function(r){var o=c(Ep,n);Lp.animate(o,t,15,(function(t){n.dom().scrollTop=t,hi(n,"top",kp(n)+15+"px")}),(function(){n.dom().scrollTop=t,hi(n,"top",e+"px"),r(t)}),10)}))}(n,u,r)}(n,t,e)}))}(n,t)})))},qp=function(t,e){var i=pg(),c=Dl(),a=Dl(),f=Cl(),s=Cl();return{enter:function(){e.hide();var l=qt.fromDom(n.document);ag.getActiveApi(t.editor).each((function(e){c.set({socketHeight:Go(t.socket,"height"),iframeHeight:Go(e.frame(),"height"),outerScroll:n.document.body.scrollTop}),a.set({exclusives:Eg(l,"."+am.scrollable())}),Lr(t.container,di.resolve("fullscreen-maximized")),mg(t.container,e.body()),i.maximize(),hi(t.socket,"overflow","scroll"),hi(t.socket,"-webkit-overflow-scrolling","touch"),Wr(e.body());var d=Z(["cWin","ceBody","socket","toolstrip","toolbar","dropup","contentElement","cursor","keyboardType","isScrolling","outerWindow","outerBody"],[]);f.set(function(n){var t=n.cWin(),e=n.ceBody(),i=n.socket(),c=n.toolstrip(),a=n.toolbar(),f=n.contentElement(),s=n.keyboardType(),l=n.outerWindow(),d=n.dropup(),m=Hp(i,e,c,d),g=s(n.outerBody(),t,ne(),f,c,a),p=xm(l,{onChange:r,onReady:m.refresh});p.onAdjustment((function(){m.refresh()}));var h=Kl(qt.fromDom(l),"resize",(function(){m.isExpanding()&&m.refresh()})),v=function(n,t,e,r,i,c){var a=function(n){var t=Bn(Ip.pure({}));return{start:function(e){var r=Ip.nu((function(t){return n(e).get(t)}));t.set(r)},idle:function(n){t.get().get((function(){n()}))}}}((function(e){return function(n,t,e){var r=un(n).dom().defaultView;return Ap((function(o){Cp(n,e),Cp(t,e),r.scrollTo(0,e),o(e)}))}(n,t,e)})),f=Ym((function(){a.idle((function(){Xp(e,r.pageYOffset).get((function(){(function(){var n=ig(c);return Dn.from(n[0]).bind((function(n){var e=n.top()-t.dom().scrollTop;return e>r.innerHeight+5||e<-5?Dn.some({top:u(e),bottom:u(e+n.height())}):Dn.none()}))})().each((function(n){t.dom().scrollTop=t.dom().scrollTop+n.top()})),a.start(0),i.refresh()}))}))}),1e3),s=Kl(qt.fromDom(r),"scroll",(function(){r.pageYOffset<0||f.throttle()}));return Xp(e,r.pageYOffset).get(o),{unbind:s.unbind}}(c,i,n.outerBody(),l,m,t),y=function(n,t){var e=n.document,r=qt.fromTag("div");function o(n){var t=qt.fromTag("span");return Bl(t,[di.resolve("layer-editor"),di.resolve("unfocused-selection")]),zo(t,{left:n.left()+"px",top:n.top()+"px",width:n.width()+"px",height:n.height()+"px"}),t}Lr(r,di.resolve("unfocused-selections")),ie(qt.fromDom(e.documentElement),r);var i=Kl(r,"touchstart",(function(e){e.prevent(),gp(n,t),u()})),u=function(){mn(r)};return{update:function(){u();var t=ig(n),e=st(t,o);dn(r,e)},isActive:function(){return 0<oe(r).length},destroy:function(){i.unbind(),ue(r)},clear:u}}(t,f),b=function(){y.clear()};return{toEditing:function(){g.toEditing(),b()},toReading:function(){g.toReading()},onToolbarTouch:function(n){g.onToolbarTouch(n)},refreshSelection:function(){y.isActive()&&y.update()},clearSelection:b,highlightSelection:function(){y.update()},scrollIntoView:function(n,e){Wp(t,i,d,n,e)},updateToolbarPadding:r,setViewportOffset:function(n){m.setViewportOffset(n),$p(i,n).get(o)},syncHeight:function(){hi(f,"height",f.dom().contentWindow.document.body.scrollHeight+"px")},refreshStructure:m.refresh,destroy:function(){m.restore(),p.destroy(),v.unbind(),h.unbind(),g.destroy(),y.destroy(),dp(ne(),Xr)}}}(d({cWin:e.win(),ceBody:e.body(),socket:t.socket,toolstrip:t.toolstrip,toolbar:t.toolbar,dropup:t.dropup.element(),contentElement:e.frame(),cursor:r,outerBody:t.body,outerWindow:t.win,keyboardType:pp.stubborn,isScrolling:function(){return a.get().exists((function(n){return n.socket.isScrolling()}))}}))),f.run((function(n){n.syncHeight()})),s.set(function(n,t,e,r){function o(){t.run((function(n){n.refreshSelection()}))}function i(n,e){var o=n-r.dom().scrollTop;t.run((function(n){n.scrollIntoView(o,o+e)}))}function u(){t.run((function(n){n.clearSelection()}))}function c(){n.getCursorBox().each((function(n){i(n.top(),n.height())})),t.run((function(n){n.syncHeight()}))}var a=Om(n),f=Ym(c,300),s=[n.onKeyup((function(){u(),f.throttle()})),n.onNodeChanged(o),n.onDomChanged(f.throttle),n.onDomChanged(o),n.onScrollToCursor((function(n){n.preventDefault(),f.throttle()})),n.onScrollToElement((function(n){n.element(),i(t,r)})),n.onToEditing((function(){t.run((function(n){n.toEditing()}))})),n.onToReading((function(){t.run((function(n){n.toReading()}))})),Kl(n.doc(),"touchend",(function(t){on(n.html(),t.target())||on(n.body(),t.target())})),Kl(e,"transitionend",(function(n){"height"===n.raw().propertyName&&function(){var n=bi(e);t.run((function(t){t.setViewportOffset(n)})),o(),c()}()})),Jl(e,"touchstart",(function(e){t.run((function(n){n.highlightSelection()})),function(n){t.run((function(t){t.onToolbarTouch(n)}))}(e),n.onTouchToolstrip()})),Kl(n.body(),"touchstart",(function(t){u(),n.onTouchContent(),a.fireTouchstart(t)})),a.onTouchmove(),a.onTouchend(),Kl(n.body(),"click",(function(n){n.kill()})),Kl(e,"touchmove",(function(){n.onToolbarScrollStart()}))];return{destroy:function(){E(s,(function(n){n.unbind()}))}}}(e,f,t.toolstrip,t.socket,t.dropup))}))},refreshStructure:function(){f.run((function(n){n.refreshStructure()}))},exit:function(){i.restore(),s.clear(),f.clear(),e.show(),c.on((function(e){e.socketHeight.each((function(n){hi(t.socket,"height",n)})),e.iframeHeight.each((function(n){hi(t.editor.getFrame(),"height",n)})),n.document.body.scrollTop=e.scrollTop})),c.clear(),a.on((function(n){n.exclusives.unbind()})),a.clear(),Gr(t.container,di.resolve("fullscreen-maximized")),gg(),am.deregister(t.toolbar),Uo(t.socket,"overflow"),Uo(t.socket,"-webkit-overflow-scrolling"),Xr(t.editor.getFrame()),ag.getActiveApi(t.editor).each((function(n){n.clearSelection()}))}}};function Yp(n,t,e){n.system().broadcastOn([wo.formatChanged()],{command:t,state:e})}var Kp=tinymce.util.Tools.resolve("tinymce.EditorManager"),Jp=function(n){var t=Te(n.settings,"skin_url").fold((function(){return Kp.baseURL+"/skins/ui/oxide"}),(function(n){return n}));return{content:t+"/content.mobile.min.css",ui:t+"/skin.mobile.min.css"}},Qp=function(n,t){E(Mn(t.formatter.get()),(function(e){t.formatter.formatChanged(e,(function(t){Yp(n,e,t)}))})),E(["ul","ol"],(function(e){t.selection.selectorChanged(e,(function(t,r){Yp(n,e,t)}))}))},Zp=(u(["x-small","small","medium","large","x-large"]),function(n){function t(){n._skinLoaded=!0,n.fire("SkinLoaded")}return function(){n.initialized?t():n.on("init",t)}}),nh=u("toReading"),th=u("toEditing");bo.add("mobile",(function(n){return{getNotificationManagerImpl:function(){return{open:u({progressBar:{value:r},close:r,text:r,getEl:u(null),moveTo:r,moveRel:r,settings:{}}),close:r,reposition:r,getArgs:u({})}},renderUI:function(){var t=n.getElement(),e=Jp(n);function o(){n.fire("ScrollIntoView")}!1===function(n){return!1===n.settings.skin}(n)?(n.contentCSS.push(e.content),yo.DOM.styleSheetLoader.load(e.ui,Zp(n))):Zp(n)();var i=z().os.isAndroid()?function(n){var t=fp({classes:[di.resolve("android-container")]}),e=Cg(),o=Cl(),i=Xg(o),c=qg(),a=Lg(r,n);return t.add(e.wrapper()),t.add(c),t.add(a.component()),{system:u(t),element:t.element,init:function(n){o.set(function(n){var t=je("Getting AndroidWebapp schema",yg,n);hi(t.toolstrip,"width","100%");var e=Bd(vg((function(){t.setReadOnly(t.readOnlyOnInit()),i.enter()}),t.translate));t.alloy.add(e);var o={show:function(){t.alloy.add(e)},hide:function(){t.alloy.remove(e)}};ie(t.container,e.element());var i=hg(t,o);return{setReadOnly:t.setReadOnly,refreshStructure:r,enter:i.enter,exit:i.exit,destroy:r}}(n))},exit:function(){o.run((function(n){n.exit(),Kd.remove(c,i)}))},setToolbarGroups:function(n){var t=e.createGroups(n);e.setGroups(t)},setContextToolbar:function(n){var t=e.createGroups(n);e.setContextToolbar(t)},focusToolbar:function(){e.focus()},restoreToolbar:function(){e.restoreToolbar()},updateMode:function(n){Yg(c,i,n,t.root())},socket:u(c),dropup:u(a)}}(o):function(n){var t=fp({classes:[di.resolve("ios-container")]}),e=Cg(),o=Cl(),i=Xg(o),c=qg(),a=Lg((function(){o.run((function(n){n.refreshStructure()}))}),n);return t.add(e.wrapper()),t.add(c),t.add(a.component()),{system:u(t),element:t.element,init:function(n){o.set(function(n){var t=je("Getting IosWebapp schema",yg,n);hi(t.toolstrip,"width","100%"),hi(t.container,"position","relative");var e=Bd(vg((function(){t.setReadOnly(t.readOnlyOnInit()),i.enter()}),t.translate));t.alloy.add(e);var o={show:function(){t.alloy.add(e)},hide:function(){t.alloy.remove(e)}},i=qp(t,o);return{setReadOnly:t.setReadOnly,refreshStructure:i.refreshStructure,enter:i.enter,exit:i.exit,destroy:r}}(n))},exit:function(){o.run((function(n){Kd.remove(c,i),n.exit()}))},setToolbarGroups:function(n){var t=e.createGroups(n);e.setGroups(t)},setContextToolbar:function(n){var t=e.createGroups(n);e.setContextToolbar(t)},focusToolbar:function(){e.focus()},restoreToolbar:function(){e.restoreToolbar()},updateMode:function(n){Yg(c,i,n,t.root())},socket:u(c),dropup:u(a)}}(o);function c(t,e,r,o){!1===o&&n.selection.collapse();var u=l(t,e,r);i.setToolbarGroups(!0===o?u.readOnly:u.main),n.setMode(!0===o?"readonly":"design"),n.fire(!0===o?nh():th()),i.updateMode(o)}function a(t,e){return n.on(t,e),{unbind:function(){n.off(t)}}}!function(n,t){!function(n,t,e){e(n,t.element()),E(oe(t.element()),(function(n){t.getByDom(n).each(ae)}))}(n,t,sn)}(qt.fromDom(t),i.system());var f=t.ownerDocument.defaultView,s=xm(f,{onChange:function(){i.system().broadcastOn([wo.orientationChanged()],{width:wm(f)})},onReady:r}),l=function(n,t,e){var r=n.get();return{readOnly:r.backToMask.concat(t.get()),main:r.backToMask.concat(e.get())}};return n.on("init",(function(){i.init({editor:{getFrame:function(){return qt.fromDom(n.contentAreaContainer.querySelector("iframe"))},onDomChanged:function(){return{unbind:r}},onToReading:function(n){return a(nh(),n)},onToEditing:function(n){return a(th(),n)},onScrollToCursor:function(t){return n.on("ScrollIntoView",(function(n){t(n)})),{unbind:function(){n.off("ScrollIntoView"),s.destroy()}}},onTouchToolstrip:function(){t()},onTouchContent:function(){(function(n){return Yr(n).bind((function(n){return i.system().getByDom(n).toOption()}))})(qt.fromDom(n.editorContainer.querySelector("."+di.resolve("toolbar")))).each(U),i.restoreToolbar(),t()},onTapContent:function(t){var e=t.target();"img"===X(e)?(n.selection.select(e.dom()),t.kill()):"a"===X(e)&&i.system().getByDom(qt.fromDom(n.editorContainer)).each((function(n){vo.isAlpha(n)&&xo(e.dom())}))}},container:qt.fromDom(n.editorContainer),socket:qt.fromDom(n.contentAreaContainer),toolstrip:qt.fromDom(n.editorContainer.querySelector("."+di.resolve("toolstrip"))),toolbar:qt.fromDom(n.editorContainer.querySelector("."+di.resolve("toolbar"))),dropup:i.dropup(),alloy:i.system(),translate:r,setReadOnly:function(n){c(g,m,d,n)},readOnlyOnInit:function(){return!1}});var t=function(){i.dropup().disappear((function(){i.system().broadcastOn([wo.dropupDismissed()],{})}))},e={label:"The first group",scrollable:!1,items:[os.forToolbar("back",(function(){n.selection.collapse(),i.exit()}),{},n)]},o={label:"Back to read only",scrollable:!1,items:[os.forToolbar("readonly-back",(function(){c(g,m,d,!0)}),{},n)]},u=pm(i,n),f=function(n,t){var e=function(n){var t=void 0!==n.toolbar?n.toolbar:mm;return rt(t)?gm(t):Xl(t)}(n),r={};return R(e,(function(n){var e=!On(r,n)&&On(t,n)&&t[n].isSupported()?[t[n].sketch()]:[];return r[n]=!0,e}))}(n.settings,u),l={label:"The extra group",scrollable:!1,items:[]},d=Bn([{label:"the action group",scrollable:!0,items:f},l]),m=Bn([{label:"The read only mode group",scrollable:!0,items:[]},l]),g=Bn({backToMask:[e],backToReadOnly:[o]});Qp(i,n)})),n.on("remove",(function(){i.exit()})),n.on("detach",(function(){!function(n){E(oe(n.element()),(function(t){n.getByDom(t).each(ce)})),ue(n.element())}(i.system()),i.system().destroy()})),{iframeContainer:i.socket().element().dom(),editorContainer:i.element().dom()}}}}))}(window);