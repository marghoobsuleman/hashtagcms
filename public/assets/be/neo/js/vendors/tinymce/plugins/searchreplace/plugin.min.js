!function(){"use strict";var e=function(t){function n(){return r}var r=t;return{get:n,set:function(e){r=e},clone:function(){return e(n())}}},t=tinymce.util.Tools.resolve("tinymce.PluginManager"),n=function(){return(n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},r=tinymce.util.Tools.resolve("tinymce.util.Tools");function o(e){return e&&1===e.nodeType&&"false"===e.contentEditable}function a(e){var t=e.getAttribute("data-mce-index");return"number"==typeof t?""+t:t}function i(e){var t=e.parentNode;e.firstChild&&t.insertBefore(e.firstChild,e),e.parentNode.removeChild(e)}function c(e,t){var n,o=[];if((n=r.toArray(e.getBody().getElementsByTagName("span"))).length)for(var i=0;i<n.length;i++){var c=a(n[i]);null!==c&&c.length&&c===t.toString()&&o.push(n[i])}return o}function u(e,t,n){var r=t.get(),o=r.index,a=e.dom;(n=!1!==n)?o+1===r.count?o=0:o++:o-1==-1?o=r.count-1:o--,a.removeClass(c(e,r.index),"mce-match-marker-selected");var i=c(e,o);return i.length?(a.addClass(c(e,o),"mce-match-marker-selected"),e.selection.scrollIntoView(i[0]),o):-1}function d(e,t){var n=t.parentNode;e.remove(t),e.isEmpty(n)&&e.remove(n)}function l(e,t,n,r,o){n=(n=n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")).replace(/\s/g,"[^\\S\\r\\n]"),n=o?"\\b"+n+"\\b":n;var a=function(e,t,n){var r,o;return(o=e.dom.create("span",{"data-mce-bogus":1})).className="mce-match-marker",r=e.getBody(),y(e,t,!1),v.findAndReplaceDOMText(n,r,o,!1,e.schema)}(e,t,new RegExp(n,r?"g":"gi"));if(a){var i=u(e,t,!0);t.set({index:i,count:a,text:n,matchCase:r,wholeWord:o})}return a}function s(e,t){var r=u(e,t,!0);t.set(n(n({},t.get()),{index:r}))}function f(e,t){var r=u(e,t,!1);t.set(n(n({},t.get()),{index:r}))}function m(e){var t=a(e);return null!==t&&0<t.length}function p(e,t,o,c,u){var l,p,g,h,x,v=t.get(),y=v.index,b=y;for(c=!1!==c,g=e.getBody(),p=r.grep(r.toArray(g.getElementsByTagName("span")),m),l=0;l<p.length;l++){var N=a(p[l]);if(h=x=parseInt(N,10),u||h===v.index){for(o.length?(p[l].firstChild.nodeValue=o,i(p[l])):d(e.dom,p[l]);p[++l];){if((h=parseInt(a(p[l]),10))!==x){l--;break}d(e.dom,p[l])}c&&b--}else y<x&&p[l].setAttribute("data-mce-index",String(x-1))}return t.set(n(n({},v),{count:u?0:v.count-1,index:b})),c?s(e,t):f(e,t),!u&&0<t.get().count}function g(e){return function(){return e}}function h(){return w}var x,v={findAndReplaceDOMText:function(e,t,n,r,a){var i,c,u,d,l,s,f=[],m=0;function p(e,t){if(t=t||0,!e[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");var n=e.index;if(0<t){var r=e[t];if(!r)throw new Error("Invalid capture group");n+=e[0].indexOf(r),e[0]=r}return[n,n+e[0].length,[e[0]]]}if(u=t.ownerDocument,d=a.getBlockElements(),l=a.getWhiteSpaceElements(),s=a.getShortEndedElements(),c=function e(t){var n;if(3===t.nodeType)return t.data;if(l[t.nodeName]&&!d[t.nodeName])return"";if(n="",o(t))return"\n";if((d[t.nodeName]||s[t.nodeName])&&(n+="\n"),t=t.firstChild)for(;n+=e(t),t=t.nextSibling;);return n}(t)){if(e.global)for(;i=e.exec(c);)f.push(p(i,r));else i=c.match(e),f.push(p(i,r));return f.length&&(m=f.length,function(e,t,n){var r,a,i,c,u=[],f=0,m=e,p=t.shift(),g=0;e:for(;;){if((d[m.nodeName]||s[m.nodeName]||o(m))&&f++,3===m.nodeType&&(!a&&m.length+f>=p[1]?(a=m,c=p[1]-f):r&&u.push(m),!r&&m.length+f>p[0]&&(r=m,i=p[0]-f),f+=m.length),r&&a){if(m=n({startNode:r,startNodeIndex:i,endNode:a,endNodeIndex:c,innerNodes:u,match:p[2],matchIndex:g}),f-=a.length-c,a=r=null,u=[],g++,!(p=t.shift()))break}else if(l[m.nodeName]&&!d[m.nodeName]||!m.firstChild){if(m.nextSibling){m=m.nextSibling;continue}}else if(!o(m)){m=m.firstChild;continue}for(;;){if(m.nextSibling){m=m.nextSibling;break}if(m.parentNode===e)break e;m=m.parentNode}}}(t,f,function(e){var t;if("function"!=typeof e){var n=e.nodeType?e:u.createElement(e);t=function(e,t){var r=n.cloneNode(!1);return r.setAttribute("data-mce-index",t),e&&r.appendChild(u.createTextNode(e)),r}}else t=e;return function(e){var n,r,o,a=e.startNode,i=e.endNode,c=e.matchIndex;if(a===i){var d=a;o=d.parentNode,0<e.startNodeIndex&&(n=u.createTextNode(d.data.substring(0,e.startNodeIndex)),o.insertBefore(n,d));var l=t(e.match[0],c);return o.insertBefore(l,d),e.endNodeIndex<d.length&&(r=u.createTextNode(d.data.substring(e.endNodeIndex)),o.insertBefore(r,d)),d.parentNode.removeChild(d),l}n=u.createTextNode(a.data.substring(0,e.startNodeIndex)),r=u.createTextNode(i.data.substring(e.endNodeIndex));for(var s=t(a.data.substring(e.startNodeIndex),c),f=0,m=e.innerNodes.length;f<m;++f){var p=e.innerNodes[f],g=t(p.data,c);p.parentNode.replaceChild(g,p)}var h=t(i.data.substring(0,e.endNodeIndex),c);return(o=a.parentNode).insertBefore(n,a),o.insertBefore(s,a),o.removeChild(a),(o=i.parentNode).insertBefore(h,i),o.insertBefore(r,i),o.removeChild(i),h}}(n))),m}}},y=function(e,t,o){var c,u,d,l,s=t.get();for(u=r.toArray(e.getBody().getElementsByTagName("span")),c=0;c<u.length;c++){var f=a(u[c]);null!==f&&f.length&&(f===s.index.toString()&&(d=d||u[c].firstChild,l=u[c].firstChild),i(u[c]))}if(t.set(n(n({},s),{index:-1,count:0,text:""})),d&&l){var m=e.dom.createRng();return m.setStart(d,0),m.setEnd(l,l.data.length),!1!==o&&e.selection.setRng(m),m}},b=g(!1),N=g(!0),w=(x={fold:function(e,t){return e()},is:b,isSome:b,isNone:N,getOr:S,getOrThunk:T,getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:g(null),getOrUndefined:g(void 0),or:S,orThunk:T,map:h,each:function(){},bind:h,exists:b,forall:N,filter:h,equals:C,equals_:C,toArray:function(){return[]},toString:g("none()")},Object.freeze&&Object.freeze(x),x);function C(e){return e.isNone()}function T(e){return e()}function S(e){return e}function O(e,t){return function(){k(e,t)}}var A=function(e){function t(){return o}function n(t){return t(e)}var r=g(e),o={fold:function(t,n){return n(e)},is:function(t){return e===t},isSome:N,isNone:b,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:t,orThunk:t,map:function(t){return A(t(e))},each:function(t){t(e)},bind:n,exists:n,forall:n,filter:function(t){return t(e)?o:w},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(t){return t.is(e)},equals_:function(t,n){return t.fold(b,(function(t){return n(e,t)}))}};return o},B={some:A,none:h,from:function(e){return null==e?w:A(e)}},I=(Array.prototype.slice,function(e){return"function"===function(e){if(null===e)return"null";var t=typeof e;return"object"==t&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":t}(e)}(Array.from)&&Array.from,tinymce.util.Tools.resolve("tinymce.Env")),k=function(t,n){var o=function(){var t=e(B.none());return{clear:function(){t.set(B.none())},set:function(e){t.set(B.some(e))},isSet:function(){return t.get().isSome()},on:function(e){t.get().each(e)}}}();t.undoManager.add();var a=r.trim(t.selection.getContent({format:"text"}));function i(e){(!function(e,t){return 1<t.get().count}(0,n)?e.disable:e.enable)("next"),(function(e,t){return 1<t.get().count}(0,n)?e.enable:e.disable)("prev")}function c(e,t){!function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)}(["replace","replaceall","prev","next"],t?e.disable:e.enable)}function u(e,t){I.browser.isSafari()&&I.deviceType.isTouch()&&("find"===t||"replace"===t||"replaceall"===t)&&e.focus(t)}function d(e){y(t,n,!1),c(e,!0),i(e)}function m(e){var r=e.getData(),o=n.get();if(r.findtext.length){if(o.text===r.findtext&&o.matchCase===r.matchcase&&o.wholeWord===r.wholewords)s(t,n);else{var a=l(t,n,r.findtext,r.matchcase,r.wholewords);a<=0&&function(e){t.windowManager.alert("Could not find the specified string.",(function(){e.focus("findtext")}))}(e),c(e,0===a)}i(e)}else d(e)}var g=n.get(),h={title:"Find and Replace",size:"normal",body:{type:"panel",items:[{type:"bar",items:[{type:"input",name:"findtext",placeholder:"Find",maximized:!0,inputMode:"search"},{type:"button",name:"prev",text:"Previous",icon:"action-prev",disabled:!0,borderless:!0},{type:"button",name:"next",text:"Next",icon:"action-next",disabled:!0,borderless:!0}]},{type:"input",name:"replacetext",placeholder:"Replace with",inputMode:"search"}]},buttons:[{type:"menu",name:"options",icon:"preferences",tooltip:"Preferences",align:"start",items:[{type:"togglemenuitem",name:"matchcase",text:"Match case"},{type:"togglemenuitem",name:"wholewords",text:"Find whole words only"}]},{type:"custom",name:"find",text:"Find",primary:!0},{type:"custom",name:"replace",text:"Replace",disabled:!0},{type:"custom",name:"replaceall",text:"Replace All",disabled:!0}],initialData:{findtext:a,replacetext:"",wholewords:g.wholeWord,matchcase:g.matchCase},onChange:function(e,t){"findtext"===t.name&&0<n.get().count&&d(e)},onAction:function(e,r){var o=e.getData();switch(r.name){case"find":m(e);break;case"replace":p(t,n,o.replacetext)?i(e):d(e);break;case"replaceall":p(t,n,o.replacetext,!0,!0),d(e);break;case"prev":f(t,n),i(e);break;case"next":s(t,n),i(e)}u(e,r.name)},onSubmit:function(e){m(e),u(e,"find")},onClose:function(){t.focus(),y(t,n),t.undoManager.add()}};o.set(t.windowManager.open(h,{inline:"toolbar"}))};t.add("searchreplace",(function(t){var n=e({index:-1,count:0,text:"",matchCase:!1,wholeWord:!1});return function(e,t){e.addCommand("SearchReplace",(function(){k(e,t)}))}(t,n),function(e,t){e.ui.registry.addMenuItem("searchreplace",{text:"Find and replace...",shortcut:"Meta+F",onAction:O(e,t),icon:"search"}),e.ui.registry.addButton("searchreplace",{tooltip:"Find and replace",onAction:O(e,t),icon:"search"}),e.shortcuts.add("Meta+F","",O(e,t))}(t,n),function(e,t){return{done:function(n){return y(e,t,n)},find:function(n,r,o){return l(e,t,n,r,o)},next:function(){return s(e,t)},prev:function(){return f(e,t)},replace:function(n,r,o){return p(e,t,n,r,o)}}}(t,n)}))}();