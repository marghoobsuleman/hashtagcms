!function(){"use strict";function e(e,t){if(t<0&&(t=0),3===e.nodeType){var n=e.data.length;n<t&&(t=n)}return t}function t(t,n,i){1!==n.nodeType||n.hasChildNodes()?t.setStart(n,e(n,i)):t.setStartBefore(n)}function n(t,n,i){1!==n.nodeType||n.hasChildNodes()?t.setEnd(n,e(n,i)):t.setEndAfter(n)}var i=tinymce.util.Tools.resolve("tinymce.PluginManager"),o=tinymce.util.Tools.resolve("tinymce.Env"),r=function(e,i,o){var r,f,a,s,d,l,c,u,g,h,C=function(e){return e.getParam("autolink_pattern",/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i)}(e),m=function(e){return e.getParam("default_link_target",!1)}(e);if("A"!==e.selection.getNode().tagName){if((r=e.selection.getRng(!0).cloneRange()).startOffset<5){if(!(u=r.endContainer.previousSibling)){if(!r.endContainer.firstChild||!r.endContainer.firstChild.nextSibling)return;u=r.endContainer.firstChild.nextSibling}if(t(r,u,g=u.length),n(r,u,g),r.endOffset<5)return;f=r.endOffset,s=u}else{if(3!==(s=r.endContainer).nodeType&&s.firstChild){for(;3!==s.nodeType&&s.firstChild;)s=s.firstChild;3===s.nodeType&&(t(r,s,0),n(r,s,s.nodeValue.length))}f=1===r.endOffset?2:r.endOffset-1-i}for(a=f;t(r,s,2<=f?f-2:0),n(r,s,1<=f?f-1:0),f-=1," "!==(h=r.toString())&&""!==h&&160!==h.charCodeAt(0)&&0<=f-2&&h!==o;);!function(e,t){return e===t||" "===e||160===e.charCodeAt(0)}(r.toString(),o)?(0===r.startOffset?t(r,s,0):t(r,s,f),n(r,s,a)):(t(r,s,f),n(r,s,a),f+=1),"."===(l=r.toString()).charAt(l.length-1)&&n(r,s,a-1),(c=(l=r.toString().trim()).match(C))&&("www."===c[1]?c[1]="http://www.":/@$/.test(c[1])&&!/^mailto:/.test(c[1])&&(c[1]="mailto:"+c[1]),d=e.selection.getBookmark(),e.selection.setRng(r),e.execCommand("createlink",!1,c[1]+c[2]),!1!==m&&e.dom.setAttrib(e.selection.getNode(),"target",m),e.selection.moveToBookmark(d),e.nodeChanged())}};i.add("autolink",(function(e){var t,n;(t=e).on("keydown",(function(e){if(13===e.keyCode)return function(e){r(e,-1,"")}(t)})),o.browser.isIE()?t.on("focus",(function(){if(!n){n=!0;try{t.execCommand("AutoUrlDetect",!1,!0)}catch(e){}}})):(t.on("keypress",(function(e){if(41===e.keyCode)return function(e){r(e,-1,"(")}(t)})),t.on("keyup",(function(e){if(32===e.keyCode)return function(e){r(e,0,"")}(t)})))}))}();