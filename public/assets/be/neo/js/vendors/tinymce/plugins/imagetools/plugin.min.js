!function(e){"use strict";function n(){return s}var t,r=function(e){function n(){return t}var t=e;return{get:n,set:function(e){t=e},clone:function(){return r(n())}}},o=tinymce.util.Tools.resolve("tinymce.PluginManager"),i=tinymce.util.Tools.resolve("tinymce.util.Tools"),u=function(e){return function(){return e}},a=u(!1),c=u(!0),s=(t={fold:function(e,n){return e()},is:a,isSome:a,isNone:c,getOr:d,getOrThunk:l,getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:u(null),getOrUndefined:u(void 0),or:d,orThunk:l,map:n,each:function(){},bind:n,exists:a,forall:c,filter:n,equals:f,equals_:f,toArray:function(){return[]},toString:u("none()")},Object.freeze&&Object.freeze(t),t);function f(e){return e.isNone()}function l(e){return e()}function d(e){return e}var m=function(e){function n(){return o}function t(n){return n(e)}var r=u(e),o={fold:function(n,t){return t(e)},is:function(n){return e===n},isSome:c,isNone:a,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:n,orThunk:n,map:function(n){return m(n(e))},each:function(n){n(e)},bind:t,exists:t,forall:t,filter:function(n){return n(e)?o:s},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(n){return n.is(e)},equals_:function(n,t){return n.fold(a,(function(n){return t(e,n)}))}};return o},h={some:m,none:n,from:function(e){return null==e?s:m(e)}};function g(n,t){return y(e.document.createElement("canvas"),n,t)}function v(e){var n=g(e.width,e.height);return p(n).drawImage(e,0,0),n}function p(e){return e.getContext("2d")}function y(e,n,t){return e.width=n,e.height=t,e}var w,b,E=window.Promise?window.Promise:(w=O.immediateFn||"function"==typeof window.setImmediate&&window.setImmediate||function(n){e.setTimeout(n,1)},b=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},O.prototype.catch=function(e){return this.then(null,e)},O.prototype.then=function(e,n){var t=this;return new O((function(r,o){_.call(t,new R(e,n,r,o))}))},O.all=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var t=Array.prototype.slice.call(1===e.length&&b(e[0])?e[0]:e);return new O((function(e,n){if(0===t.length)return e([]);var r=t.length;function o(i,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var a=u.then;if("function"==typeof a)return void a.call(u,(function(e){o(i,e)}),n)}t[i]=u,0==--r&&e(t)}catch(e){n(e)}}for(var i=0;i<t.length;i++)o(i,t[i])}))},O.resolve=function(e){return e&&"object"==typeof e&&e.constructor===O?e:new O((function(n){n(e)}))},O.reject=function(e){return new O((function(n,t){t(e)}))},O.race=function(e){return new O((function(n,t){for(var r=0,o=e;r<o.length;r++)o[r].then(n,t)}))},O);function O(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],S(e,T(N,this),T(x,this))}function T(e,n){return function(){return e.apply(n,arguments)}}function _(e){var n=this;null!==this._state?w((function(){var t=n._state?e.onFulfilled:e.onRejected;if(null!==t){var r;try{r=t(n._value)}catch(n){return void e.reject(n)}e.resolve(r)}else(n._state?e.resolve:e.reject)(n._value)})):this._deferreds.push(e)}function N(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void S(T(n,e),T(N,this),T(x,this))}this._state=!0,this._value=e,I.call(this)}catch(e){x.call(this,e)}}function x(e){this._state=!1,this._value=e,I.call(this)}function I(){for(var e=0,n=this._deferreds;e<n.length;e++){var t=n[e];_.call(this,t)}this._deferreds=[]}function R(e,n,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.resolve=t,this.reject=r}function S(e,n,t){var r=!1;try{e((function(e){r||(r=!0,n(e))}),(function(e){r||(r=!0,t(e))}))}catch(e){if(r)return;r=!0,t(e)}}function A(n){return new E((function(t,r){var o=e.URL.createObjectURL(n),i=new e.Image,u=function(){i.removeEventListener("load",a),i.removeEventListener("error",c)};function a(){u(),t(i)}function c(){u(),r("Unable to load data of type "+n.type+": "+o)}i.addEventListener("load",a),i.addEventListener("error",c),i.src=o,i.complete&&a()}))}function C(n){return new E((function(t,r){(function(n){var t=n.split(","),r=/data:([^;]+)/.exec(t[0]);if(!r)return h.none();for(var o=r[1],i=t[1],u=e.atob(i),a=u.length,c=Math.ceil(a/1024),s=new Array(c),f=0;f<c;++f){for(var l=1024*f,d=Math.min(1024+l,a),m=new Array(d-l),g=l,v=0;g<d;++v,++g)m[v]=u[g].charCodeAt(0);s[f]=new Uint8Array(m)}return h.some(new e.Blob(s,{type:o}))})(n).fold((function(){r("uri is not base64: "+n)}),t)}))}function U(n,t,r){return t=t||"image/png",e.HTMLCanvasElement.prototype.toBlob?new E((function(e,o){n.toBlob((function(n){n?e(n):o()}),t,r)})):C(n.toDataURL(t,r))}function D(e,n,t){var r=n.type;function o(n,t){return e.then((function(e){return function(e,n,t){return n=n||"image/png",e.toDataURL(n,t)}(e,n,t)}))}return{getType:u(r),toBlob:function(){return E.resolve(n)},toDataURL:function(){return t},toBase64:function(){return t.split(",")[1]},toAdjustedBlob:function(n,t){return e.then((function(e){return U(e,n,t)}))},toAdjustedDataURL:o,toAdjustedBase64:function(e,n){return o(e,n).then((function(e){return e.split(",")[1]}))},toCanvas:function(){return e.then(v)}}}function L(e,n){return U(e,n).then((function(n){return D(E.resolve(e),n,e.toDataURL())}))}function j(n){return function(n){return function(n){return new E((function(t){var r=new e.FileReader;r.onloadend=function(){t(r.result)},r.readAsDataURL(n)}))}(n).then((function(t){return D(function(n){return A(n).then((function(n){!function(n){e.URL.revokeObjectURL(n.src)}(n);var t=g(function(e){return e.naturalWidth||e.width}(n),function(e){return e.naturalHeight||e.height}(n));return p(t).drawImage(n,0,0),t}))}(n),n,t)}))}(n)}var P=tinymce.util.Tools.resolve("tinymce.util.Delay"),M=tinymce.util.Tools.resolve("tinymce.util.Promise"),k=tinymce.util.Tools.resolve("tinymce.util.URI");function B(e,n){for(var t=0,r=e.length;t<r;t++){var o=e[t];if(n(o,t))return h.some(o)}return h.none()}function F(e){return null!=e}function H(e){var n=function(e){return"ImageProxy HTTP error: "+B(V,(function(n){return e===n.code})).fold(u("Unknown ImageProxy error"),(function(e){return e.message}))}(e);return M.reject(n)}var q=function(e){var n,t;function r(e){return/^[0-9\.]+px$/.test(e)}return n=e.style.width,t=e.style.height,n||t?r(n)&&r(t)?{w:parseInt(n,10),h:parseInt(t,10)}:null:(n=e.width,t=e.height,n&&t?{w:parseInt(n,10),h:parseInt(t,10)}:null)},z=function(e){return{w:e.naturalWidth,h:e.naturalHeight}},$=(Array.prototype.slice,"function"===function(e){if(null===e)return"null";var n=typeof e;return"object"==n&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"==n&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":n}(Array.from)&&Array.from,function(e,n){var t;return t=n.reduce((function(e,n){return F(e)?e[n]:void 0}),e),F(t)?t:null}),X=function(n){return new M((function(t){var r=new e.FileReader;r.onload=function(e){var n=e.target;t(n.result)},r.readAsText(n)}))},W=function(n,t,r){return new M((function(o){var u;(u=new e.XMLHttpRequest).onreadystatechange=function(){4===u.readyState&&o({status:u.status,blob:this.response})},u.open("GET",n,!0),u.withCredentials=r,i.each(t,(function(e,n){u.setRequestHeader(n,e)})),u.responseType="blob",u.send()}))},G=function(e){var n;try{n=JSON.parse(e)}catch(e){}return n},V=[{code:404,message:"Could not find Image Proxy"},{code:403,message:"Rejected request"},{code:0,message:"Incorrect Image Proxy URL"}],Y=[{type:"key_missing",message:"The request did not include an api key."},{type:"key_not_found",message:"The provided api key could not be found."},{type:"domain_not_trusted",message:"The api key is not valid for the request origins."}],J=function(e,n){return function(e){return 400===e||403===e||500===e}(e)?function(e,n){return X(n).then((function(e){var n=function(e){var n=G(e),t=$(n,["error","type"]);return"ImageProxy Service error: "+(t?function(e){return B(Y,(function(n){return n.type===e})).fold(u("Unknown service error"),(function(e){return e.message}))}(t):"Invalid JSON in service error message")}(e);return M.reject(n)}))}(0,n):H(e)},K=H;function Q(e,n,t){return n?function(e,n){var t={"Content-Type":"application/json;charset=UTF-8","tiny-api-key":n};return W(function(e,n){var t=-1===e.indexOf("?")?"?":"&";return/[?&]apiKey=/.test(e)||!n?e:e+t+"apiKey="+encodeURIComponent(n)}(e,n),t,!1).then((function(e){return e.status<200||300<=e.status?J(e.status,e.blob):M.resolve(e.blob)}))}(e,n):function(e,n){return W(e,{},n).then((function(e){return e.status<200||300<=e.status?K(e.status):M.resolve(e.blob)}))}(e,t)}function Z(e,n){return function(){return n===e}}function ee(e,n){return function(){return n===e}}function ne(e,n){var t=String(n).toLowerCase();return B(e,(function(e){return e.search(t)}))}function te(e,n){return-1!==e.indexOf(n)}function re(e){return function(n){return te(n,e)}}function oe(e){return function(e){return function(e,n){return B(e.dom().childNodes,(function(e){return n(De.fromDom(e))})).map(De.fromDom)}(e,(function(e){return function(e,n){var t=e.dom();if(t.nodeType!==je)return!1;var r=t;if(void 0!==r.matches)return r.matches(n);if(void 0!==r.msMatchesSelector)return r.msMatchesSelector(n);if(void 0!==r.webkitMatchesSelector)return r.webkitMatchesSelector(n);if(void 0!==r.mozMatchesSelector)return r.mozMatchesSelector(n);throw new Error("Browser lacks native selectors")}(e,"img")}))}(De.fromDom(e))}function ie(e,n){return e.dom.is(n,"figure")}function ue(e,n){e.notificationManager.open({text:n,type:"error"})}function ae(e){var n=e.selection.getNode();return ie(e,n)?oe(n):h.some(De.fromDom(n))}function ce(n,t){var r;return(r=n.editorUpload.blobCache.getByUri(t.src))?M.resolve(r.blob()):function(n,t){return function(e){return h.from(e.getParam("imagetools_fetch_image",null,"function"))}(n).fold((function(){return function(n,t){var r,o=t.src;return ke(n,t)?Q(t.src,null,function(e,n){return-1!==i.inArray(function(e){return e.getParam("imagetools_credentials_hosts",[],"string[]")}(e),new k(n.src).host)}(n,t)):Me(n,t)?function(n){return function(n){var t=n.src;return 0===t.indexOf("data:")?C(t):function(n){return new E((function(t,r){var o=new e.XMLHttpRequest;o.open("GET",n,!0),o.responseType="blob",o.onload=function(){200===this.status&&t(this.response)},o.onerror=function(){var e;r(0===this.status?((e=new Error("No access to download image")).code=18,e.name="SecurityError",e):new Error("Error "+this.status+" downloading image"))},o.send()}))}(t)}(n)}(t):(o=function(e){return e.getParam("imagetools_proxy")}(n),o+=(-1===o.indexOf("?")?"?":"&")+"url="+encodeURIComponent(t.src),r=function(e){return e.getParam("api_key",e.getParam("imagetools_api_key","","string"),"string")}(n),Q(o,r,!1))}(n,t)}),(function(e){return e(t)}))}(n,t)}function se(e){P.clearTimeout(e.get())}function fe(e,n,t,r,o,i){return n.toBlob().then((function(u){var a,c,s,f;return s=e.editorUpload.blobCache,a=o.src,function(e){return e.getParam("images_reuse_filename",!1,"boolean")}(e)&&(c=(f=s.getByUri(a))?(a=f.uri(),f.name()):function(e,n){var t=n.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i);return t?e.dom.encode(t[1]):null}(e,a)),f=s.create({id:"imagetools"+Pe++,blob:u,base64:n.toBase64(),uri:a,name:c}),s.add(f),e.undoManager.transact((function(){e.$(o).on("load",(function n(){e.$(o).off("load",n),e.nodeChanged(),t?e.editorUpload.uploadImagesAuto():(se(r),function(e,n){var t=P.setEditorTimeout(e,(function(){e.editorUpload.uploadImagesAuto()}),function(e){return e.getParam("images_upload_timeout",3e4,"number")}(e));n.set(t)}(e,r))})),i&&e.$(o).attr({width:i.w,height:i.h}),e.$(o).attr({src:f.blobUri()}).removeAttr("data-mce-src")})),f}))}function le(e,n,t,r){return function(){return ae(e).fold((function(){ue(e,"Could not find selected image")}),(function(o){return e._scanForImages().then((function(){return ce(e,o.dom())})).then(j).then(t).then((function(t){return fe(e,t,!1,n,o.dom(),r)}),(function(n){ue(e,n)}))}))}}var de=function(){return me(0,0)},me=function(e,n){return{major:e,minor:n}},he=function(e,n){var t=String(n).toLowerCase();return 0===e.length?de():function(e,n){var t=function(e,n){for(var t=0;t<e.length;t++){var r=e[t];if(r.test(n))return r}}(e,n);if(!t)return{major:0,minor:0};function r(e){return Number(n.replace(t,"$"+e))}return me(r(1),r(2))}(e,t)},ge=de,ve="Firefox",pe=function(e){var n=e.current;return{current:n,version:e.version,isEdge:Z("Edge",n),isChrome:Z("Chrome",n),isIE:Z("IE",n),isOpera:Z("Opera",n),isFirefox:Z(ve,n),isSafari:Z("Safari",n)}},ye=function(){return pe({current:void 0,version:ge()})},we=pe,be=(u("Edge"),u("Chrome"),u("IE"),u("Opera"),u(ve),u("Safari"),"Windows"),Ee="Android",Oe="Solaris",Te="FreeBSD",_e=function(e){var n=e.current;return{current:n,version:e.version,isWindows:ee(be,n),isiOS:ee("iOS",n),isAndroid:ee(Ee,n),isOSX:ee("OSX",n),isLinux:ee("Linux",n),isSolaris:ee(Oe,n),isFreeBSD:ee(Te,n)}},Ne=function(){return _e({current:void 0,version:ge()})},xe=_e,Ie=(u(be),u("iOS"),u(Ee),u("Linux"),u("OSX"),u(Oe),u(Te),/.*?version\/\ ?([0-9]+)\.([0-9]+).*/),Re=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return te(e,"edge/")&&te(e,"chrome")&&te(e,"safari")&&te(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Ie],search:function(e){return te(e,"chrome")&&!te(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return te(e,"msie")||te(e,"trident")}},{name:"Opera",versionRegexes:[Ie,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:re("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:re("firefox")},{name:"Safari",versionRegexes:[Ie,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(te(e,"safari")||te(e,"mobile/"))&&te(e,"applewebkit")}}],Se=[{name:"Windows",search:re("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return te(e,"iphone")||te(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:re("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:re("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:re("linux"),versionRegexes:[]},{name:"Solaris",search:re("sunos"),versionRegexes:[]},{name:"FreeBSD",search:re("freebsd"),versionRegexes:[]}],Ae={browsers:u(Re),oses:u(Se)},Ce=r(function(n){var t=Ae.browsers(),r=Ae.oses(),o=function(e,n){return ne(e,n).map((function(e){var t=he(e.versionRegexes,n);return{current:e.name,version:t}}))}(t,n).fold(ye,we),i=function(e,n){return ne(e,n).map((function(e){var t=he(e.versionRegexes,n);return{current:e.name,version:t}}))}(r,n).fold(Ne,xe);return{browser:o,os:i,deviceType:function(e,n,t,r){var o=e.isiOS()&&!0===/ipad/i.test(t),i=e.isiOS()&&!o,a=e.isiOS()||e.isAndroid(),c=a||r("(pointer:coarse)"),s=o||!i&&a&&r("(min-device-width:768px)"),f=i||a&&!s,l=n.isSafari()&&e.isiOS()&&!1===/safari/i.test(t),d=!f&&!s&&!l;return{isiPad:u(o),isiPhone:u(i),isTablet:u(s),isPhone:u(f),isTouch:u(c),isAndroid:e.isAndroid,isiOS:e.isiOS,isWebView:u(l),isDesktop:u(d)}}(i,o,n,(function(n){return e.window.matchMedia(n).matches}))}}(e.navigator.userAgent)),Ue=function(e){if(null==e)throw new Error("Node cannot be null or undefined");return{dom:u(e)}},De={fromHtml:function(n,t){var r=(t||e.document).createElement("div");if(r.innerHTML=n,!r.hasChildNodes()||1<r.childNodes.length)throw e.console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return Ue(r.childNodes[0])},fromTag:function(n,t){var r=(t||e.document).createElement(n);return Ue(r)},fromText:function(n,t){var r=(t||e.document).createTextNode(n);return Ue(r)},fromDom:Ue,fromPoint:function(e,n,t){var r=e.dom();return h.from(r.elementFromPoint(n,t)).map(Ue)}},Le=(e.Node.ATTRIBUTE_NODE,e.Node.CDATA_SECTION_NODE,e.Node.COMMENT_NODE,e.Node.DOCUMENT_NODE,e.Node.DOCUMENT_TYPE_NODE,e.Node.DOCUMENT_FRAGMENT_NODE,e.Node.ELEMENT_NODE),je=(e.Node.TEXT_NODE,e.Node.PROCESSING_INSTRUCTION_NODE,e.Node.ENTITY_REFERENCE_NODE,e.Node.ENTITY_NODE,e.Node.NOTATION_NODE,Le),Pe=(Ce.get().browser.isIE(),void 0!==e.window?e.window:Function("return this;")(),0),Me=function(e,n){var t=n.src;return 0===t.indexOf("data:")||0===t.indexOf("blob:")||new k(t).host===e.documentBaseURI.host},ke=function(e,n){return-1!==i.inArray(function(e){return e.getParam("imagetools_cors_hosts",[],"string[]")}(e),new k(n.src).host)},Be=function(e,n,t){return function(){var r=ae(e).fold((function(){return null}),(function(e){var n=q(e.dom());return n?{w:n.h,h:n.w}:null}));return le(e,n,(function(e){return function(e,n){return function(e,n){return e.toCanvas().then((function(t){return function(e,n,t){var r=g(e.width,e.height),o=p(r),i=0,u=0;return 90!==(t=t<0?360+t:t)&&270!==t||y(r,r.height,r.width),90!==t&&180!==t||(i=r.width),270!==t&&180!==t||(u=r.height),o.translate(i,u),o.rotate(t*Math.PI/180),o.drawImage(e,0,0),L(r,n)}(t,e.getType(),n)}))}(e,n)}(e,t)}),r)()}},Fe=function(e,n,t){return function(){return le(e,n,(function(e){return function(e,n){return function(e,n){return e.toCanvas().then((function(t){return function(e,n,t){var r=g(e.width,e.height),o=p(r);return"v"===t?(o.scale(1,-1),o.drawImage(e,0,-r.height)):(o.scale(-1,1),o.drawImage(e,-r.width,0)),L(r,n)}(t,e.getType(),n)}))}(e,n)}(e,t)}))()}},He=function(e,n){function t(n){return function(n){return e.dom.is(n,"img:not([data-mce-object],[data-mce-placeholder])")}(n)&&(Me(e,n)||ke(e,n)||e.settings.imagetools_proxy)}return ie(e,n)?oe(n).map((function(e){return t(e.dom())?h.some(e.dom()):h.none()})):t(n)?h.some(n):h.none()},qe=se,ze=ce,$e=ae,Xe=u("save-state"),We=u("disable"),Ge=u("enable"),Ve=function(n,t){return function(){var r=$e(n),o=r.map((function(e){return z(e.dom())}));$e(n).each((function(i){He(n,i.dom()).each((function(u){ze(n,i.dom()).then((function(i){var u=function(n){return{blob:n,url:e.URL.createObjectURL(n)}}(i);n.windowManager.open(function(i){return{title:"Edit Image",size:"large",body:{type:"panel",items:[{type:"imagetools",name:"imagetools",label:"Edit Image",currentState:i}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0,disabled:!0}],onSubmit:function(i){var u=i.getData().imagetools.blob;r.each((function(r){o.each((function(o){!function(n,t,r,o,i){new M((function(u){(function(e){return A(e)})(i).then((function(n){var t=z(n);return o.w===t.w&&o.h===t.h||q(r)&&function(e,n){var t,r;n&&(t=e.style.width,r=e.style.height,(t||r)&&(e.style.width=n.w+"px",e.style.height=n.h+"px",e.removeAttribute("data-mce-style")),t=e.width,r=e.height,(t||r)&&(e.setAttribute("width",n.w),e.setAttribute("height",n.h)))}(r,t),e.URL.revokeObjectURL(n.src),i})).then(j).then((function(e){return fe(n,e,!0,t,r)}),(function(){}))}))}(n,t,r.dom(),o,u)}))})),i.close()},onCancel:function(){},onAction:function(e,n){switch(n.name){case Xe():n.value?e.enable("save"):e.disable("save");break;case We():e.disable("save"),e.disable("cancel");break;case Ge():e.enable("cancel")}}}}(u))}))}))}))}};o.add("imagetools",(function(e){var n=r(0),t=r(null);(function(e,n){i.each({mceImageRotateLeft:Be(e,n,-90),mceImageRotateRight:Be(e,n,90),mceImageFlipVertical:Fe(e,n,"v"),mceImageFlipHorizontal:Fe(e,n,"h"),mceEditImage:Ve(e,n)},(function(n,t){e.addCommand(t,n)}))})(e,n),function(e){function n(n){return function(){return e.execCommand(n)}}e.ui.registry.addButton("rotateleft",{tooltip:"Rotate counterclockwise",icon:"rotate-left",onAction:n("mceImageRotateLeft")}),e.ui.registry.addButton("rotateright",{tooltip:"Rotate clockwise",icon:"rotate-right",onAction:n("mceImageRotateRight")}),e.ui.registry.addButton("flipv",{tooltip:"Flip vertically",icon:"flip-vertically",onAction:n("mceImageFlipVertical")}),e.ui.registry.addButton("fliph",{tooltip:"Flip horizontally",icon:"flip-horizontally",onAction:n("mceImageFlipHorizontal")}),e.ui.registry.addButton("editimage",{tooltip:"Edit image",icon:"edit-image",onAction:n("mceEditImage"),onSetup:function(n){function t(){$e(e).each((function(t){var r=He(e,t.dom()).isNone();n.setDisabled(r)}))}return e.on("NodeChange",t),function(){e.off("NodeChange",t)}}}),e.ui.registry.addButton("imageoptions",{tooltip:"Image options",icon:"image-options",onAction:n("mceImage")}),e.ui.registry.addContextMenu("imagetools",{update:function(t){return He(e,t).fold((function(){return[]}),(function(e){return[{text:"Edit image",icon:"edit-image",onAction:n("mceEditImage")}]}))}})}(e),function(e){e.ui.registry.addContextToolbar("imagetools",{items:function(e){return e.getParam("imagetools_toolbar","rotateleft rotateright flipv fliph editimage imageoptions")}(e),predicate:function(n){return He(e,n).isSome()},position:"node",scope:"node"})}(e),function(e,n,t){e.on("NodeChange",(function(r){var o=t.get();o&&o.src!==r.element.src&&(qe(n),e.editorUpload.uploadImagesAuto(),t.set(null)),He(e,r.element).each(t.set)}))}(e,n,t)}))}(window);